
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>9. SQL &#8212; Online-Skript Grundlagen der Datenbanksysteme</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10. Integrität und Trigger" href="../10/integritaet_und_trigger.html" />
    <link rel="prev" title="8. Relationale Algebra" href="../08/relationale_algebra.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/DBIS_Kurzlogo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Online-Skript Grundlagen der Datenbanksysteme</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Grundlagen der Datenbanksysteme
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01/einfuehrung.html">
   1. Einführung
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02/historie.html">
   2. Historie
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03/architektur.html">
   3. Architektur
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04/phasenmodell_datenbankentwurf.html">
   4. Phasenmodell für den Datenbankentwurf
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05/er_modellierung.html">
   5. ER-Modellierung
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../06/relationaler_entwurf.html">
   6. Relationaler Entwurf
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07/normalisierung.html">
   7. Normalisierung
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../08/relationale_algebra.html">
   8. Relationale Algebra
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   9. SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10/integritaet_und_trigger.html">
   10. Integrität und Trigger
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../11/transaktionen.html">
   11. Transaktionsmanagement
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../12/bearbeitung.html">
   12. Bearbeitung
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/LUH-DBS/GDBS_Script/main/?urlpath=tree/09/sql.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/LUH-DBS/GDBS_Script"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/LUH-DBS/GDBS_Script/issues/new?title=Issue%20on%20page%20%2F09/sql.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/09/sql.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#einfuhrung">
   9.1. Einführung
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#motivation-fur-sql">
     9.1.1. Motivation für SQL
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sql-historie">
     9.1.2. SQL-Historie
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sql-standardisierung">
     9.1.3. SQL – Standardisierung
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sql-2008-struktur">
     9.1.4. SQL:2008 Struktur
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#einfach-anfragen">
   9.2. Einfach Anfragen
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#select-from-where">
     9.2.1. SELECT … FROM … WHERE …
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#beispielschema">
     9.2.2. Beispielschema
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#projektion-in-sql-select-pi">
     9.2.3. Projektion in SQL (SELECT,
     <span class="math notranslate nohighlight">
      \(\pi\)
     </span>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selektion-in-sql-where-sigma">
     9.2.4. Selektion in SQL (WHERE,
     <span class="math notranslate nohighlight">
      \(\sigma\)
     </span>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stringvergleiche">
     9.2.5. Stringvergleiche
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#string-mustervergleiche-mit-like">
     9.2.6. String-Mustervergleiche mit LIKE
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#datum-und-uhrzeit">
     9.2.7. Datum und Uhrzeit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nullwerte">
     9.2.8. Nullwerte
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wahrheitswerte">
     9.2.9. Wahrheitswerte
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sortierung">
     9.2.10. Sortierung
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#anfragen-uber-mehrere-relationen">
   9.3. Anfragen über mehrere Relationen
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kreuzprodukt-und-join">
     9.3.1. Kreuzprodukt und Join
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uneindeutige-attributnamen">
     9.3.2. Uneindeutige Attributnamen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tupelvariablen">
     9.3.3. Tupelvariablen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tupelvariablen-selfjoin">
     9.3.4. Tupelvariablen-Selfjoin
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpretation-von-anfragen">
     9.3.5. Interpretation von Anfragen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#joins">
     9.3.6. Joins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-tpc-h-schema">
     9.3.7. The TPC-H Schema
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tpc-query-minimum-cost-supplier">
       9.3.7.1. TPC Query - Minimum Cost Supplier
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-tpc-h-universal-table">
       9.3.7.2. The TPC-H Universal Table
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#outer-joins">
     9.3.8. Outer Joins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kreuzprodukt">
     9.3.9. Kreuzprodukt
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mengenoperationen-in-sql">
     9.3.10. Mengenoperationen in SQL
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#schnittmenge-intersect">
       9.3.10.1. Schnittmenge: INTERSECT
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#vereinigung-union">
       9.3.10.2. Vereinigung: UNION
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#differenz-except-minus">
       9.3.10.3. Differenz: EXCEPT/MINUS
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#klammerung">
       9.3.10.4. Klammerung
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#zusammenfassung-der-semantik">
     9.3.11. Zusammenfassung der Semantik
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#geschachtelte-anfragen">
   9.4. Geschachtelte Anfragen
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skalare-subanfragen">
     9.4.1. Skalare Subanfragen
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skalare-subanfragen-beispiel">
       9.4.1.1. Skalare Subanfragen – Beispiel
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bedingungen-mit-relationen">
     9.4.2. Bedingungen mit Relationen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exists-beispiele">
     9.4.3. EXISTS Beispiele
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-beispiele">
     9.4.4. IN Beispiele
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#all-und-any-beispiele">
     9.4.5. ALL und ANY Beispiele
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bedingungen-mit-tupeln">
     9.4.6. Bedingungen mit Tupeln
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#subanfragen-in-from-klausel">
     9.4.7. Subanfragen in FROM-Klausel
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#korrelierte-subanfragen">
     9.4.8. Korrelierte Subanfragen
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#operationen-auf-einer-relation">
   9.5. Operationen auf einer Relation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#duplikateliminierung">
     9.5.1. Duplikateliminierung
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aggregation">
     9.5.2. Aggregation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#aggregation-beispiele">
       9.5.2.1. Aggregation – Beispiele
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gruppierung-aggregation-und-null">
     9.5.3. Gruppierung, Aggregation und NULL
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gruppierung">
     9.5.4. Gruppierung
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#zusammenfassung-sql">
     9.5.5. Zusammenfassung SQL
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#datenbearbeitung-dml">
   9.6. Datenbearbeitung(DML)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#einfugen">
     9.6.1. Einfügen
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#einfugen-per-anfrage">
       9.6.1.1. Einfügen per Anfrage
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ausfuhrungsreihenfolge-beim-einfugen">
     9.6.2. Ausführungsreihenfolge beim Einfügen
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bulk-insert">
       9.6.2.1. Bulk insert
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loschen">
     9.6.3. Löschen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verandern-update">
     9.6.4. Verändern (update)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schemata-ddl">
   9.7. Schemata(DDL)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#datentypen">
     9.7.1. Datentypen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uberblick-db2-datentypen">
     9.7.2. Überblick DB2 Datentypen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tabellen">
     9.7.3. Tabellen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#default-werte">
     9.7.4. Default-Werte
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#indizes">
     9.7.5. Indizes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indexwahl">
       9.7.5.1. Indexwahl
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indexwahl-voruberlegungen">
       9.7.5.2. Indexwahl – Vorüberlegungen
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indexwahl-beispiel">
       9.7.5.3. Indexwahl – Beispiel
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       9.7.5.4. Indexwahl – Beispiel
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verteilung-in-imdb-real-world-daten-stand-ca-2010">
     9.7.6. Verteilung in IMDB (Real-world Daten, Stand ca. 2010)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sichten">
   9.8. Sichten
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sichten-in-sql-erstellen">
     9.8.1. Sichten in SQL erstellen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anfragen-an-sichten">
     9.8.2. Anfragen an Sichten
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#diskussion">
     9.8.3. Diskussion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#updates-auf-sichten">
     9.8.4. Updates auf Sichten
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#einfugen-auf-sichten-beispiel">
     9.8.5. Einfügen auf Sichten – Beispiel
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loschen-und-updates-auf-sichten">
     9.8.6. Löschen und Updates auf Sichten
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tupelmigration">
     9.8.7. Tupelmigration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anfrageplanung-mit-sichten">
     9.8.8. Anfrageplanung mit Sichten
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#materialisierte-sichten">
     9.8.9. Materialisierte Sichten
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mv-themen-und-probleme">
       9.8.9.1. MV – Themen und Probleme
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#answering-queries-using-views">
     9.8.10. „Answering Queries using Views“
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#zusammenfassung">
   9.9. Zusammenfassung
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sql-trainer">
   9.10. SQL-Trainer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fragen">
   9.11. Fragen
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>SQL</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#einfuhrung">
   9.1. Einführung
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#motivation-fur-sql">
     9.1.1. Motivation für SQL
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sql-historie">
     9.1.2. SQL-Historie
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sql-standardisierung">
     9.1.3. SQL – Standardisierung
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sql-2008-struktur">
     9.1.4. SQL:2008 Struktur
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#einfach-anfragen">
   9.2. Einfach Anfragen
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#select-from-where">
     9.2.1. SELECT … FROM … WHERE …
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#beispielschema">
     9.2.2. Beispielschema
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#projektion-in-sql-select-pi">
     9.2.3. Projektion in SQL (SELECT,
     <span class="math notranslate nohighlight">
      \(\pi\)
     </span>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selektion-in-sql-where-sigma">
     9.2.4. Selektion in SQL (WHERE,
     <span class="math notranslate nohighlight">
      \(\sigma\)
     </span>
     )
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stringvergleiche">
     9.2.5. Stringvergleiche
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#string-mustervergleiche-mit-like">
     9.2.6. String-Mustervergleiche mit LIKE
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#datum-und-uhrzeit">
     9.2.7. Datum und Uhrzeit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nullwerte">
     9.2.8. Nullwerte
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wahrheitswerte">
     9.2.9. Wahrheitswerte
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sortierung">
     9.2.10. Sortierung
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#anfragen-uber-mehrere-relationen">
   9.3. Anfragen über mehrere Relationen
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kreuzprodukt-und-join">
     9.3.1. Kreuzprodukt und Join
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uneindeutige-attributnamen">
     9.3.2. Uneindeutige Attributnamen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tupelvariablen">
     9.3.3. Tupelvariablen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tupelvariablen-selfjoin">
     9.3.4. Tupelvariablen-Selfjoin
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpretation-von-anfragen">
     9.3.5. Interpretation von Anfragen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#joins">
     9.3.6. Joins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-tpc-h-schema">
     9.3.7. The TPC-H Schema
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tpc-query-minimum-cost-supplier">
       9.3.7.1. TPC Query - Minimum Cost Supplier
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-tpc-h-universal-table">
       9.3.7.2. The TPC-H Universal Table
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#outer-joins">
     9.3.8. Outer Joins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kreuzprodukt">
     9.3.9. Kreuzprodukt
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mengenoperationen-in-sql">
     9.3.10. Mengenoperationen in SQL
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#schnittmenge-intersect">
       9.3.10.1. Schnittmenge: INTERSECT
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#vereinigung-union">
       9.3.10.2. Vereinigung: UNION
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#differenz-except-minus">
       9.3.10.3. Differenz: EXCEPT/MINUS
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#klammerung">
       9.3.10.4. Klammerung
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#zusammenfassung-der-semantik">
     9.3.11. Zusammenfassung der Semantik
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#geschachtelte-anfragen">
   9.4. Geschachtelte Anfragen
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skalare-subanfragen">
     9.4.1. Skalare Subanfragen
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skalare-subanfragen-beispiel">
       9.4.1.1. Skalare Subanfragen – Beispiel
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bedingungen-mit-relationen">
     9.4.2. Bedingungen mit Relationen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exists-beispiele">
     9.4.3. EXISTS Beispiele
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-beispiele">
     9.4.4. IN Beispiele
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#all-und-any-beispiele">
     9.4.5. ALL und ANY Beispiele
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bedingungen-mit-tupeln">
     9.4.6. Bedingungen mit Tupeln
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#subanfragen-in-from-klausel">
     9.4.7. Subanfragen in FROM-Klausel
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#korrelierte-subanfragen">
     9.4.8. Korrelierte Subanfragen
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#operationen-auf-einer-relation">
   9.5. Operationen auf einer Relation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#duplikateliminierung">
     9.5.1. Duplikateliminierung
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aggregation">
     9.5.2. Aggregation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#aggregation-beispiele">
       9.5.2.1. Aggregation – Beispiele
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gruppierung-aggregation-und-null">
     9.5.3. Gruppierung, Aggregation und NULL
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gruppierung">
     9.5.4. Gruppierung
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#zusammenfassung-sql">
     9.5.5. Zusammenfassung SQL
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#datenbearbeitung-dml">
   9.6. Datenbearbeitung(DML)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#einfugen">
     9.6.1. Einfügen
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#einfugen-per-anfrage">
       9.6.1.1. Einfügen per Anfrage
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ausfuhrungsreihenfolge-beim-einfugen">
     9.6.2. Ausführungsreihenfolge beim Einfügen
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bulk-insert">
       9.6.2.1. Bulk insert
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loschen">
     9.6.3. Löschen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verandern-update">
     9.6.4. Verändern (update)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schemata-ddl">
   9.7. Schemata(DDL)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#datentypen">
     9.7.1. Datentypen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uberblick-db2-datentypen">
     9.7.2. Überblick DB2 Datentypen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tabellen">
     9.7.3. Tabellen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#default-werte">
     9.7.4. Default-Werte
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#indizes">
     9.7.5. Indizes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indexwahl">
       9.7.5.1. Indexwahl
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indexwahl-voruberlegungen">
       9.7.5.2. Indexwahl – Vorüberlegungen
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#indexwahl-beispiel">
       9.7.5.3. Indexwahl – Beispiel
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       9.7.5.4. Indexwahl – Beispiel
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verteilung-in-imdb-real-world-daten-stand-ca-2010">
     9.7.6. Verteilung in IMDB (Real-world Daten, Stand ca. 2010)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sichten">
   9.8. Sichten
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sichten-in-sql-erstellen">
     9.8.1. Sichten in SQL erstellen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anfragen-an-sichten">
     9.8.2. Anfragen an Sichten
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#diskussion">
     9.8.3. Diskussion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#updates-auf-sichten">
     9.8.4. Updates auf Sichten
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#einfugen-auf-sichten-beispiel">
     9.8.5. Einfügen auf Sichten – Beispiel
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loschen-und-updates-auf-sichten">
     9.8.6. Löschen und Updates auf Sichten
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tupelmigration">
     9.8.7. Tupelmigration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anfrageplanung-mit-sichten">
     9.8.8. Anfrageplanung mit Sichten
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#materialisierte-sichten">
     9.8.9. Materialisierte Sichten
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mv-themen-und-probleme">
       9.8.9.1. MV – Themen und Probleme
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#answering-queries-using-views">
     9.8.10. „Answering Queries using Views“
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#zusammenfassung">
   9.9. Zusammenfassung
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sql-trainer">
   9.10. SQL-Trainer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fragen">
   9.11. Fragen
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="sql">
<h1><span class="section-number">9. </span>SQL<a class="headerlink" href="#sql" title="Permalink to this headline">#</a></h1>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="o">%</span><span class="k">load_ext</span> sql
<span class="o">%</span><span class="k">sql</span> sqlite:///filme/filme.db
<span class="o">%</span><span class="k">sql</span> sqlite:///abteilung/abteilung.db
<span class="o">%</span><span class="k">sql</span> sqlite:///buecher/buecher.db
<span class="o">%</span><span class="k">sql</span> sqlite:///lehre/lehre.db
<span class="o">%</span><span class="k">sql</span> sqlite:///rst/rst.db
<span class="o">%</span><span class="k">sql</span> sqlite:///salesDB/salesDB.db
</pre></div>
</div>
</div>
</div>
<section id="einfuhrung">
<h2><span class="section-number">9.1. </span>Einführung<a class="headerlink" href="#einfuhrung" title="Permalink to this headline">#</a></h2>
<p>Aus den vorherigen Kapiteln haben wir gelernt wie wir eine Datenbank auf Papier entwerfen, nun schauen wir uns die in der Realität benutzten technischen Mitteln an, insbesondere die Datenbankanfragesprache SQL.</p>
<section id="motivation-fur-sql">
<h3><span class="section-number">9.1.1. </span>Motivation für SQL<a class="headerlink" href="#motivation-fur-sql" title="Permalink to this headline">#</a></h3>
<p>SQL ist die meist-verbreiteste Datenbankanfragesprache. Es handelt sich hierbei um eine Very-High-Level Language, die Ad-hoc, deklarativ und nicht prozedural / imperativ ist. SQL-Anfragen sich an die relationale Algebra angelehnt. Zusätzlich sind Data definition(DDL) und Data manipulation(DML) mit SQL möglich. Wichtig zu beachten ist noch, dass sowohl Syntax, als auch Funktionalität sich von System zu System leicht unterscheiden können.</p>
</section>
<section id="sql-historie">
<h3><span class="section-number">9.1.2. </span>SQL-Historie<a class="headerlink" href="#sql-historie" title="Permalink to this headline">#</a></h3>
<p>SQL(1982, IBM) entstand durch die Ursprungssprache SEQUEL(1976, IBM Research Labs San Jose). Später entwickelte sich SEQUEL zu SEQUEL2(1976, IBM Research Labs San Jose), welche auf einer der Vorreitern von Datenbanksystemen “System R” benutzt wurde.</p>
<p><img alt="title" src="../_images/historie1.jpg" />
<br>
<img alt="title" src="../_images/historie2.jpg" />
<br>
<img alt="title" src="../_images/historie3.jpg" /></p>
</section>
<section id="sql-standardisierung">
<h3><span class="section-number">9.1.3. </span>SQL – Standardisierung<a class="headerlink" href="#sql-standardisierung" title="Permalink to this headline">#</a></h3>
<p>Im Laufe der Zeit durchlief SQL verschiedene Standardisierungen, die Sie aus der folgenden Auflistung entnehmen können. Trotz der Standardisierung sind Inkompatibilitäten zwischen Systemen der einzelnen Hersteller noch möglich.</p>
<ul class="simple">
<li><p>SQL1 von ANSI als Standard verabschiedet (1986)
<br><br></p></li>
<li><p>SQL1 von der (ISO) als Standard verabschiedet (1987)
<br></p></li>
<li><p>1989 nochmals überarbeitet.
<br> <br></p></li>
<li><p>SQL2 oder SQL-92 von der ISO verabschiedet (1992)
<br> <br></p></li>
<li><p>SQL3 oder SQL:1999 verabschiedet
<br></p></li>
<li><p>Trigger, rekursive Anfragen
<br></p></li>
<li><p>Objektrelationale Erweiterungen
<br> <br></p></li>
<li><p>SQL:2003 von der ISO verabschiedet
<br></p></li>
<li><p>XML-Support durch SQL/XML
<br> <br></p></li>
<li><p>SQL/XML:2006
<br></p></li>
<li><p>XQuery eingebunden
<br> <br></p></li>
<li><p>SQL:2008
<br></p></li>
<li><p>Updates auf Sichten, logisches Löschen (TRUNCATE), …
<br> <br></p></li>
<li><p>SQL:2011
<br></p></li>
<li><p>Adds temporal data (PERIOD FOR)
<br> <br></p></li>
<li><p>SQL:2016
<br></p></li>
<li><p>Adds row pattern matching, polymorphic table functions, JSON.</p></li>
</ul>
</section>
<section id="sql-2008-struktur">
<h3><span class="section-number">9.1.4. </span>SQL:2008 Struktur<a class="headerlink" href="#sql-2008-struktur" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Part 1: Framework (SQL/Framework) – 82 Seiten</p>
<ul>
<li><p>Überblick
<br><br></p></li>
</ul>
</li>
<li><p>Part 2: Foundation (SQL/Foundation) – 1316 Seiten</p>
<ul>
<li><p>Datenmodell, DDL, DML, Abfragen
<br><br></p></li>
</ul>
</li>
<li><p>Part 3: Call-Level Interface (SQL/CLI) – 389 Seiten</p>
<ul>
<li><p>Zugriff auf DBMS mittels Funktionsaufrufen aus anderen Programmiersprachen
<br><br></p></li>
</ul>
</li>
<li><p>Part 4: Persistent Stored Modules (SQL/PSM) – 188 Seiten</p>
<ul>
<li><p>Prozedurale Erweiterungen
<br><br></p></li>
</ul>
</li>
<li><p>Part 9: Management of External Data (SQL/MED) – 484 Seiten</p>
<ul>
<li><p>Neue Datentypen und Funktionen
<br><br></p></li>
</ul>
</li>
<li><p>Part 10: Object Language Bindings (SQL/OLB) – 396 Seiten</p>
<ul>
<li><p>Auch (SQLJ); zur Einbettung von SQL in Java
<br><br></p></li>
</ul>
</li>
<li><p>Part 11: Information and Definition Schemas (SQL/Schemata) – 286 Seiten</p>
<ul>
<li><p>DBMS werden selbst-beschreibend durch normierten Katalog
<br><br></p></li>
</ul>
</li>
<li><p>Part 13: SQL Routines and Types (SQL/JRT) – 198 Seiten</p>
<ul>
<li><p>Externe Java Routinen als „stored procedures“
<br><br></p></li>
</ul>
</li>
<li><p>Part 14: XML-Related Specifications (SQL/XML) – 438 Seiten</p>
<ul>
<li><p>XML Datentyp und Erweiterung von SQL um XQuery</p></li>
</ul>
</li>
</ul>
<p><br><br>
=&gt; Zusammen: 3777 Seiten</p>
</section>
</section>
<section id="einfach-anfragen">
<h2><span class="section-number">9.2. </span>Einfach Anfragen<a class="headerlink" href="#einfach-anfragen" title="Permalink to this headline">#</a></h2>
<p>In diesem Kapitel werden die Grundlagen einer SQL-Anfrage thematisiert. Zuerst wird die SFW-Klausel eingeführt, gefolgt mit grundlegenden Datentypen, Stringvergleichen und abschließend der Sortierung mittels Anfragen.</p>
<section id="select-from-where">
<h3><span class="section-number">9.2.1. </span>SELECT … FROM … WHERE …<a class="headerlink" href="#select-from-where" title="Permalink to this headline">#</a></h3>
<p>SQL-Anfragen folgen meist einer Drei-Zeilen-Struktur aus <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">FROM</span></code>, <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, wobei <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> und <code class="docutils literal notranslate"><span class="pre">FROM</span></code> in jeder SQL-Anfrage enthalten sein müssen. Das Schlüsselwort <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> entspricht dem Projektionsoperator <span class="math notranslate nohighlight">\(\pi\)</span>, den wir aus dem Kapitel Relationale Algebra schon kennengelernt haben. Die <code class="docutils literal notranslate"><span class="pre">FROM</span></code>-Zeile gibt an von welchen Tabellen die Daten stammen sollen. <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> entspricht gewissermaßen dem Selektionsoperator <span class="math notranslate nohighlight">\(\sigma\)</span>, hier werden also Bedingungen an  die Tupel gestellt die diese erfüllen sollen.</p>
<p>Betrachten wir folgendes Beispielschema für Filme, welches aus den vorherigen Kapiteln bekannt sein sollte. Wir möchten nun eine Anfrage formulieren, die uns alle Filme ausgibt, welche von Disney produziert und im Jahre 1990 erschienen sind.</p>
</section>
<section id="beispielschema">
<h3><span class="section-number">9.2.2. </span>Beispielschema<a class="headerlink" href="#beispielschema" title="Permalink to this headline">#</a></h3>
<p><img alt="title" src="../_images/beispielschema.jpg" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT * </span>
<span class="c1">#FROM Film </span>
<span class="c1">#WHERE StudioName = &quot;Disney&quot; AND Jahr= 1990;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM Film WHERE StudioName = &#39;Disney&#39; AND Jahr= 1990&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Ducktales the Movie: Treasure of the Lost Lamp</td>
      <td>1990</td>
      <td>74</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Shipwrecked</td>
      <td>1990</td>
      <td>92</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>2</th>
      <td>The Rescuers Down Under</td>
      <td>1990</td>
      <td>77</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Wir benutzen <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span></code>, wodurch uns alle Attribute der ausgewählten Tabelle ausgegeben werden, alternativ kann man auch <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">Titel,</span> <span class="pre">Jahr,</span> <span class="pre">Laenge...</span></code> machen. Da wir alle Filme ausgeben wollen, schreiben wir <code class="docutils literal notranslate"><span class="pre">FROM</span> <span class="pre">Film</span></code>, da wir Tupel aus der Tabelle <code class="docutils literal notranslate"><span class="pre">Film</span></code> wollen. Zuletzt selektieren wir die Tupel, die <code class="docutils literal notranslate"><span class="pre">StudioName</span> <span class="pre">=</span> <span class="pre">&quot;Disney&quot;</span></code> und <code class="docutils literal notranslate"><span class="pre">Jahr</span> <span class="pre">=</span> <span class="pre">1990</span></code> erfüllen.</p>
<p>In SQL wird Groß- und Kleinschreibung nicht beachtet, sowohl bei Schlüsselwörtern wie <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">FROM</span></code>, <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> usw., als auch bei Attribut- und Relationen.
<br><br>
D.h es gilt also:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">From</span> <span class="o">=</span> <span class="n">FROM</span> <span class="o">=</span> <span class="kn">from</span> <span class="o">=</span> <span class="n">FrOm</span>
</pre></div>
</div>
<br>
Und die folgenden Anfragen sind äquivalent:
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELect</span> <span class="n">vorNAMe</span> <span class="n">fROm</span> <span class="n">fiLM</span>
</pre></div>
</div>
<br>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">vorname</span> <span class="n">FROM</span> <span class="n">film</span>
</pre></div>
</div>
<p><br><br>
Anders ist es natürlich bei Konstanten:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>‘FROM‘ ≠ ‘from‘ ≠ from = FROM
</pre></div>
</div>
<p><br><br>
Trotzdem gilt als Konvention zur Lesbarkeit, dass Schlüsselwörter großgeschrieben werden und Schemaelemente klein.</p>
</section>
<section id="projektion-in-sql-select-pi">
<h3><span class="section-number">9.2.3. </span>Projektion in SQL (SELECT, <span class="math notranslate nohighlight">\(\pi\)</span>)<a class="headerlink" href="#projektion-in-sql-select-pi" title="Permalink to this headline">#</a></h3>
<p>Wir betrachten nun die einzelnen Schlüsselwörter etwas genauer und starten mit der Projektion. In der <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> Klausel werden Attribute von Relationen aufgelistet, die herausprojeziert werden sollen.
<br><br>
Im folgenden Beipiel wollen wir alle Attribute bzw. Spalten aus der Filmrelation ausgeben, der Stern <code class="docutils literal notranslate"><span class="pre">*</span></code> ist hier eine kürzere Schreibweise für alle Attribute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT * </span>
<span class="c1">#FROM Film</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot; SELECT * FROM Film LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Inside Out</td>
      <td>2015</td>
      <td>95</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Toy Story</td>
      <td>1999</td>
      <td>81</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Up</td>
      <td>2009</td>
      <td>96</td>
      <td>TRUE</td>
      <td>Pixar</td>
      <td>4567</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ratatouille</td>
      <td>2007</td>
      <td>111</td>
      <td>TRUE</td>
      <td>Pixar</td>
      <td>4567</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Star Trek</td>
      <td>1979</td>
      <td>132</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lady Bird</td>
      <td>2017</td>
      <td>95</td>
      <td>TRUE</td>
      <td>Scott Rudin Productions</td>
      <td>3456</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Into the Wild</td>
      <td>2007</td>
      <td>148</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>134</td>
      <td>TRUE</td>
      <td>River Road</td>
      <td>4712</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>109</td>
      <td>FALSE</td>
      <td>A24</td>
      <td>1748</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Es ist auch möglich konkret die Attributsnamen aufzulisten, die ausgegeben sollen werden. Im unteren Beispiel, geben wir nur die Spalten <code class="docutils literal notranslate"><span class="pre">Titel</span></code>, <code class="docutils literal notranslate"><span class="pre">Jahr</span></code> und <code class="docutils literal notranslate"><span class="pre">inFarbe</span></code> von der Filmrelation aus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel, Jahr, inFarbe </span>
<span class="c1">#FROM Film</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel, Jahr, inFarbe FROM Film LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>inFarbe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Inside Out</td>
      <td>2015</td>
      <td>TRUE</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Toy Story</td>
      <td>1999</td>
      <td>TRUE</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Up</td>
      <td>2009</td>
      <td>TRUE</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ratatouille</td>
      <td>2007</td>
      <td>TRUE</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Star Wars</td>
      <td>1977</td>
      <td>TRUE</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Star Trek</td>
      <td>1979</td>
      <td>TRUE</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lady Bird</td>
      <td>2017</td>
      <td>TRUE</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Into the Wild</td>
      <td>2007</td>
      <td>TRUE</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>TRUE</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>FALSE</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In der <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> Klausel ist es auch möglich die Attributsnamen in der Ausgabetabelle umzubenennen. Die Ausgabe einer SQL-Anfrage ist immer eine Tabelle. Im unteren Beispiel projezieren wir die Attribute <code class="docutils literal notranslate"><span class="pre">Titel</span></code>, <code class="docutils literal notranslate"><span class="pre">Jahr</span></code> aus der <code class="docutils literal notranslate"><span class="pre">Filmrelation</span></code> und benennen die Attribute in unserer Ausgabetabelle zu <code class="docutils literal notranslate"><span class="pre">Name</span></code>,<code class="docutils literal notranslate"><span class="pre">Zeit</span></code> um.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel AS Name, Jahr AS Zeit </span>
<span class="c1">#FROM Film</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel AS Name, Jahr AS Zeit FROM Film LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Zeit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Inside Out</td>
      <td>2015</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Toy Story</td>
      <td>1999</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Up</td>
      <td>2009</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ratatouille</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Star Wars</td>
      <td>1977</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Star Trek</td>
      <td>1979</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lady Bird</td>
      <td>2017</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Into the Wild</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Brokeback Mountain</td>
      <td>2005</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Lighthouse</td>
      <td>2019</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In der <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>-Klausel ist es auch möglich arithmetische Ausdrücke zu benutzen. Im folgenden Beispiel werden <code class="docutils literal notranslate"><span class="pre">Titel</span></code> und <code class="docutils literal notranslate"><span class="pre">Laenge</span></code> der <code class="docutils literal notranslate"><span class="pre">Filme</span></code> herausprojeziert, wobei die <code class="docutils literal notranslate"><span class="pre">Laenge</span></code> direkt mit einer Konstanten multipliziert wird. Daher wird in der Ausgabetabelle die <code class="docutils literal notranslate"><span class="pre">Laenge</span></code> in <code class="docutils literal notranslate"><span class="pre">Stunden</span></code> und nicht in Minuten angegeben. Dementsprechend haben wir auch das Attribut <code class="docutils literal notranslate"><span class="pre">Laenge</span></code> in <code class="docutils literal notranslate"><span class="pre">Stunden</span></code> mit dem Umbenennungsoperator <code class="docutils literal notranslate"><span class="pre">AS</span></code> umbenannt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel, Laenge * 0.016667 AS Stunden </span>
<span class="c1">#FROM Film</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel, Laenge * 0.016667 AS Stunden FROM Film LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Stunden</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Inside Out</td>
      <td>1.583365</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Toy Story</td>
      <td>1.350027</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Up</td>
      <td>1.600032</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ratatouille</td>
      <td>1.850037</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Star Wars</td>
      <td>2.016707</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Star Trek</td>
      <td>2.200044</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lady Bird</td>
      <td>1.583365</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Into the Wild</td>
      <td>2.466716</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Brokeback Mountain</td>
      <td>2.233378</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Lighthouse</td>
      <td>1.816703</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Zudem ist es auch möglich, sich spezielle Konstanten ausgeben zu lassen. Im unteren Beispiel fügen wir der Ausgabetabelle eine neue Spalte hinzu, mit dem Namen <code class="docutils literal notranslate"><span class="pre">inStunden</span></code>, in der der String ‘std.’ steht</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel, Laenge * 0.016667 AS Stunden, ‘std.‘ AS inStunden </span>
<span class="c1">#FROM Film</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel, Laenge * 0.016667 AS Stunden, &#39;std.&#39; AS inStunden FROM Film LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Stunden</th>
      <th>inStunden</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Inside Out</td>
      <td>1.583365</td>
      <td>std.</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Toy Story</td>
      <td>1.350027</td>
      <td>std.</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Up</td>
      <td>1.600032</td>
      <td>std.</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ratatouille</td>
      <td>1.850037</td>
      <td>std.</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Star Wars</td>
      <td>2.016707</td>
      <td>std.</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Star Trek</td>
      <td>2.200044</td>
      <td>std.</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lady Bird</td>
      <td>1.583365</td>
      <td>std.</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Into the Wild</td>
      <td>2.466716</td>
      <td>std.</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Brokeback Mountain</td>
      <td>2.233378</td>
      <td>std.</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Lighthouse</td>
      <td>1.816703</td>
      <td>std.</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="selektion-in-sql-where-sigma">
<h3><span class="section-number">9.2.4. </span>Selektion in SQL (WHERE, <span class="math notranslate nohighlight">\(\sigma\)</span>)<a class="headerlink" href="#selektion-in-sql-where-sigma" title="Permalink to this headline">#</a></h3>
<p>Die Selektion die wir aus der relationalen Algebra kennen wird in SQL mit dem Schlüsselwort <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> ausgedrückt, nicht mit dem Schlüsselwort <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>. Wie aus anderen Programmiersprachen bekannt, kann man in der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel Bedinungen aufstellen.
<br><br>
Es gibt sechs Vergleichsoperatoren <code class="docutils literal notranslate"><span class="pre">=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>(gleich, ungleich, kleiner, größer, kleiner gleich, größer gleich), hier können Sie links und rechts der Vergleichsoperatoren Konstanten und Attribute einsetzen. Insbesondere ist es auch möglich Attribute in der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel zu vergleichen, die nicht in der <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>- Klausel herausprojeziert werden. Auch im <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> kann man arithmetische Ausdrücke in die Bedingung einbauen wie in diesem Beispiel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">Jahr</span> <span class="o">-</span> <span class="mi">1930</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Jahr</span> <span class="o">-</span> <span class="mi">1930</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">100</span>
</pre></div>
</div>
<p>Und Konstanten und auch Variablen konkatenieren:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>‘Star‘ || ‘Wars‘ 
</pre></div>
</div>
<p>entspricht</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>‘StarWars‘
</pre></div>
</div>
<p>oder ein Beispiel mit Variablen:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Vorname</span> <span class="o">||</span> <span class="s1">&#39; &#39;</span> <span class="o">||</span> <span class="n">Nachname</span> <span class="o">=</span> <span class="s1">&#39;Luke Skywalker&#39;</span>
</pre></div>
</div>
<p>Hier werden die Variablen <code class="docutils literal notranslate"><span class="pre">Vorname</span></code> und <code class="docutils literal notranslate"><span class="pre">Nachname</span></code> mit einer Leerstelle konkateniert und verglichen, ob der String ‘Luke Skywalker’ entspricht.
<br><br>
Das Ergebnis der Vergleichsoperation in SQL ist dann ein Bool’escher Wert, als <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> oder <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>. Dementsprechend können mehrere Vergleichsoperatoren mit <code class="docutils literal notranslate"><span class="pre">AND</span></code>, <code class="docutils literal notranslate"><span class="pre">OR</span></code> und <code class="docutils literal notranslate"><span class="pre">NOT</span></code> verknüpft werden, wobei die Klammerungen auch den bekannten Regeln der Logik entsprechen.
<br><br>
Nur wenn die gesamte <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel zu <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> evaluiert wird, werden die entsprechenden Tupel ausgegeben.</p>
<p>Im unteren Beispiel wollen wir jene Titel aus der Relation <code class="docutils literal notranslate"><span class="pre">Film</span></code> ausgeben, die nach dem Jahr 1970 erschienen und schwarz-weiß sind</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel </span>
<span class="c1">#FROM Film </span>
<span class="c1">#WHERE Jahr &gt; 1970 AND NOT inFarbe;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel FROM Film WHERE Jahr &gt; 1970 AND NOT inFarbe LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Inside Out</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Toy Story</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Up</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ratatouille</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Star Wars</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Star Trek</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lady Bird</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Into the Wild</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Brokeback Mountain</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Lighthouse</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In diesem Beispiel möchten wir wieder alle <code class="docutils literal notranslate"><span class="pre">Filmtitel</span></code> ausgeben, hier aber alle <code class="docutils literal notranslate"><span class="pre">Filme</span></code> die von MGM produziert wurden sind und nach dem Jahr 1970 erschienen sind oder kürzer als 90 min sind.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel </span>
<span class="c1">#FROM Film </span>
<span class="c1">#WHERE (Jahr &gt; 1970 OR Laenge &lt; 90) AND StudioName = &quot;MGM&quot;;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel FROM Film WHERE (Jahr &gt; 1970 OR Laenge &lt; 90) AND StudioName = &#39;MGM&#39;;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>House of Gucci</td>
    </tr>
    <tr>
      <th>1</th>
      <td>James Bond 007: Spectre</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="stringvergleiche">
<h3><span class="section-number">9.2.5. </span>Stringvergleiche<a class="headerlink" href="#stringvergleiche" title="Permalink to this headline">#</a></h3>
<p>In SQL gibt es Datentypen unteranderem die Datentypen Array fester Länge, Buchstabenliste variabler Länge und Konstanten. Es sind viele Vergleiche über Datentypen hinweg erlaubt. In diesem Beispiel vergleichen wir eine Variable mit einer weiteren Variable und einer Stringkonstanten:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>foo _ _ _ _ _ = foo = ‘foo‘
</pre></div>
</div>
<p>Ebenfalls sind lexikographische Vergleiche mit den schon bekannten Vergleichsoperatoren <code class="docutils literal notranslate"><span class="pre">=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>,<code class="docutils literal notranslate"> <span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code> möglich. Je nach verwendeter DBMS werden Sortierreihenfolge mit upper-case/lower-case andere behandelt</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;fodder&#39;</span> <span class="o">&lt;</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;bar&#39;</span> <span class="o">&lt;</span> <span class="s1">&#39;bargain&#39;</span>
</pre></div>
</div>
</section>
<section id="string-mustervergleiche-mit-like">
<h3><span class="section-number">9.2.6. </span>String-Mustervergleiche mit LIKE<a class="headerlink" href="#string-mustervergleiche-mit-like" title="Permalink to this headline">#</a></h3>
<p>Mit dem <code class="docutils literal notranslate"><span class="pre">LIKE</span></code> Operator können Sie Stringteile miteinander vergleichen, also ob ein String einem gewissen Stringmuster folgt. Hierfür gibt es zwei spezielle Zeichen, einmal <code class="docutils literal notranslate"><span class="pre">%</span></code>, welches eine beliebige Sequenz von 0 oder mehr Zeichen entspricht und <code class="docutils literal notranslate"><span class="pre">_</span></code>, welches ein einzelnes beliebiges Zeichen steht. Hierfür ein Beispiel: Wir suchen jene <code class="docutils literal notranslate"><span class="pre">Titel</span></code> aus der <code class="docutils literal notranslate"><span class="pre">Filmrelation</span></code>, wo der <code class="docutils literal notranslate"><span class="pre">Titel</span></code> mit ‘Star’ beginnt, ein Leerzeichen folgt und 4 beliebige Zeichen folgen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel </span>
<span class="c1">#FROM Film WHERE Titel LIKE &quot;Star ____&quot;;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel FROM Film WHERE Titel LIKE &#39;Star ____&#39;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Star Trek</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Star Wars</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Hier suchen wir alle <code class="docutils literal notranslate"><span class="pre">Titel</span></code>, wo das Wort ‘War’ vorkommen muss. Sowohl vor dem ‘War’ als auch nachdem ‘War’ sind beliebige Zeichensequenzen erlaubt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel </span>
<span class="c1">#FROM Film </span>
<span class="c1">#WHERE Titel LIKE &quot;%War%&quot;;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel FROM Film WHERE Titel LIKE &#39;%War%&#39;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Star Wars</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="datum-und-uhrzeit">
<h3><span class="section-number">9.2.7. </span>Datum und Uhrzeit<a class="headerlink" href="#datum-und-uhrzeit" title="Permalink to this headline">#</a></h3>
<p>In SQL gibt es auch Datentypen um Daten und Zeiten darzustellen.Der Datentyp <code class="docutils literal notranslate"><span class="pre">DATE</span></code> stellt ein Datumskonstante dar:
<br></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DATE</span> <span class="pre">‘YYYY-MM-DD‘</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DATE</span> <span class="pre">‘1948-05-14‘</span></code>
<br><br>
Zeitkonstanten werden mit dem Datentyp <code class="docutils literal notranslate"><span class="pre">TIME</span></code> dargestellt:</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIME</span> <span class="pre">‘HH:MM:SS.S‘</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIME</span> <span class="pre">‘15:00:02.5‘</span></code>
<br><br>
Zeitstempel, also eine Kombination aus Datum und Zeit, werden mit dem Datentyp TIMESTAMP dargestellt:
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span> <span class="pre">‘1948-05-14</span> <span class="pre">15:00:02.5‘</span></code>
<br><br>
Auch dieses Datentypen können wieder miteinander ,in Form von Variablen und Konstanten, verglichen werden:
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIME</span> <span class="pre">‘15:00:02.5‘</span> <span class="pre">&lt;</span> <span class="pre">TIME</span> <span class="pre">‘15:02:02.5‘</span></code> ergibt <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>
<br><br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERSCHEINUNGSTAG</span> <span class="pre">&gt;=</span> <span class="pre">DATE</span> <span class="pre">‘1949-11-12‘</span></code></p></li>
</ul>
</section>
<section id="nullwerte">
<h3><span class="section-number">9.2.8. </span>Nullwerte<a class="headerlink" href="#nullwerte" title="Permalink to this headline">#</a></h3>
<p>Nullwerte sind spezielle Datentypen, in SQL wird dieser als <code class="docutils literal notranslate"><span class="pre">NULL</span></code> dargestellt, auf Papier ist auch ⊥ geläufig. Es gibt mehrere Arten einen Nullwert zu interpretieren. Zum einen kann ein Nullwert bedeuten, dass ein Wert unbekannt ist, z.B kann es sein, dass der Geburtstag eines/r Schauspieler*in unbekannt ist. Eine weitere Interpretationsart ist, dass ein Wert eingetragen wurde der unzulässig ist, wie z.B ein Ehegatte eine eines/r Schauspieler*in. Zuletzt  können mit Nullwerten bestimmte Zellen oder Spalten maskiert werden, wie z.B bei einer unterdrückten Telefonnummer.
<br><br>
Bei dem Umgang mit Nullwerten gibt es verschiedene Regeln, die beachtet werden müssen. Wird <code class="docutils literal notranslate"><span class="pre">NULL</span></code> mit arithmetischen Operationen verknüpft, so ergibt sich aus der Verknüpfung wiederum <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Bei Vergleichen mit <code class="docutils literal notranslate"><span class="pre">NULL</span></code> ergibt der Wahrheitswert <code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code> und nicht <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Man muss auch beachten, dass <code class="docutils literal notranslate"><span class="pre">NULL</span></code> keine Konstante ist, sondern <code class="docutils literal notranslate"><span class="pre">NULL</span></code> erscheint als Attributwert, abhängig von dem DBMS gilt <code class="docutils literal notranslate"><span class="pre">NULL</span></code> = <code class="docutils literal notranslate"><span class="pre">NULL</span></code> oder <code class="docutils literal notranslate"><span class="pre">NULL</span></code> <span class="math notranslate nohighlight">\(\neq\)</span> <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.
<br><br>
Beispiele: Sei der Wert von einer Variablen <code class="docutils literal notranslate"><span class="pre">x</span></code> <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Der Ausdruck <code class="docutils literal notranslate"><span class="pre">x+3</span></code> ergibt <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, da <code class="docutils literal notranslate"><span class="pre">x</span></code> <code class="docutils literal notranslate"><span class="pre">NULL</span></code> ist. Der Ausdruck <code class="docutils literal notranslate"><span class="pre">NULL+3</span></code> ist unzulässig und kann so auch nicht geschrieben werden. Der Vergleich <code class="docutils literal notranslate"><span class="pre">x=3</span></code> ergibt <code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code>, auch da <code class="docutils literal notranslate"><span class="pre">x</span></code> <code class="docutils literal notranslate"><span class="pre">NULL</span></code> ist.
<br>
<br>
Weiterhin kann in der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel mit <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NULL</span></code> und <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code> überprüft werden, ob ein Wert <code class="docutils literal notranslate"><span class="pre">NULL</span></code> its. Z.B:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Geburtstag</span> <span class="n">IS</span> <span class="n">NULL</span> 
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Geburtstag</span> <span class="n">IS</span> <span class="n">NOT</span> <span class="n">NULL</span>
</pre></div>
</div>
</section>
<section id="wahrheitswerte">
<h3><span class="section-number">9.2.9. </span>Wahrheitswerte<a class="headerlink" href="#wahrheitswerte" title="Permalink to this headline">#</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>AND</p></th>
<th class="head"><p>true</p></th>
<th class="head"><p>unknown</p></th>
<th class="head"><p>false</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>true</strong></p></td>
<td><p>true</p></td>
<td><p>unknown</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-odd"><td><p><strong>unknown</strong></p></td>
<td><p>unknown</p></td>
<td><p>unknown</p></td>
<td><p>false</p></td>
</tr>
<tr class="row-even"><td><p><strong>false</strong></p></td>
<td><p>false</p></td>
<td><p>false</p></td>
<td><p>false</p></td>
</tr>
</tbody>
</table>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>OR</p></th>
<th class="head"><p>true</p></th>
<th class="head"><p>unknown</p></th>
<th class="head"><p>false</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>true</strong></p></td>
<td><p>true</p></td>
<td><p>true</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-odd"><td><p><strong>unknown</strong></p></td>
<td><p>true</p></td>
<td><p>unknown</p></td>
<td><p>unknown</p></td>
</tr>
<tr class="row-even"><td><p><strong>false</strong></p></td>
<td><p>false</p></td>
<td><p>unknown</p></td>
<td><p>false</p></td>
</tr>
</tbody>
</table>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>NOT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>true</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>unknown</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>false</strong></p></td>
</tr>
</tbody>
</table>
<p>Nehmen wir an <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>=1, <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>=0 und <code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code> = ½. Dann ergeben sich folgende Rechenregeln:
<br>
<code class="docutils literal notranslate"><span class="pre">AND</span></code>: Minimum der beiden Werte
<br>
<code class="docutils literal notranslate"><span class="pre">OR</span></code>: Maximum der beiden Werte
<br>
<code class="docutils literal notranslate"><span class="pre">NOT</span></code>: 1 – Wert
<br><br>
Beispiele:
<br>
<code class="docutils literal notranslate"><span class="pre">TRUE</span> <span class="pre">AND</span> <span class="pre">(FALSE</span> <span class="pre">OR</span> <span class="pre">NOT(UNKNOWN))</span></code>
<br>
= MIN(1, MAX(0, (1 - ½ )))
<br>
= MIN(1, MAX(0, ½ )
<br>
= MIN(1, ½ ) = ½.
<br><br>
Zu beachten bei der Ausführungspriorität: <code class="docutils literal notranslate"><span class="pre">NOT</span></code> vor <code class="docutils literal notranslate"><span class="pre">AND</span></code> vor <code class="docutils literal notranslate"><span class="pre">OR</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT * </span>
<span class="c1">#FROM Film </span>
<span class="c1">#WHERE Laenge &lt;= 90 </span>
<span class="c1">#OR Laenge &gt; 90; --Laenge &lt;= 90 == UNKNOWN und Länge &gt; 90</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM Film WHERE Laenge &lt;= 90 OR Laenge &gt; 90 LIMIT 10; --Laenge &lt;= 90 == UNKNOWN und Länge &gt; 90&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Inside Out</td>
      <td>2015</td>
      <td>95</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Toy Story</td>
      <td>1999</td>
      <td>81</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Up</td>
      <td>2009</td>
      <td>96</td>
      <td>TRUE</td>
      <td>Pixar</td>
      <td>4567</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ratatouille</td>
      <td>2007</td>
      <td>111</td>
      <td>TRUE</td>
      <td>Pixar</td>
      <td>4567</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Star Trek</td>
      <td>1979</td>
      <td>132</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lady Bird</td>
      <td>2017</td>
      <td>95</td>
      <td>TRUE</td>
      <td>Scott Rudin Productions</td>
      <td>3456</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Into the Wild</td>
      <td>2007</td>
      <td>148</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>134</td>
      <td>TRUE</td>
      <td>River Road</td>
      <td>4712</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>109</td>
      <td>FALSE</td>
      <td>A24</td>
      <td>1748</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="sortierung">
<h3><span class="section-number">9.2.10. </span>Sortierung<a class="headerlink" href="#sortierung" title="Permalink to this headline">#</a></h3>
<p>In SQL sind Sortierungen(<code class="docutils literal notranslate"><span class="pre">ASC</span></code> für aufsteigend bzw. <code class="docutils literal notranslate"><span class="pre">DESC</span></code> für absteigend) mit der <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> Klausel möglich, welche an das Ende der Anfrage geschrieben wird. <code class="docutils literal notranslate"><span class="pre">ASC</span></code> wird als default gewählt:
<br><br>
<code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span> <span class="pre">\&lt;Attributliste\&gt;</span> <span class="pre">DESC/ASC</span></code>
<br><br>
Im folgenden Beispiel wollen wir alle Attribute der <code class="docutils literal notranslate"><span class="pre">Filmrelation</span></code> ausgeben, welche von Disney produziert wurden und 1990 erschienen sind. Zusätzlich, soll die Ausgabe zuerst nach dem Attribut <code class="docutils literal notranslate"><span class="pre">Laenge</span></code> und folgend nach dem Attribut <code class="docutils literal notranslate"><span class="pre">Titel</span></code> aufsteigend sortiert werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT * </span>
<span class="c1">#FROM Film </span>
<span class="c1">#WHERE StudioName = &quot;Disney&quot; </span>
<span class="c1">#AND Jahr = 1990 ORDER BY Laenge, Titel;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM Film WHERE StudioName = &#39;Disney&#39; AND Jahr = 1990 ORDER BY Laenge,Titel;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Ducktales the Movie: Treasure of the Lost Lamp</td>
      <td>1990</td>
      <td>74</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>The Rescuers Down Under</td>
      <td>1990</td>
      <td>77</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Shipwrecked</td>
      <td>1990</td>
      <td>92</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Hier wird  zuerst nach <code class="docutils literal notranslate"><span class="pre">Laenge</span></code> aufsteigend sortiert und folgend nach <code class="docutils literal notranslate"><span class="pre">Titel</span></code> aber absteigend.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT * </span>
<span class="c1">#FROM Film </span>
<span class="c1">#WHERE StudioName = &quot;Disney&quot; </span>
<span class="c1">#AND Jahr = 1990 ORDER BY Laenge ASC, Titel DESC;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM Film WHERE StudioName = &#39;Disney&#39; AND Jahr = 1990 ORDER BY Laenge ASC, Titel DESC;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Ducktales the Movie: Treasure of the Lost Lamp</td>
      <td>1990</td>
      <td>74</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>The Rescuers Down Under</td>
      <td>1990</td>
      <td>77</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Shipwrecked</td>
      <td>1990</td>
      <td>92</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="anfragen-uber-mehrere-relationen">
<h2><span class="section-number">9.3. </span>Anfragen über mehrere Relationen<a class="headerlink" href="#anfragen-uber-mehrere-relationen" title="Permalink to this headline">#</a></h2>
<p>Die Hauptstärke der Relationalen Algebra ist die Kombination von Relationen. Erst durch die Kombination mehrerer Relationen sind viele interessante Anfragen möglich. In SQL ist das möglich, indem man die beteiligten Relationen in der <code class="docutils literal notranslate"><span class="pre">FROM</span></code>-Klausel nennt. In diesem Kapitel werden v.A. die verschiedenen Joinvarianten, aber auch das Kreuzprodukt und andere Mengenoperatoren in SQL thematisiert.</p>
<section id="kreuzprodukt-und-join">
<h3><span class="section-number">9.3.1. </span>Kreuzprodukt und Join<a class="headerlink" href="#kreuzprodukt-und-join" title="Permalink to this headline">#</a></h3>
<p>Im folgenden Beispiel haben wir die Relationen <code class="docutils literal notranslate"><span class="pre">Film(Titel,</span> <span class="pre">Jahr,</span> <span class="pre">Länge,</span> <span class="pre">inFarbe,</span> <span class="pre">StudioName,</span> <span class="pre">ProduzentinID)</span></code> und
<code class="docutils literal notranslate"><span class="pre">ManagerIn(Name,</span> <span class="pre">Adresse,</span> <span class="pre">ManagerinID,</span> <span class="pre">Gehalt)</span></code> gegeben. Wir möchten nun alle <code class="docutils literal notranslate"><span class="pre">Namen</span></code> der Manager*Innen ausgeben, die einen Star Wars Film produziert haben. Hierfür müssen die Relationen <code class="docutils literal notranslate"><span class="pre">Film</span></code> und <code class="docutils literal notranslate"><span class="pre">ManagerIn</span></code> gejoint werden. Zuerst bilden wir das Kruezprodukt der beiden Relationen, indem wir in der <code class="docutils literal notranslate"><span class="pre">FROM</span></code>-Klausel die Relationen mit einem Komma getrennt nennen , so wird intern das Kreuzprodukt dieser beiden gebildet. Schließlich wenden  wir noch einmal die Selektionsbedingung an, also dass nur ManagerInnen die einen Star Wars Film produziert haben ausgegeben werden. Und zuletzt noch die Joinbedingung, undzwar dass <code class="docutils literal notranslate"><span class="pre">ProduzentinID</span></code> und <code class="docutils literal notranslate"><span class="pre">ManagerinID</span></code> im Kreuzprodukt übereinstimmen sollen. Falls die beiden Bedinungen erfüllt sind wird ein Ergebnistupel produziert. Hierbei ist noch zu beachten, dass die Reihenfolge der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Bedingungen irrelevant ist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name </span>
<span class="c1">#FROM Film, ManagerIn </span>
<span class="c1">#WHERE Titel = &quot;Star Wars&quot; </span>
<span class="c1">#AND ProduzentinID = ManagerinID; </span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name FROM Film, ManagerIn WHERE Titel = &#39;Star Wars&#39; AND ProduzentinID = ManagerinID&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Paul Golding</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name </span>
<span class="c1">#FROM Film, ManagerIn --Kreuzprodukt</span>
<span class="c1">#WHERE Titel = &quot;Star Wars&quot; --Selektionsbedingung</span>
<span class="c1">#AND ProduzentinID = ManagerinID; --Joinbedingung</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name FROM Film, ManagerIn WHERE Titel = &#39;Star Wars&#39; AND ProduzentinID = ManagerinID&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Paul Golding</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="uneindeutige-attributnamen">
<h3><span class="section-number">9.3.2. </span>Uneindeutige Attributnamen<a class="headerlink" href="#uneindeutige-attributnamen" title="Permalink to this headline">#</a></h3>
<p>In diesem Beispiel haben wir die Relationen <code class="docutils literal notranslate"><span class="pre">SchauspielerIn(Name,</span> <span class="pre">Adresse,</span> <span class="pre">Geschlecht,</span> <span class="pre">Geburtstag)</span></code> und <code class="docutils literal notranslate"><span class="pre">ManagerIn(Name,</span> <span class="pre">Adresse,</span> <span class="pre">ManagerinID,</span> <span class="pre">Gehalt)</span></code> gegeben. Beide Relationen haben ein Attribut namens <code class="docutils literal notranslate"><span class="pre">Name</span></code>. Wir wollen nun die <code class="docutils literal notranslate"><span class="pre">Namen</span></code> der Schauspieler*Innen und Manager*Innen ausgeben, die die selbe Adresse haben. Wie im vorherigen Beispiel, bilden wir wieder das Kreuzprodukt beider. Da nur der Attributname der Relationen uneindeutig wäre, muss in der Anfrage immer ein Präfix vor das Attribut gesetzt werden. Auch bei keiner Uneindeutigkeit, kann man das Präfix schreiben, was manchmal as Lesen von SQL-Anfragen erleichtert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT SchauspielerIn.Name, ManagerIn.Name </span>
<span class="c1">#FROM SchauspielerIn, ManagerIn </span>
<span class="c1">#WHERE SchauspielerIn.Adresse = ManagerIn.Adresse;</span>


<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT SchauspielerIn.Name, ManagerIn.Name FROM SchauspielerIn, ManagerIn WHERE SchauspielerIn.Adresse = ManagerIn.Adresse;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="tupelvariablen">
<h3><span class="section-number">9.3.3. </span>Tupelvariablen<a class="headerlink" href="#tupelvariablen" title="Permalink to this headline">#</a></h3>
<p>In SQL ist es möglich einen Alias für eine Relation innerhalb einer Anfrage festzulegen. Dies ist sinnvoll, um die Tupeln, der beteiligten Relationen eindeutig zu Kennzeichnen, insbesondere wenn eine Relation mehrfach innerhalb einer Anfrage vorkommt. Umbenennung kann ebenfalls sinnvoll sein, um lange Relationennamen abzukürzen, um bessere Lesbarkeit zu schaffen. Ein Beispiel hierfür ist, z.B der Selfjoin im unteren Beispiel ,wo wir Schauspieler suchen, die zusammenleben. Und das Beispiel danach, wo wir Umbennenung zur Verkürzung der Anfrage benutzen.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SchauspielerIn</span> <span class="n">Star2</span>
</pre></div>
</div>
<p>ist äquivalent zu</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SchauspielerIn</span> <span class="n">AS</span> <span class="n">Star2</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Star1.Name, Star2.Name </span>
<span class="c1">#FROM SchauspielerIn Star1, SchauspielerIn Star2 </span>
<span class="c1">#WHERE Star1.Adresse = Star2.Adresse</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Star1.Name, Star2.Name FROM SchauspielerIn Star1, SchauspielerIn Star2 WHERE Star1.Adresse = Star2.Adresse LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arnold Schwarzenegger</td>
      <td>Arnold Schwarzenegger</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Sharon Stone</td>
      <td>Sharon Stone</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Robert Pattinson</td>
      <td>Robert Pattinson</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Scarlet Johansson</td>
      <td>Scarlet Johansson</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Saorise Ronan</td>
      <td>Saorise Ronan</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Jake Gyllenhaal</td>
      <td>Jake Gyllenhaal</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Heath Ledger</td>
      <td>Heath Ledger</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Mark Hamill</td>
      <td>Mark Hamill</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Carrie Fisher</td>
      <td>Carrie Fisher</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Harrison Ford</td>
      <td>Harrison Ford</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT S.Name, M.Name</span>
<span class="c1">#FROM SchauspielerIn S, ManagerIn M</span>
<span class="c1">#WHERE S.Adresse = M.Adresse;</span>


<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT S.Name, M.Name FROM SchauspielerIn S, ManagerIn M WHERE S.Adresse = M.Adresse;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="tupelvariablen-selfjoin">
<h3><span class="section-number">9.3.4. </span>Tupelvariablen-Selfjoin<a class="headerlink" href="#tupelvariablen-selfjoin" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Star1.Name, Star2.Name</span>
<span class="c1">#FROM SchauspielerIn Star1, SchauspielerIn Star2</span>
<span class="c1">#WHERE Star1.Adresse = Star2.Adresse;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Star1.Name, Star2.Name FROM SchauspielerIn Star1, SchauspielerIn Star2 WHERE Star1.Adresse = Star2.Adresse  LIMIT 10;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arnold Schwarzenegger</td>
      <td>Arnold Schwarzenegger</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Sharon Stone</td>
      <td>Sharon Stone</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Robert Pattinson</td>
      <td>Robert Pattinson</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Scarlet Johansson</td>
      <td>Scarlet Johansson</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Saorise Ronan</td>
      <td>Saorise Ronan</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Jake Gyllenhaal</td>
      <td>Jake Gyllenhaal</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Heath Ledger</td>
      <td>Heath Ledger</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Mark Hamill</td>
      <td>Mark Hamill</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Carrie Fisher</td>
      <td>Carrie Fisher</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Harrison Ford</td>
      <td>Harrison Ford</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Damit wir wie in der Ausgabe der obigen Beispiels, keine redundanten Tupel haben, setzten wir zusätzlich noch die Bedingung, dass die <code class="docutils literal notranslate"><span class="pre">Namen</span></code> der <code class="docutils literal notranslate"><span class="pre">Schauspieler\*Innen</span></code> verschieden sein müssen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Star1.Name, Star2.Name</span>
<span class="c1">#FROM SchauspielerIn Star1, SchauspielerIn Star2</span>
<span class="c1">#WHERE Star1.Adresse = Star2.Adresse</span>
<span class="c1">#AND Star1.Name &lt;&gt; Star2.Name;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Star1.Name, Star2.Name FROM SchauspielerIn Star1, SchauspielerIn Star2 WHERE Star1.Adresse = Star2.Adresse AND Star1.Name &lt;&gt; Star2.Name;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Vincent Cassel</td>
      <td>Léa Seydoux</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Cameron Diaz</td>
      <td>Leonardo DiCaprio</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Leonardo DiCaprio</td>
      <td>Cameron Diaz</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Tobey Maguire</td>
      <td>Kirsten Dunst</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Kirsten Dunst</td>
      <td>Tobey Maguire</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Ryan Gosling</td>
      <td>Jared Leto</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Jared Leto</td>
      <td>Ryan Gosling</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Léa Seydoux</td>
      <td>Vincent Cassel</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="interpretation-von-anfragen">
<h3><span class="section-number">9.3.5. </span>Interpretation von Anfragen<a class="headerlink" href="#interpretation-von-anfragen" title="Permalink to this headline">#</a></h3>
<p>Anfragen können auf unterschiedlich Arten und Weisen interpretiert werden. Es gibt drie Interpretationsvarianten für Anfragen mit mehreren Relationen. Mit der Nested Loops(geschachtelte Schleifen) gibt es bei mehreren Tupelvariablen, für jede Variable eine geschachtelte Schleife. Bei der parallelen Zuordnung werden alle Kombinationen parallel bzgl. der Bedingungen geprüft. In der Relationen Algebra wird zuerst das Kreuzprodukt gebildet und dann auf jedes Resulat-Tupel die Selektionsbedingungen angewendet.
<br>
<br>
Im folgenden Beispiel sind die Relationen <code class="docutils literal notranslate"><span class="pre">R(A)</span></code>, <code class="docutils literal notranslate"><span class="pre">S(A)</span></code> und <code class="docutils literal notranslate"><span class="pre">T(A)</span></code> mit dem selben Attribut <code class="docutils literal notranslate"><span class="pre">A</span></code> gegeben. Wir suchen die folgenden Tupel <code class="docutils literal notranslate"><span class="pre">R</span></code>  ∩  (<code class="docutils literal notranslate"><span class="pre">S</span></code>  ∪  <code class="docutils literal notranslate"><span class="pre">T</span></code>) (= (<code class="docutils literal notranslate"><span class="pre">R</span></code>  ∩  <code class="docutils literal notranslate"><span class="pre">S</span></code>)  ∪  (<code class="docutils literal notranslate"><span class="pre">R</span></code>  ∩  <code class="docutils literal notranslate"><span class="pre">T</span></code>) ). Nehmen wir an dass <code class="docutils literal notranslate"><span class="pre">T</span></code> leer sei, das vermeintliche Resultat ist <code class="docutils literal notranslate"><span class="pre">R</span></code>  ∩  <code class="docutils literal notranslate"><span class="pre">S</span></code>. Mit Nested Loops ist das Ergebnis jedoch leer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT R.A</span>
<span class="c1">#FROM R, S, T</span>
<span class="c1">#WHERE R.A = S.A</span>
<span class="c1">#OR R.A = T.A;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT R.A FROM R, S, T WHERE R.A = S.A OR R.A = T.A;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;rst/rst.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Im folgenden Beispiel ist das Ergebnis mit Nested Loops nicht leer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT *</span>
<span class="c1">#FROM</span>
<span class="c1">#(</span>
<span class="c1">#    (SELECT A FROM R)</span>
<span class="c1">#     INTERSECT</span>
<span class="c1">#    (SELECT * FROM</span>
<span class="c1">#     (SELECT A FROM S)</span>
<span class="c1">#      UNION</span>
<span class="c1">#    (SELECT A FROM T)</span>
<span class="c1">#   )</span>
<span class="c1">#)</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM (SELECT A FROM R INTERSECT SELECT * FROM (SELECT A FROM S) UNION SELECT A FROM T)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;rst/rst.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="joins">
<h3><span class="section-number">9.3.6. </span>Joins<a class="headerlink" href="#joins" title="Permalink to this headline">#</a></h3>
<p><img alt="title" src="../_images/joins.jpg" /></p>
<p>Bis hierhin haben wir Joins nur mit Komma zwischen den Relationennamen in der <code class="docutils literal notranslate"><span class="pre">FROM</span></code>-Klausel und der Joinbedingung in der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel kennengelernt. Kreuzprodukte können auch mit <code class="docutils literal notranslate"><span class="pre">CROSS</span> <span class="pre">JOIN</span></code> ausgedrückt werden, z.B <code class="docutils literal notranslate"><span class="pre">Film</span> <span class="pre">CROSS</span> <span class="pre">JOIN</span> <span class="pre">spielt_in</span></code>, hier werden direkt doppelte Attributnamen mit Präfix der Relation schon aufgelöst.
<br><br>
Ein Beispiel für ein Theta-Join finden wir unten.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT * </span>
<span class="c1">#FROM Film JOIN spielt_in ON Titel = FilmTitel </span>
<span class="c1">#AND Jahr = FilmJahr</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM Film JOIN spielt_in ON Titel = FilmTitel AND Jahr = FilmJahr LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
      <th>FilmTitel</th>
      <th>FilmJahr</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
      <td>Star Wars</td>
      <td>1977</td>
      <td>Mark Hamill</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
      <td>Star Wars</td>
      <td>1977</td>
      <td>Harrison Ford</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
      <td>Star Wars</td>
      <td>1977</td>
      <td>Carrie Fisher</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Into the Wild</td>
      <td>2007</td>
      <td>148</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
      <td>Into the Wild</td>
      <td>2007</td>
      <td>Emile Hirsch</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>134</td>
      <td>TRUE</td>
      <td>River Road</td>
      <td>4712</td>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>Jake Gyllenhaal</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>134</td>
      <td>TRUE</td>
      <td>River Road</td>
      <td>4712</td>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>Heath Ledger</td>
    </tr>
    <tr>
      <th>6</th>
      <td>The Dark Knight</td>
      <td>2008</td>
      <td>152</td>
      <td>TRUE</td>
      <td>Warner Bros.</td>
      <td>6035</td>
      <td>The Dark Knight</td>
      <td>2008</td>
      <td>Heath Ledger</td>
    </tr>
    <tr>
      <th>7</th>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>109</td>
      <td>FALSE</td>
      <td>A24</td>
      <td>1748</td>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>Robert Pattinson</td>
    </tr>
    <tr>
      <th>8</th>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>109</td>
      <td>FALSE</td>
      <td>A24</td>
      <td>1748</td>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>Willem Dafoe</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Great Gatsby</td>
      <td>2013</td>
      <td>142</td>
      <td>TRUE</td>
      <td>Village Roadshows</td>
      <td>8634</td>
      <td>The Great Gatsby</td>
      <td>2013</td>
      <td>Leonardo DiCaprio</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Beim <code class="docutils literal notranslate"><span class="pre">JOIN</span></code> werden im Vergleich zum <code class="docutils literal notranslate"><span class="pre">CROSS</span> <span class="pre">JOIN</span></code> die redundanten Attribute eliminiert. Damit das geschieht muss natürlich ein Fremdschlüsselbeziehung vorhanden sein oder die Attributnamen müssen identisch sein. Hier wie im unteren Beispiel gezeigt, werden also <code class="docutils literal notranslate"><span class="pre">FilmTitel</span></code> und <code class="docutils literal notranslate"><span class="pre">FilmJahr</span></code> eliminiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel, Jahr, Laenge, inFarbe, StudioName, ProduzentinID, Name </span>
<span class="c1">#FROM Film JOIN spielt_in ON Titel = FilmTitel </span>
<span class="c1">#AND Jahr = FilmJahr;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel, Jahr, Laenge, inFarbe, StudioName, ProduzentinID, Name FROM Film JOIN spielt_in ON Titel = FilmTitel AND Jahr = FilmJahr LIMIT 10;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
      <td>Mark Hamill</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
      <td>Harrison Ford</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
      <td>Carrie Fisher</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Into the Wild</td>
      <td>2007</td>
      <td>148</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
      <td>Emile Hirsch</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>134</td>
      <td>TRUE</td>
      <td>River Road</td>
      <td>4712</td>
      <td>Jake Gyllenhaal</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>134</td>
      <td>TRUE</td>
      <td>River Road</td>
      <td>4712</td>
      <td>Heath Ledger</td>
    </tr>
    <tr>
      <th>6</th>
      <td>The Dark Knight</td>
      <td>2008</td>
      <td>152</td>
      <td>TRUE</td>
      <td>Warner Bros.</td>
      <td>6035</td>
      <td>Heath Ledger</td>
    </tr>
    <tr>
      <th>7</th>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>109</td>
      <td>FALSE</td>
      <td>A24</td>
      <td>1748</td>
      <td>Robert Pattinson</td>
    </tr>
    <tr>
      <th>8</th>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>109</td>
      <td>FALSE</td>
      <td>A24</td>
      <td>1748</td>
      <td>Willem Dafoe</td>
    </tr>
    <tr>
      <th>9</th>
      <td>The Great Gatsby</td>
      <td>2013</td>
      <td>142</td>
      <td>TRUE</td>
      <td>Village Roadshows</td>
      <td>8634</td>
      <td>Leonardo DiCaprio</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Es ist ebenfalls möglich mehrere Joins hintereinander durchzuführen, wie im Beispiel unten gezeigt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel, Jahr </span>
<span class="c1">#FROM Film JOIN spielt_in ON Titel = FilmTitel </span>
<span class="c1">#AND Jahr = FilmJahr JOIN SchauspielerIn ON spielt_in.Name = SchauspielerIn.Name </span>
<span class="c1">#WHERE Geschlecht = &quot;f&quot;;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel, Jahr FROM Film JOIN spielt_in ON Titel = FilmTitel AND Jahr = FilmJahr JOIN SchauspielerIn ON spielt_in.Name = SchauspielerIn.Name WHERE Geschlecht = &#39;f&#39;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Star Wars</td>
      <td>1977</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mamma Mia!</td>
      <td>2008</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Inside Out</td>
      <td>2015</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Total Recall</td>
      <td>1990</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Spider-Man</td>
      <td>2002</td>
    </tr>
    <tr>
      <th>5</th>
      <td>La La Land</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>6</th>
      <td>House of Gucci</td>
      <td>2021</td>
    </tr>
    <tr>
      <th>7</th>
      <td>James Bond 007: Spectre</td>
      <td>2015</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="the-tpc-h-schema">
<h3><span class="section-number">9.3.7. </span>The TPC-H Schema<a class="headerlink" href="#the-tpc-h-schema" title="Permalink to this headline">#</a></h3>
<p><img alt="title" src="../_images/tpc-h_schema.jpg" /></p>
<p>Das TPC-H ist ein Benchmark, dessen Datensätze zufällig generiert werden. Die Daten sind an Unternehmen und ihren Handelsketten orientiert. Datenbankentwickler*\Innen benutzen TPC-H ,um neu entwickelte Systeme zu testen.<br />
<br><br>
Eine Beispielanfrage für das TPC-H Schema finden Sie unten.</p>
<section id="tpc-query-minimum-cost-supplier">
<h4><span class="section-number">9.3.7.1. </span>TPC Query - Minimum Cost Supplier<a class="headerlink" href="#tpc-query-minimum-cost-supplier" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%sql</span>
<span class="c1">#SELECT s_acctbal, s_name, n_name, p_partkey, p_mfgr, s_address, s_phone,</span>
<span class="c1">#s_comment</span>
<span class="c1">#FROM part, supplier, partsupp, nation, region</span>
<span class="c1">#WHERE p_partkey = ps_partkey AND s_suppkey = ps_suppkey</span>
<span class="c1">#AND p_size = 2 AND p_type like &#39;PROMO PLATED TIN&#39;</span>
<span class="c1">#AND s_nationkey = n_nationkey AND n_regionkey = r_regionkey</span>
<span class="c1">#AND r_name = &#39;EUROPE&#39;</span>
<span class="c1">#AND ps_supplycost =</span>
<span class="c1">#(SELECT min(ps_supplycost)</span>
<span class="c1">#FROM partsupp, supplier, nation, region</span>
<span class="c1">#WHERE p_partkey = ps_partkey AND s_suppkey = ps_suppkey</span>
<span class="c1">#AND s_nationkey = n_nationkey AND n_regionkey = r_regionkey</span>
<span class="c1">#AND r_name = &#39;EUROPE&#39; )</span>
<span class="c1">#ORDER BY s_acctbal desc, n_name, s_name, p_partkey;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT s_acctbal, s_name, n_name, p_partkey, p_mfgr, s_address, s_phone, s_comment FROM part, supplier, partsupp, nation, region WHERE p_partkey = ps_partkey AND s_suppkey = ps_suppkey AND p_size = 2 AND p_type like &#39;PROMO PLATED TIN&#39; AND s_nationkey = n_nationkey AND n_regionkey = r_regionkey AND r_name = &#39;EUROPE&#39; AND ps_supplycost = (SELECT min(ps_supplycost) FROM partsupp, supplier, nation, region WHERE p_partkey = ps_partkey AND s_suppkey = ps_suppkey AND s_nationkey = n_nationkey AND n_regionkey = r_regionkey AND r_name = &#39;EUROPE&#39; ) ORDER BY s_acctbal desc, n_name, s_name, p_partkey;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;salesDB/salesDB&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>S_ACCTBAL</th>
      <th>S_NAME</th>
      <th>N_NAME</th>
      <th>P_PARTKEY</th>
      <th>P_MFGR</th>
      <th>S_ADDRESS</th>
      <th>S_PHONE</th>
      <th>S_COMMENT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1687.81</td>
      <td>Supplier#000000017</td>
      <td>ROMANIA</td>
      <td>16</td>
      <td>Manufacturer#3</td>
      <td>c2d,ESHRSkK3WYnxpgw6aOqN0q</td>
      <td>29-601-884-9219</td>
      <td>eep against the furiously bold ideas. fluffily...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="the-tpc-h-universal-table">
<h4><span class="section-number">9.3.7.2. </span>The TPC-H Universal Table<a class="headerlink" href="#the-tpc-h-universal-table" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%sql</span>
<span class="c1">#SELECT l_linenumber, l_quantity, l_extendedprice, l_discount, l_tax, l_returnflag, l_linestatus, l_shipdate, l_commitdate, l_receiptdate, l_shipinstruct, l_shipmode, l_comment, o_orderkey, o_orderstatus, o_totalprice, o_orderdate, o_orderpriority, o_clerk, o_shippriority, o_comment, ps_availqty, ps_supplycost, ps_comment, p_partkey, p_name, p_mfgr, p_brand, p_type, p_size, p_container, p_retailprice, p_comment, c_custkey, c_name, c_address, c_phone, c_acctbal, c_mktsegment, c_comment, s_suppkey, s_name, s_address, s_phone, s_acctbal, s_comment, n_nationkey, n_name, n_comment, r_regionkey, r_name, r_comment</span>
<span class="c1">#FROM lineitem, orders, partsupp, part, customer, supplier, nation, region</span>
<span class="c1">#WHERE p_partkey = ps_partkey</span>
<span class="c1">#AND s_suppkey = ps_suppkey</span>
<span class="c1">#AND n_nationkey = s_nationkey</span>
<span class="c1">#AND r_regionkey = n_regionkey</span>
<span class="c1">#AND c_custkey = o_custkey</span>
<span class="c1">#AND ps_partkey = l_partkey</span>
<span class="c1">#AND ps_suppkey = l_suppkey</span>
<span class="c1">#AND o_orderkey = l_orderkey</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT l_linenumber, l_quantity, l_extendedprice, l_discount, l_tax, l_returnflag, l_linestatus, l_shipdate, l_commitdate, l_receiptdate, l_shipinstruct, l_shipmode, l_comment, o_orderkey, o_orderstatus, o_totalprice, o_orderdate, o_orderpriority, o_clerk, o_shippriority, o_comment, ps_availqty, ps_supplycost, ps_comment, p_partkey, p_name, p_mfgr, p_brand, p_type, p_size, p_container, p_retailprice, p_comment, c_custkey, c_name, c_address, c_phone, c_acctbal, c_mktsegment, c_comment, s_suppkey, s_name, s_address, s_phone, s_acctbal, s_comment, n_nationkey, n_name, n_comment, r_regionkey, r_name, r_comment FROM lineitem, orders, partsupp, part, customer, supplier, nation, region WHERE p_partkey = ps_partkey AND s_suppkey = ps_suppkey AND n_nationkey = s_nationkey AND r_regionkey = n_regionkey AND c_custkey = o_custkey AND ps_partkey = l_partkey AND ps_suppkey = l_suppkey AND o_orderkey = l_orderkey&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>L_LINENUMBER</th>
      <th>L_QUANTITY</th>
      <th>L_EXTENDEDPRICE</th>
      <th>L_DISCOUNT</th>
      <th>L_TAX</th>
      <th>L_RETURNFLAG</th>
      <th>L_LINESTATUS</th>
      <th>L_SHIPDATE</th>
      <th>L_COMMITDATE</th>
      <th>L_RECEIPTDATE</th>
      <th>...</th>
      <th>S_ADDRESS</th>
      <th>S_PHONE</th>
      <th>S_ACCTBAL</th>
      <th>S_COMMENT</th>
      <th>N_NATIONKEY</th>
      <th>N_NAME</th>
      <th>N_COMMENT</th>
      <th>R_REGIONKEY</th>
      <th>R_NAME</th>
      <th>R_COMMENT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>17</td>
      <td>24710.35</td>
      <td>0.04</td>
      <td>0.02</td>
      <td>N</td>
      <td>O</td>
      <td>1996-03-13</td>
      <td>1996-02-12</td>
      <td>1996-03-22</td>
      <td>...</td>
      <td>wd1djjKXT,4zBm</td>
      <td>26-528-528-1157</td>
      <td>368.76</td>
      <td>yly final accounts could are carefully. fluffi...</td>
      <td>16</td>
      <td>MOZAMBIQUE</td>
      <td>s. ironic, unusual asymptotes wake blithely r</td>
      <td>0</td>
      <td>AFRICA</td>
      <td>lar deposits. blithely final packages cajole. ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>36</td>
      <td>56688.12</td>
      <td>0.09</td>
      <td>0.06</td>
      <td>N</td>
      <td>O</td>
      <td>1996-04-12</td>
      <td>1996-02-28</td>
      <td>1996-04-20</td>
      <td>...</td>
      <td>7f3gN4rP1livII</td>
      <td>28-716-704-8686</td>
      <td>-224.84</td>
      <td>eans. even, silent packages c</td>
      <td>18</td>
      <td>CHINA</td>
      <td>c dependencies. furiously express notornis sle...</td>
      <td>2</td>
      <td>ASIA</td>
      <td>ges. thinly even pinto beans ca</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>8</td>
      <td>12301.04</td>
      <td>0.10</td>
      <td>0.02</td>
      <td>N</td>
      <td>O</td>
      <td>1996-01-29</td>
      <td>1996-03-05</td>
      <td>1996-01-31</td>
      <td>...</td>
      <td>xEcx45vD0FXHT7c9mvWFY</td>
      <td>14-361-296-6426</td>
      <td>2512.41</td>
      <td>ins. fluffily special accounts haggle slyly af</td>
      <td>4</td>
      <td>EGYPT</td>
      <td>y above the carefully unusual theodolites. fin...</td>
      <td>4</td>
      <td>MIDDLE EAST</td>
      <td>uickly special accounts cajole carefully blith...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>28</td>
      <td>25816.56</td>
      <td>0.09</td>
      <td>0.06</td>
      <td>N</td>
      <td>O</td>
      <td>1996-04-21</td>
      <td>1996-03-30</td>
      <td>1996-05-16</td>
      <td>...</td>
      <td>jg0U FNPMQDuyuKvTnLXXaLf3Wl6OtONA6mQlWJ</td>
      <td>24-722-551-9498</td>
      <td>5630.62</td>
      <td>xpress instructions affix. fluffily even reque...</td>
      <td>14</td>
      <td>KENYA</td>
      <td>pending excuses haggle furiously deposits. pe...</td>
      <td>0</td>
      <td>AFRICA</td>
      <td>lar deposits. blithely final packages cajole. ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>24</td>
      <td>27389.76</td>
      <td>0.10</td>
      <td>0.04</td>
      <td>N</td>
      <td>O</td>
      <td>1996-03-30</td>
      <td>1996-03-14</td>
      <td>1996-04-01</td>
      <td>...</td>
      <td>ssetugTcXc096qlD7 2TL5crEEeS3zk</td>
      <td>19-559-422-5776</td>
      <td>5926.41</td>
      <td>ges could have to are ironic deposits. regular...</td>
      <td>9</td>
      <td>INDONESIA</td>
      <td>slyly express asymptotes. regular deposits ha...</td>
      <td>2</td>
      <td>ASIA</td>
      <td>ges. thinly even pinto beans ca</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>60170</th>
      <td>2</td>
      <td>23</td>
      <td>40131.32</td>
      <td>0.05</td>
      <td>0.03</td>
      <td>N</td>
      <td>O</td>
      <td>1995-08-09</td>
      <td>1995-06-08</td>
      <td>1995-08-23</td>
      <td>...</td>
      <td>kERxlLDnlIZJdN66zAPHklyL</td>
      <td>17-713-930-5667</td>
      <td>9759.38</td>
      <td>x. carefully quiet account</td>
      <td>7</td>
      <td>GERMANY</td>
      <td>l platelets. regular accounts x-ray: unusual, ...</td>
      <td>3</td>
      <td>EUROPE</td>
      <td>ly final courts cajole furiously final excuse</td>
    </tr>
    <tr>
      <th>60171</th>
      <td>3</td>
      <td>45</td>
      <td>43112.25</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>R</td>
      <td>F</td>
      <td>1995-05-15</td>
      <td>1995-05-31</td>
      <td>1995-06-03</td>
      <td>...</td>
      <td>NlV0OQyIoPvPkw5AYuWGomX,hgqm1</td>
      <td>15-781-401-3047</td>
      <td>5742.03</td>
      <td>ar deposits. blithely bold accounts against th...</td>
      <td>5</td>
      <td>ETHIOPIA</td>
      <td>ven packages wake quickly. regu</td>
      <td>0</td>
      <td>AFRICA</td>
      <td>lar deposits. blithely final packages cajole. ...</td>
    </tr>
    <tr>
      <th>60172</th>
      <td>4</td>
      <td>29</td>
      <td>33966.83</td>
      <td>0.02</td>
      <td>0.01</td>
      <td>N</td>
      <td>O</td>
      <td>1995-07-25</td>
      <td>1995-06-07</td>
      <td>1995-08-17</td>
      <td>...</td>
      <td>i9v3 EsYCfLKFU6PIt8iihBOHBB37yR7b3GD7Rt</td>
      <td>17-886-101-6083</td>
      <td>6177.35</td>
      <td>onic, special deposits wake furio</td>
      <td>7</td>
      <td>GERMANY</td>
      <td>l platelets. regular accounts x-ray: unusual, ...</td>
      <td>3</td>
      <td>EUROPE</td>
      <td>ly final courts cajole furiously final excuse</td>
    </tr>
    <tr>
      <th>60173</th>
      <td>5</td>
      <td>31</td>
      <td>46052.98</td>
      <td>0.00</td>
      <td>0.05</td>
      <td>N</td>
      <td>O</td>
      <td>1995-08-06</td>
      <td>1995-07-18</td>
      <td>1995-08-19</td>
      <td>...</td>
      <td>YjP5C55zHDXL7LalK27zfQnwejdpin4AMpvh</td>
      <td>32-822-502-4215</td>
      <td>2972.26</td>
      <td>ously express ideas haggle quickly dugouts? fu</td>
      <td>22</td>
      <td>RUSSIA</td>
      <td>requests against the platelets use never acco...</td>
      <td>3</td>
      <td>EUROPE</td>
      <td>ly final courts cajole furiously final excuse</td>
    </tr>
    <tr>
      <th>60174</th>
      <td>6</td>
      <td>45</td>
      <td>78157.35</td>
      <td>0.04</td>
      <td>0.08</td>
      <td>N</td>
      <td>O</td>
      <td>1995-07-23</td>
      <td>1995-07-17</td>
      <td>1995-07-24</td>
      <td>...</td>
      <td>q1,G3Pj6OjIuUYfUoH18BFTKP5aU9bEV3</td>
      <td>11-383-516-1199</td>
      <td>4192.40</td>
      <td>blithely silent requests after the express dep...</td>
      <td>1</td>
      <td>ARGENTINA</td>
      <td>al foxes promise slyly according to the regula...</td>
      <td>1</td>
      <td>AMERICA</td>
      <td>hs use ironic, even requests. s</td>
    </tr>
  </tbody>
</table>
<p>60175 rows × 52 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="outer-joins">
<h3><span class="section-number">9.3.8. </span>Outer Joins<a class="headerlink" href="#outer-joins" title="Permalink to this headline">#</a></h3>
<p>Haben wir erneut die Relationen <code class="docutils literal notranslate"><span class="pre">SchauspielerIn(Name,</span> <span class="pre">Adresse,</span> <span class="pre">Geschlecht,</span> <span class="pre">Geburtstag)</span></code> und <code class="docutils literal notranslate"><span class="pre">ManagerIn(Name,</span> <span class="pre">Adresse,</span> <span class="pre">ManagerinID,</span> <span class="pre">Gehalt)</span></code> gegeben. Wir suchen nun alle Schauspieler*Innen, die zugleich auch Manger*Innen sind.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name, Adresse, Geburtstag, Gehalt </span>
<span class="c1">#FROM SchauspielerIn </span>
<span class="c1">#NATURAL INNER JOIN ManagerIn</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse, Geburtstag, Gehalt FROM SchauspielerIn NATURAL INNER JOIN ManagerIn&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Adresse</th>
      <th>Geburtstag</th>
      <th>Gehalt</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<p>Nun suchen wir alle Schauspieler*Innen und ihre Manager*Inneninfo, falls diese vorhanden ist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#…FROM SchauspielerIn NATURAL LEFT OUTER JOIN ManagerIn</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse, Geburtstag, Gehalt FROM SchauspielerIn NATURAL LEFT OUTER JOIN ManagerIn  LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Adresse</th>
      <th>Geburtstag</th>
      <th>Gehalt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>1947-07-30</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Sharon Stone</td>
      <td>407 N Maple Dr Suite 100, Beverly Hills, CA 90...</td>
      <td>1958-03-10</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Robert Pattinson</td>
      <td>William Morris Endeavor Entertainment, 9601 Wi...</td>
      <td>1986-05-13</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Scarlet Johansson</td>
      <td>15821 Ventura Blvs., Suite 370, Encino CA 9143...</td>
      <td>1984-11-22</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Saorise Ronan</td>
      <td>MacFarlane Chard Associates Ltd., 24 Adelaide ...</td>
      <td>1994-04-12</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Jake Gyllenhaal</td>
      <td>Wilshire Boulevard, 3rd Floor, Beverly Hills, ...</td>
      <td>1980-12-19</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Heath Ledger</td>
      <td>421 Broome Street, Lower Manhatta, New York City</td>
      <td>1979-04-04</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Mark Hamill</td>
      <td>P.O. Box 287, Grand Blanc, MI 48480</td>
      <td>1951-09-25</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Carrie Fisher</td>
      <td>6514 Lankershim Blvd. North Hollywood, California</td>
      <td>1956-10-21</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Harrison Ford</td>
      <td>P.O. Box 49344 Los Angeles, CA 90049-0344</td>
      <td>1942-07-13</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Falls keine Manager*Ininfo vorhanden ist bleibt Gehalt <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<p>Im Folgenden suchen wir Manager*Innen und gegebenenfalls ihre Schauspieler*Inneninfo</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#…FROM SchauspielerIn NATURAL RIGHT OUTER JOIN ManagerIn</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse, Geburtstag, Gehalt FROM ManagerIn NATURAL RIGHT OUTER JOIN SchauspielerIn&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OperationalError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2020,</span> in <span class="ni">SQLiteDatabase.execute</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2019</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2020</span>     <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2021</span>     <span class="k">return</span> <span class="n">cur</span>

<span class="ne">OperationalError</span>: RIGHT and FULL OUTER JOINs are not currently supported

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">DatabaseError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">Input In [9],</span> in <span class="ni">&lt;cell line: 5&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse, Geburtstag, Gehalt FROM ManagerIn NATURAL RIGHT OUTER JOIN SchauspielerIn&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">df</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:399,</span> in <span class="ni">read_sql_query</span><span class="nt">(sql, con, index_col, coerce_float, params, parse_dates, chunksize, dtype)</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span><span class="sd"> Read SQL query into a DataFrame.</span>
<span class="g g-Whitespace">    </span><span class="mi">343</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">396</span><span class="sd"> parameter will be converted to UTC.</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span> <span class="n">pandas_sql</span> <span class="o">=</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">399</span> <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">read_query</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>     <span class="n">sql</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span>     <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span>     <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span>     <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>     <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">407</span> <span class="p">)</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2080,</span> in <span class="ni">SQLiteDatabase.read_query</span><span class="nt">(self, sql, index_col, coerce_float, params, parse_dates, chunksize, dtype)</span>
<span class="g g-Whitespace">   </span><span class="mi">2068</span> <span class="k">def</span> <span class="nf">read_query</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2069</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2070</span>     <span class="n">sql</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2076</span>     <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2077</span> <span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2079</span>     <span class="n">args</span> <span class="o">=</span> <span class="n">_convert_params</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2080</span>     <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2081</span>     <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col_desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2083</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2032,</span> in <span class="ni">SQLiteDatabase.execute</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2029</span>     <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">inner_exc</span>
<span class="g g-Whitespace">   </span><span class="mi">2031</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">DatabaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution failed on sql &#39;</span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2032</span> <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">exc</span>

<span class="ne">DatabaseError</span>: Execution failed on sql &#39;SELECT Name, Adresse, Geburtstag, Gehalt FROM ManagerIn NATURAL RIGHT OUTER JOIN SchauspielerIn&#39;: RIGHT and FULL OUTER JOINs are not currently supported
</pre></div>
</div>
</div>
</div>
<p>Wir sehen, dass <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">OUTER</span> <span class="pre">JOINS</span></code> in sqlite3 nicht direkt möglich sind, da dieser Operator in sqlite3 nicht unterstützt wird. Man kann aber dennoch durch Vertauschen der Reihenfolge der Tabellen, die gewünschte Ausgabe mit <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">OUTER</span> <span class="pre">JOINS</span></code> erzeugen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse, Geburtstag, Gehalt FROM ManagerIn NATURAL LEFT OUTER JOIN SchauspielerIn  LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Adresse</th>
      <th>Geburtstag</th>
      <th>Gehalt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bob Chapek</td>
      <td>500 S Buena Vista St, Burbank, CA 91521</td>
      <td>None</td>
      <td>2667846,08</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Jim Morris</td>
      <td>1200 Park Ave, Emeryville, CA 94608</td>
      <td>None</td>
      <td>16918,33</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Paul Golding</td>
      <td>Pinewood Rd, Slough, Iver SL0 0NH</td>
      <td>None</td>
      <td>10235,4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Bill Pohlad</td>
      <td>5555 Melrose Ave, Los Angeles, CA 90038</td>
      <td>None</td>
      <td>739482,89</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Scott Rudin</td>
      <td>120 W. 45th St., 10th Fl., New York, New York ...</td>
      <td>None</td>
      <td>15758,57</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Daniel Katz</td>
      <td>31 West 27th Street, New York City</td>
      <td>None</td>
      <td>13450,13</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Brian Robbins</td>
      <td>2000 Avenue of the Stars Suite 620-N Los Angeles</td>
      <td>None</td>
      <td>12345,57</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Ann Sarnoff</td>
      <td>10100 Santa Monica Blvd., Los Angeles, CA 90404</td>
      <td>None</td>
      <td>24123,56</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Jim Berk</td>
      <td>3520 Wesley Street, Culver City, CA 90232</td>
      <td>None</td>
      <td>88584,1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Robert Kirby</td>
      <td>Entertainment Rd, Oxenford, Queensland 4210, AU</td>
      <td>None</td>
      <td>45678,9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Falls die Schauspieler*Inneninfo nicht vorhanden ist bleibt Geburtstag <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<p>Nun suchen wir alle Schauspieler*innen und Manager*innen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#…FROM SchauspielerIn NATURAL RIGHT OUTER JOIN ManagerIn</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse, Geburtstag, Gehalt FROM SchauspielerIn NATURAL FULL OUTER JOIN ManagerIn&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OperationalError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2020,</span> in <span class="ni">SQLiteDatabase.execute</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2019</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2020</span>     <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2021</span>     <span class="k">return</span> <span class="n">cur</span>

<span class="ne">OperationalError</span>: RIGHT and FULL OUTER JOINs are not currently supported

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">DatabaseError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">Input In [10],</span> in <span class="ni">&lt;cell line: 5&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse, Geburtstag, Gehalt FROM SchauspielerIn NATURAL FULL OUTER JOIN ManagerIn&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">df</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:399,</span> in <span class="ni">read_sql_query</span><span class="nt">(sql, con, index_col, coerce_float, params, parse_dates, chunksize, dtype)</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span><span class="sd"> Read SQL query into a DataFrame.</span>
<span class="g g-Whitespace">    </span><span class="mi">343</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">396</span><span class="sd"> parameter will be converted to UTC.</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span> <span class="n">pandas_sql</span> <span class="o">=</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">399</span> <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">read_query</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>     <span class="n">sql</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span>     <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span>     <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span>     <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>     <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">407</span> <span class="p">)</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2080,</span> in <span class="ni">SQLiteDatabase.read_query</span><span class="nt">(self, sql, index_col, coerce_float, params, parse_dates, chunksize, dtype)</span>
<span class="g g-Whitespace">   </span><span class="mi">2068</span> <span class="k">def</span> <span class="nf">read_query</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2069</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2070</span>     <span class="n">sql</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2076</span>     <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2077</span> <span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2079</span>     <span class="n">args</span> <span class="o">=</span> <span class="n">_convert_params</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2080</span>     <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2081</span>     <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col_desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2083</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2032,</span> in <span class="ni">SQLiteDatabase.execute</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2029</span>     <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">inner_exc</span>
<span class="g g-Whitespace">   </span><span class="mi">2031</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">DatabaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution failed on sql &#39;</span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2032</span> <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">exc</span>

<span class="ne">DatabaseError</span>: Execution failed on sql &#39;SELECT Name, Adresse, Geburtstag, Gehalt FROM SchauspielerIn NATURAL FULL OUTER JOIN ManagerIn&#39;: RIGHT and FULL OUTER JOINs are not currently supported
</pre></div>
</div>
</div>
</div>
<p>Ebenso werden <code class="docutils literal notranslate"><span class="pre">FULL</span> <span class="pre">OUTER</span> <span class="pre">JOINS</span></code> in sqlite3 nicht unterstützt. Eine alternative Anfrage mit äquivalenter Ausgabe, die nur <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">OUTER</span> <span class="pre">JOINS</span></code> verwendet ist möglich. Ein <code class="docutils literal notranslate"><span class="pre">FULL</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span></code> ist die Vereinigung von dem <code class="docutils literal notranslate"><span class="pre">LEFT</span></code> und <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">OUTER</span> <span class="pre">JOIN</span></code> zweier Tabellen. Wie im vorherigen Beispiel gezeigt, können wir <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">OUTER</span> <span class="pre">JOINS</span></code> mithilfe von <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">OUTER</span> <span class="pre">JOINS</span></code> erzeugen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse, Geburtstag, Gehalt FROM SchauspielerIn NATURAL LEFT OUTER JOIN ManagerIn UNION SELECT Name, Adresse, Geburtstag, Gehalt FROM ManagerIn NATURAL LEFT OUTER JOIN SchauspielerIn LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Adresse</th>
      <th>Geburtstag</th>
      <th>Gehalt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adam Driver</td>
      <td>15260 Ventura Blvd. Suite 900, Sherman Oaks, C...</td>
      <td>1983-11-19</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alan Bruckner</td>
      <td>25 Whitlam Ave Unit 3, Etobicoke, ON M8V2K1</td>
      <td>None</td>
      <td>17853,41</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alan Young</td>
      <td>P.O. Box 14 Rimrock, AZ 86335</td>
      <td>1919-11-19</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ann Sarnoff</td>
      <td>10100 Santa Monica Blvd., Los Angeles, CA 90404</td>
      <td>None</td>
      <td>24123,56</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>1947-07-30</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Bill Pohlad</td>
      <td>5555 Melrose Ave, Los Angeles, CA 90038</td>
      <td>None</td>
      <td>739482,89</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Bob Chapek</td>
      <td>500 S Buena Vista St, Burbank, CA 91521</td>
      <td>None</td>
      <td>2667846,08</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Brian Robbins</td>
      <td>2000 Avenue of the Stars Suite 620-N Los Angeles</td>
      <td>None</td>
      <td>12345,57</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Cameron Diaz</td>
      <td>2000 Avenue Of The Stars, 3rd Floor, North Tow...</td>
      <td>1972-08-30</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Carrie Fisher</td>
      <td>6514 Lankershim Blvd. North Hollywood, California</td>
      <td>1956-10-21</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Falls zu den Schauspieler*Innen die Manager*Inneninfo bzw. Manager*Innen die Schauspieler*Inneninfo fehlt, bleiben <code class="docutils literal notranslate"><span class="pre">Geburtstag</span></code> oder <code class="docutils literal notranslate"><span class="pre">Gehalt</span></code> gegebenenfalls leer.</p>
<p>Der Unterschied von <code class="docutils literal notranslate"><span class="pre">FULL</span> <span class="pre">OUTER</span> <span class="pre">JOINS</span></code> zu <code class="docutils literal notranslate"><span class="pre">UNION</span></code> ist, dass nur eine Zeile pro Person ausgegeben wird.</p>
</section>
<section id="kreuzprodukt">
<h3><span class="section-number">9.3.9. </span>Kreuzprodukt<a class="headerlink" href="#kreuzprodukt" title="Permalink to this headline">#</a></h3>
<p>Wie aus der Relationalen Algebra bekannt bildet das Kreuzprodukt alle Paare aus Tupeln den beteiligten Relationen. In SQL können Kreuzprodukte mit <code class="docutils literal notranslate"><span class="pre">CROSS</span> <span class="pre">JOIN</span></code> gebildet werden, wie unten gezeigt oder auch mit Komma zwischen den beteiligten Relationen in der <code class="docutils literal notranslate"><span class="pre">FROM</span></code>-Klausel, wie ein Beispiel weiter gezeigt wird. Kreuzprodukte werden in der Regel selten verwendet, sie sind aber der Grundbaustein für Joins.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT * </span>
<span class="c1">#FROM SchauspielerIn CROSS JOIN Film</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM SchauspielerIn CROSS JOIN Film LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Adresse</th>
      <th>Geschlecht</th>
      <th>Geburtstag</th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Inside Out</td>
      <td>2015</td>
      <td>95</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Toy Story</td>
      <td>1999</td>
      <td>81</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Up</td>
      <td>2009</td>
      <td>96</td>
      <td>TRUE</td>
      <td>Pixar</td>
      <td>4567</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Ratatouille</td>
      <td>2007</td>
      <td>111</td>
      <td>TRUE</td>
      <td>Pixar</td>
      <td>4567</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Star Trek</td>
      <td>1979</td>
      <td>132</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Lady Bird</td>
      <td>2017</td>
      <td>95</td>
      <td>TRUE</td>
      <td>Scott Rudin Productions</td>
      <td>3456</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Into the Wild</td>
      <td>2007</td>
      <td>148</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>134</td>
      <td>TRUE</td>
      <td>River Road</td>
      <td>4712</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>109</td>
      <td>FALSE</td>
      <td>A24</td>
      <td>1748</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT * </span>
<span class="c1">#FROM SchauspielerIn, Film</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM SchauspielerIn, Film LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Adresse</th>
      <th>Geschlecht</th>
      <th>Geburtstag</th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Inside Out</td>
      <td>2015</td>
      <td>95</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Toy Story</td>
      <td>1999</td>
      <td>81</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Up</td>
      <td>2009</td>
      <td>96</td>
      <td>TRUE</td>
      <td>Pixar</td>
      <td>4567</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Ratatouille</td>
      <td>2007</td>
      <td>111</td>
      <td>TRUE</td>
      <td>Pixar</td>
      <td>4567</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Star Wars</td>
      <td>1977</td>
      <td>121</td>
      <td>TRUE</td>
      <td>Pinewood</td>
      <td>78910</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Star Trek</td>
      <td>1979</td>
      <td>132</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Lady Bird</td>
      <td>2017</td>
      <td>95</td>
      <td>TRUE</td>
      <td>Scott Rudin Productions</td>
      <td>3456</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Into the Wild</td>
      <td>2007</td>
      <td>148</td>
      <td>TRUE</td>
      <td>Paramount</td>
      <td>6789</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>Brokeback Mountain</td>
      <td>2005</td>
      <td>134</td>
      <td>TRUE</td>
      <td>River Road</td>
      <td>4712</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
      <td>m</td>
      <td>1947-07-30</td>
      <td>The Lighthouse</td>
      <td>2019</td>
      <td>109</td>
      <td>FALSE</td>
      <td>A24</td>
      <td>1748</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="mengenoperationen-in-sql">
<h3><span class="section-number">9.3.10. </span>Mengenoperationen in SQL<a class="headerlink" href="#mengenoperationen-in-sql" title="Permalink to this headline">#</a></h3>
<p>Die Mengenoperationen <code class="docutils literal notranslate"><span class="pre">UNION</span></code>(Vereinigung), <code class="docutils literal notranslate"><span class="pre">INTERSECT</span></code>(Schnittmenge) und <code class="docutils literal notranslate"><span class="pre">EXCEPT/MINUS</span></code>(Differenz) können nur zwischen geklammertern Anfrageergebnissen benutzt werden, die das selbe Schema besitzen. Sobald einer dieser Operationen verwendet wird, wird implizit Mengensemantik verwendet. Möchte man Multimengensemantik haben, so müssen die Operatoren <code class="docutils literal notranslate"><span class="pre">UNION</span> <span class="pre">ALL</span></code>, <code class="docutils literal notranslate"><span class="pre">INTERSECT</span> <span class="pre">ALL</span></code> und <code class="docutils literal notranslate"><span class="pre">EXCEPT/MINUS</span> <span class="pre">ALL</span></code> verwendet werden. Das bietet sich an, wenn die Semantik egal ist oder die Mengeneigenschaft von Input und Output bereits bekannt ist.</p>
<section id="schnittmenge-intersect">
<h4><span class="section-number">9.3.10.1. </span>Schnittmenge: INTERSECT<a class="headerlink" href="#schnittmenge-intersect" title="Permalink to this headline">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">INTERSECT</span></code> entspricht dem logischen „und“. Im Folgenden suchen wir die Schnittmenge zwischen den <code class="docutils literal notranslate"><span class="pre">Namen</span></code> und <code class="docutils literal notranslate"><span class="pre">Adressen</span></code> der Schauspieler*Innen und den Mangager*Innen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#(SELECT Name, Adresse FROM SchauspielerIn) INTERSECT (SELECT Name, Adresse FROM ManagerIn);</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse FROM SchauspielerIn INTERSECT SELECT Name, Adresse FROM ManagerIn&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Adresse</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<p>In diesem Beispiel suchen wir die Schnittmenge zwischen den <code class="docutils literal notranslate"><span class="pre">Namen</span></code> und <code class="docutils literal notranslate"><span class="pre">Adressen</span></code> der  weiblichen Schauspieler*Innen und den Mangager*Innen, die ein Gehalt größer als 1000000 haben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%sql (SELECT Name, Adresse FROM SchauspielerIn WHERE Geschlecht = &quot;f&quot;) INTERSECT (SELECT Name, Adresse FROM ManagerIn WHERE Gehalt &gt; 1000000)</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse FROM SchauspielerIn WHERE Geschlecht = &#39;f&#39; INTERSECT SELECT Name, Adresse FROM ManagerIn WHERE Gehalt &gt; 1000000&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Adresse</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="vereinigung-union">
<h4><span class="section-number">9.3.10.2. </span>Vereinigung: UNION<a class="headerlink" href="#vereinigung-union" title="Permalink to this headline">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">UNION</span></code> entspricht dem logischen „oder“. Im unteren Beispiel geben wir alle <code class="docutils literal notranslate"><span class="pre">Namen</span></code> und <code class="docutils literal notranslate"><span class="pre">Adressen</span></code> der Schauspieler*Innen und den Mangager*Innen aus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#(SELECT Name, Adresse FROM SchauspielerIn) UNION (SELECT Name, Adresse FROM ManagerIn);</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Adresse FROM SchauspielerIn UNION SELECT Name, Adresse FROM ManagerIn LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Adresse</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adam Driver</td>
      <td>15260 Ventura Blvd. Suite 900, Sherman Oaks, C...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alan Bruckner</td>
      <td>25 Whitlam Ave Unit 3, Etobicoke, ON M8V2K1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alan Young</td>
      <td>P.O. Box 14 Rimrock, AZ 86335</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ann Sarnoff</td>
      <td>10100 Santa Monica Blvd., Los Angeles, CA 90404</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arnold Schwarzenegger</td>
      <td>3110 Main Street, Suite 300, Santa Monica, CA ...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Bill Pohlad</td>
      <td>5555 Melrose Ave, Los Angeles, CA 90038</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Bob Chapek</td>
      <td>500 S Buena Vista St, Burbank, CA 91521</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Brian Robbins</td>
      <td>2000 Avenue of the Stars Suite 620-N Los Angeles</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Cameron Diaz</td>
      <td>2000 Avenue Of The Stars, 3rd Floor, North Tow...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Carrie Fisher</td>
      <td>6514 Lankershim Blvd. North Hollywood, California</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="differenz-except-minus">
<h4><span class="section-number">9.3.10.3. </span>Differenz: EXCEPT/MINUS<a class="headerlink" href="#differenz-except-minus" title="Permalink to this headline">#</a></h4>
<p>Im unteren Beispiel suchen wir den <code class="docutils literal notranslate"><span class="pre">Titel</span></code> und das <code class="docutils literal notranslate"><span class="pre">Jahr</span></code> jener Filme die in der <code class="docutils literal notranslate"><span class="pre">Film</span></code>-Relation vorkommen, aber nicht in der <code class="docutils literal notranslate"><span class="pre">spielt_in</span></code>-Relation. Damit diese Anfrage funktioniert, muss Umbenennung benutzt werden, da die beiden Mengen sonst nicht das selbe Schema besitzten.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#(SELECT Titel, Jahr FROM Film) EXCEPT (SELECT FilmTitel AS Titel, FilmJahr AS Jahr FROM spielt_in) </span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel, Jahr FROM Film EXCEPT SELECT FilmTitel AS Titel, FilmJahr AS Jahr FROM spielt_in&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Gone with the Wind</td>
      <td>1939</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ratatouille</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Roma</td>
      <td>2018</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Shipwrecked</td>
      <td>1990</td>
    </tr>
    <tr>
      <th>4</th>
      <td>The Rescuers Down Under</td>
      <td>1990</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Toy Story</td>
      <td>1999</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="klammerung">
<h4><span class="section-number">9.3.10.4. </span>Klammerung<a class="headerlink" href="#klammerung" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT *</span>
<span class="c1">#FROM</span>
<span class="c1">#(</span>
<span class="c1">#    (SELECT A FROM R)</span>
<span class="c1">#     INTERSECT</span>
<span class="c1">#    (SELECT * FROM</span>
<span class="c1">#     (SELECT A FROM S)</span>
<span class="c1">#      UNION</span>
<span class="c1">#    (SELECT A FROM T)</span>
<span class="c1">#   )</span>
<span class="c1">#)</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM (SELECT A FROM R INTERSECT SELECT * FROM (SELECT A FROM S) UNION SELECT A FROM T)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;rst/rst.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6</td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="zusammenfassung-der-semantik">
<h3><span class="section-number">9.3.11. </span>Zusammenfassung der Semantik<a class="headerlink" href="#zusammenfassung-der-semantik" title="Permalink to this headline">#</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>R1</p></th>
<th class="head"><p>R2</p></th>
<th class="head"><p>UNION ALL</p></th>
<th class="head"><p>UNION</p></th>
<th class="head"><p>EXCEPT ALL</p></th>
<th class="head"><p>EXCEPT</p></th>
<th class="head"><p>INTERSECT ALL</p></th>
<th class="head"><p>INTERSECT</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
<td><p>5</p></td>
<td><p>1</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>3</p></td>
<td><p>1</p></td>
<td><p>3</p></td>
<td><p>2</p></td>
<td><p>﻿</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>3</p></td>
<td><p>1</p></td>
<td><p>4</p></td>
<td><p>2</p></td>
<td><p>﻿</p></td>
<td><p>4</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>3</p></td>
<td><p>1</p></td>
<td><p>5</p></td>
<td><p>4</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>3</p></td>
<td><p>2</p></td>
<td><p>﻿</p></td>
<td><p>5</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>4</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>﻿</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>﻿</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>﻿</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>﻿</p></td>
<td><p>﻿</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>﻿</p></td>
<td><p>﻿</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>﻿</p></td>
<td><p>﻿</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>﻿</p></td>
<td><p>﻿</p></td>
<td><p>4</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>﻿</p></td>
<td><p>﻿</p></td>
<td><p>4</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>﻿</p></td>
<td><p>﻿</p></td>
<td><p>4</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>﻿</p></td>
<td><p>﻿</p></td>
<td><p>5</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="geschachtelte-anfragen">
<h2><span class="section-number">9.4. </span>Geschachtelte Anfragen<a class="headerlink" href="#geschachtelte-anfragen" title="Permalink to this headline">#</a></h2>
<p>In vorherigen Beispielen haben wir schon geschachtelte Anfragen gesehen, nun betrachten wir diese etwas genauer. Eine Anfrage kann Teil einer anderen, theoretisch beliebig tief geschachtelten Anfrage sein. Hier gibt es drei verschiedene Varianten:
<br></p>
<ol class="simple">
<li><p>Die Subanfrage erzeugt einen einzigen Wert, der in der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel mit einem anderen Wert verglichen werden kann.</p></li>
<li><p>Die Subanfrage erzeugt eine Relation, die auf verschiedene Weise in der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel verwendet werden kann.</p></li>
<li><p>Die Subanfrage erzeugt eine Relation, die in der <code class="docutils literal notranslate"><span class="pre">FROM</span></code> Klausel (sozusagen als weitere Datenquelle) verwendet werden kann. – Wie jede andere normale Relation</p></li>
</ol>
<section id="skalare-subanfragen">
<h3><span class="section-number">9.4.1. </span>Skalare Subanfragen<a class="headerlink" href="#skalare-subanfragen" title="Permalink to this headline">#</a></h3>
<p>Bei der ersten der drei Varianten von geschachtelten Anfrage, handelt es sich um skalare Subanfragen. Allgemeine Anfragen produzieren Relationen, mit mehreren Attributen, wo Zugriff auf ein bestimmtes Attribut auch möglich ist. Bei skalaren Subanfragen wird (garantiert) maximal nur ein Tupel und Projektion auf nur ein Attribut ausgegeben. Das Ergbenis einer skalaren Anfrage ist entweder genau ein Wert, der dann wie eine Konstante verwendet werden kann, oder wenn keine Zeilen gefunden werden, ist das Ergebnis der skalaren Anfrage <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.
<br>
<br>
Wir haben im Folgenden Beispiel die Relationen <code class="docutils literal notranslate"><span class="pre">ManagerIn(Name,</span> <span class="pre">Adresse,</span> <span class="pre">ManagerinID,</span> <span class="pre">Gehalt)</span></code> und <code class="docutils literal notranslate"><span class="pre">Film(Titel,</span> <span class="pre">Jahr,</span> <span class="pre">Länge,</span> <span class="pre">inFarbe,</span> <span class="pre">StudioName,</span> <span class="pre">ProduzentinID)</span></code> gegeben. Wir suchen nun den Produzent von Star Wars auf zwei Wegen, wobei garantiert ist, dass es nur einen Produzenten gibt. Zuerst suchen wir ,mithilfe einer allgemeinen Anfrage, unter allen Filmen jene mit dem <code class="docutils literal notranslate"><span class="pre">Titel</span> <span class="pre">=</span> <span class="pre">'Star</span> <span class="pre">Wars'</span></code> und <code class="docutils literal notranslate"><span class="pre">Jahr</span> <span class="pre">=</span> <span class="pre">1977</span></code>, wo die <code class="docutils literal notranslate"><span class="pre">ProduzentinID</span></code> mit der <code class="docutils literal notranslate"><span class="pre">ManagerinID</span></code> gematcht werden kann. Zuletzt geben wir den <code class="docutils literal notranslate"><span class="pre">Namen</span></code> aus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name </span>
<span class="c1">#FROM Film, ManagerIn </span>
<span class="c1">#WHERE Titel = ‘Star Wars‘ </span>
<span class="c1">#AND Jahr = ‘1977‘ </span>
<span class="c1">#AND ProduzentinID = ManagerinID;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name FROM Film, ManagerIn WHERE Titel = &#39;Star Wars&#39; AND Jahr = 1977 AND ProduzentinID = ManagerinID&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Paul Golding</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In dieser Variante suchen wir wieder den Produzent von Star Wars, jedoch mithile einer skalaren Subanfrage. Wir suchen zuerst die <code class="docutils literal notranslate"><span class="pre">ProduzentinID</span></code> des Films, wo <code class="docutils literal notranslate"><span class="pre">Titel</span> <span class="pre">=</span> <span class="pre">'Star</span> <span class="pre">Wars'</span></code> und <code class="docutils literal notranslate"><span class="pre">Jahr</span> <span class="pre">=</span> <span class="pre">1977</span></code> gilt und vergleichen diesen einen mit der <code class="docutils literal notranslate"><span class="pre">ManagerinID</span></code>. Wenn eine identische <code class="docutils literal notranslate"><span class="pre">ManagerinID</span></code> gefunden wurde, geben wir den dazugehörigen <code class="docutils literal notranslate"><span class="pre">Namen</span></code> aus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name FROM ManagerIn </span>
<span class="c1">#WHERE ManagerinID = ( SELECT ProduzentinID FROM Film WHERE Titel = &quot;Star Wars&quot; AND Jahr = 1977 );</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name FROM ManagerIn WHERE ManagerinID = ( SELECT ProduzentinID FROM Film WHERE Titel = &#39;Star Wars&#39; AND Jahr = 1977 );&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Paul Golding</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Das DBMS erwartet maximal ein Tupel als Ergebnis der Teilanfrage, falls kein Tupel in der Subanfrage gefunden wird, ist das Ergebnis <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, falls mehr als ein Tupel gefunden werden, wird ein Laufzeitfehler ausgegeben.</p>
<section id="skalare-subanfragen-beispiel">
<h4><span class="section-number">9.4.1.1. </span>Skalare Subanfragen – Beispiel<a class="headerlink" href="#skalare-subanfragen-beispiel" title="Permalink to this headline">#</a></h4>
<p>Im folgenden Beispiel suchen wir die <code class="docutils literal notranslate"><span class="pre">Abteilungen</span></code>, deren durchschnittliche <code class="docutils literal notranslate"><span class="pre">Bonuszahlungen</span></code> höher sind als deren durchschnittliches <code class="docutils literal notranslate"><span class="pre">Gehalt</span></code>. Wir verwenden zwei Subanfragen, die einmal die durchschnittliche <code class="docutils literal notranslate"><span class="pre">Bonuszahlung</span></code> pro <code class="docutils literal notranslate"><span class="pre">Abteilung</span></code> ausgibt und einmal das durchschnittliche <code class="docutils literal notranslate"><span class="pre">Gehalt</span></code> pro <code class="docutils literal notranslate"><span class="pre">Abteilung</span></code>. Zuletzt vergleichen wir diese Werte miteinander und geben nur die aus, wo die durchschnittliche <code class="docutils literal notranslate"><span class="pre">Bonuszahlung</span></code> höher ist als das jeweilige durchschnittliche <code class="docutils literal notranslate"><span class="pre">Gehalt</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT a.Name, a.Standort </span>
<span class="c1">#FROM Abteilung a </span>
<span class="c1">#WHERE (SELECT AVG(bonus) </span>
<span class="c1">#           FROM personal p </span>
<span class="c1">#           WHERE a.AbtID = p.AbtID)&gt;</span>
<span class="c1">#      (SELECT AVG(gehalt)</span>
<span class="c1">#            FROM personal p</span>
<span class="c1">#               WHERE a.AbtID = p.AbtID)</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT a.Name, a.Standort FROM Abteilung a WHERE (SELECT AVG(bonus) FROM personal p WHERE a.AbtID = p.AbtID)&gt;(SELECT AVG(gehalt) FROM personal p WHERE a.AbtID = p.AbtID)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;abteilung/abteilung.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Standort</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>HR</td>
      <td>Potsdam</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Produktion</td>
      <td>München</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Geschäftsleitung</td>
      <td>Potsdam</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PR</td>
      <td>Potsdam</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Kundendienst</td>
      <td>Hannover</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Buchhaltung</td>
      <td>Potsdam</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In diesem Beispiel suchen wir alle Potsdamer <code class="docutils literal notranslate"><span class="pre">Abteilungen</span></code> mit ihrem jeweiligen Maximalgehalt. Auch hier benutzen wir wieder eine skalare Subanfrage. Wir geben neben der <code class="docutils literal notranslate"><span class="pre">AbteilungsID</span></code>, dem <code class="docutils literal notranslate"><span class="pre">Abteilungsnamen</span></code>, zusätzlich noch das Maximum aller <code class="docutils literal notranslate"><span class="pre">Gehälter</span></code> der jeweiligen Abteilung als <code class="docutils literal notranslate"><span class="pre">maxGehalt</span></code> aus, die sich in Potsdam befindet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT a.AbtID, a.Name,</span>
<span class="c1">#           (SELECT MAX(Gehalt)</span>
<span class="c1">#                FROM Personal p</span>
<span class="c1">#            WHERE a.AbtID = p.AbtID) AS maxGehalt</span>
<span class="c1">#FROM Abteilung a</span>
<span class="c1">#WHERE a.Ort = ‘Potsdam‘</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT a.AbtID, a.Name, (SELECT MAX(Gehalt) FROM Personal p WHERE a.AbtID = p.AbtID) AS maxGehalt FROM Abteilung a WHERE a.Standort = &#39;Potsdam&#39;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;abteilung/abteilung.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AbtID</th>
      <th>Name</th>
      <th>maxGehalt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1111</td>
      <td>HR</td>
      <td>4536</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1234</td>
      <td>IT</td>
      <td>9999</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2850</td>
      <td>Geschäftsleitung</td>
      <td>2774</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4567</td>
      <td>PR</td>
      <td>2846</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9999</td>
      <td>Buchhaltung</td>
      <td>8653</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In dieser Beispielanfrage suchen wir erneut alle Potsdamer <code class="docutils literal notranslate"><span class="pre">Abteilungen</span></code> mit ihrem jeweiligen <code class="docutils literal notranslate"><span class="pre">Maximalgehalt</span></code>. Im Vergleich zu der vorherigen Anfrage, können im Ergebnis dieser Anfrage <code class="docutils literal notranslate"><span class="pre">Abteilungen</span></code> ohne Mitarbeiter nicht vorkommen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT a.AbtID, a.Name, MAX(p.Gehalt) AS maxGehalt</span>
<span class="c1">#FROM Abteilung a, Personal p</span>
<span class="c1">#WHERE a.Ort = ‘Potsdam‘</span>
<span class="c1">#AND a.AbtID = p.AbtID</span>
<span class="c1">#GROUP BY a.AbtID, a.Name</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT a.AbtID, a.Name, MAX(p.Gehalt) AS maxGehalt FROM Abteilung a, Personal p WHERE a.Standort = &#39;Potsdam&#39; AND a.AbtID = p.AbtID GROUP BY a.AbtID, a.Name&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;abteilung/abteilung.db&quot;</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AbtID</th>
      <th>Name</th>
      <th>maxGehalt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1111</td>
      <td>HR</td>
      <td>4536</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1234</td>
      <td>IT</td>
      <td>9999</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2850</td>
      <td>Geschäftsleitung</td>
      <td>2774</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4567</td>
      <td>PR</td>
      <td>2846</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9999</td>
      <td>Buchhaltung</td>
      <td>8653</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="bedingungen-mit-relationen">
<h3><span class="section-number">9.4.2. </span>Bedingungen mit Relationen<a class="headerlink" href="#bedingungen-mit-relationen" title="Permalink to this headline">#</a></h3>
<p>Nun betrachten wir weitere SQL Operatoren auf Relationen die Boole‘sche Werte erzeugen:
<br><br>
Um zu überprüfen ob eine Relation leer oder nicht ist, kann der <code class="docutils literal notranslate"><span class="pre">EXISTS</span></code>-Operator benutzt werden:
<br>
<code class="docutils literal notranslate"><span class="pre">EXISTS</span> <span class="pre">R</span></code> gibt <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> zurück, falls <code class="docutils literal notranslate"><span class="pre">R</span></code> nicht leer ist
<br><br>
Um zu überprüfen ob ein Wert in einer Relation mind. einmal vorkommt, kann der <code class="docutils literal notranslate"><span class="pre">IN</span></code>-Operator benutzt werden:
<br>
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">IN</span> <span class="pre">R</span></code> gibt <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> zurück, falls <code class="docutils literal notranslate"><span class="pre">x</span></code> gleich einem Wert in <code class="docutils literal notranslate"><span class="pre">R</span></code> ist (<code class="docutils literal notranslate"><span class="pre">R</span></code> hat nur ein Attribut)
<br><br>
Um zu überprüfen ob <code class="docutils literal notranslate"><span class="pre">x</span></code> nicht in <code class="docutils literal notranslate"><span class="pre">R</span></code> vorkommt, kann <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">IN</span></code> benutzt werden:
<br>
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">NOT</span> <span class="pre">IN</span> <span class="pre">R</span></code> gibt <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> zurück, falls <code class="docutils literal notranslate"><span class="pre">x</span></code> keinem Wert in <code class="docutils literal notranslate"><span class="pre">R</span></code> gleicht
<br><br>
Um, zu überprüfen ob ein Wert größer als alle Werte in <code class="docutils literal notranslate"><span class="pre">R</span></code> ist, kann der <code class="docutils literal notranslate"><span class="pre">ALL</span></code>-Operator benutzt werden:
<br>
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;</span> <span class="pre">ALL</span> <span class="pre">R</span></code> gibt <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> zurück, falls x größer als jeder Wert in <code class="docutils literal notranslate"><span class="pre">R</span></code> ist (<code class="docutils literal notranslate"><span class="pre">R</span></code> hat nur ein Attribut)
<br>
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;&gt;</span> <span class="pre">ALL</span> <span class="pre">R</span></code> entspricht <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">NOT</span> <span class="pre">IN</span> <span class="pre">R</span></code> bzw. auch <code class="docutils literal notranslate"><span class="pre">NOT(x</span> <span class="pre">in</span> <span class="pre">R)</span></code>
<br>
Natürlich kann man alternativ auch die anderen Vergleichsoperatoren verwenden: <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">=</span></code>
<br><br>
Um zu überprüfen, ob ein Wert größer als mind. ein Wert aus einer Relation ist, kann der <code class="docutils literal notranslate"><span class="pre">ANY</span></code>-Operator benutzt werden
<br>
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;</span> <span class="pre">ANY</span> <span class="pre">R</span></code> gibt <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> zurück, falls <code class="docutils literal notranslate"><span class="pre">x</span></code> größer als mindestens ein Wert in <code class="docutils literal notranslate"><span class="pre">R</span></code> ist (<code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">hat</span></code> nur ein Attribut)
<br>
Auch hier kann man natürlich auch alternativ die anderen Vergleichsoperatoren verwenden: <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">=</span></code>
<br>
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">ANY</span> <span class="pre">R</span></code> entspricht <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">IN</span> <span class="pre">R</span></code>
<br>
Ein alternativer Befehl für <code class="docutils literal notranslate"><span class="pre">ANY</span></code> ist <code class="docutils literal notranslate"><span class="pre">SOME</span></code>
<br><br>
Die Negation mit <code class="docutils literal notranslate"><span class="pre">NOT</span></code>(…) ist immer möglich.</p>
</section>
<section id="exists-beispiele">
<h3><span class="section-number">9.4.3. </span>EXISTS Beispiele<a class="headerlink" href="#exists-beispiele" title="Permalink to this headline">#</a></h3>
<p>Im folgenden Beispiel wollen wir die <code class="docutils literal notranslate"><span class="pre">ISBNs</span></code> aller ausgeliehenen Bücher ausgeben. Hierbei verwenden wir den <code class="docutils literal notranslate"><span class="pre">EXISTS</span></code>-Operator und geben jene <code class="docutils literal notranslate"><span class="pre">ISBNs</span></code> aus der Relation <code class="docutils literal notranslate"><span class="pre">BuchExemplar</span></code> aus, dessen <code class="docutils literal notranslate"><span class="pre">Inventarnr</span></code> in der Relation <code class="docutils literal notranslate"><span class="pre">Ausleihe</span></code> existiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT ISBN</span>
<span class="c1">#FROM BuchExemplar</span>
<span class="c1">#WHERE EXISTS</span>
<span class="c1">#     (SELECT *</span>
<span class="c1">#      FROM Ausleihe</span>
<span class="c1">#      WHERE Ausleihe.Inventarnr = BuchExemplar.Inventarnr) </span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT ISBN FROM BuchExemplar WHERE EXISTS (SELECT * FROM Ausleihe WHERE Ausleihe.Inventarnr = BuchExemplar.Inventarnr) &quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;buecher/buecher.db&quot;</span><span class="p">)</span>
<span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ISBN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>25379173</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48828372</td>
    </tr>
    <tr>
      <th>2</th>
      <td>94488201</td>
    </tr>
    <tr>
      <th>3</th>
      <td>130319953</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3898644006</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Im folgenden Beispiel suchen wir die <code class="docutils literal notranslate"><span class="pre">Lehrstuhlbezeichnungen</span></code> der <code class="docutils literal notranslate"><span class="pre">Professor*innen</span></code>, die alle von ihnen gelesenen Vorlesungen auch schon einmal geprüft haben bzw. <code class="docutils literal notranslate"><span class="pre">Lehrstuhlbezeichnungen</span></code> von <code class="docutils literal notranslate"><span class="pre">Professor*innen</span></code>, wo keine von diesem/er gelesene Vorlesung existiert, die von ihm/ihr nicht geprüft wurde.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Lehrstuhlbezeichnung</span>
<span class="c1">#FROM Prof</span>
<span class="c1">#WHERE NOT EXISTS</span>
<span class="c1">#      (SELECT *</span>
<span class="c1">#       FROM Liest</span>
<span class="c1">#       WHERE Liest.PANr = Prof.PANr</span>
<span class="c1">#       AND NOT EXISTS (SELECT *</span>
<span class="c1">#                   FROM Prueft</span>
<span class="c1">#                   WHERE Prueft.PANr = Prof.PANr</span>
<span class="c1">#                   AND Prüft.VL_NR = Liest.VL_NR)</span>
<span class="c1">#) </span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Lehrstuhlbezeichnung FROM Prof WHERE NOT EXISTS (SELECT * FROM Liest WHERE Liest.PA_Nr = Prof.PA_Nr AND NOT EXISTS (SELECT * FROM Prueft WHERE Prueft.PA_Nr = Prof.PA_Nr AND Prueft.VL_NR = Liest.VL_NR)) &quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Lehrstuhlbezeichnung</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Märchen</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Getreidemuehlen</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Kräuterkunde</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="in-beispiele">
<h3><span class="section-number">9.4.4. </span>IN Beispiele<a class="headerlink" href="#in-beispiele" title="Permalink to this headline">#</a></h3>
<p>Im folgenden Beispiel suchen wir eine Auswahl an Büchern mit bestimmter <code class="docutils literal notranslate"><span class="pre">ISBN</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel</span>
<span class="c1">#FROM Bücher</span>
<span class="c1">#WHERE ISBN IN (3898644006, 1608452204, 0130319953)</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel FROM BuchExemplar WHERE ISBN IN (3898644006, 1608452204, 0130319953)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;buecher/buecher.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>The Catcher in the Rye</td>
    </tr>
    <tr>
      <th>1</th>
      <td>To Kill a Mockingbird</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Moby Dick</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Hier suchen wir die <code class="docutils literal notranslate"><span class="pre">Matrikelnr</span></code>. der <code class="docutils literal notranslate"><span class="pre">Studierenden</span></code>, die zumindest einen <code class="docutils literal notranslate"><span class="pre">Prüfer/in</span></code> gemeinsam mit dem Studierenden mit der <code class="docutils literal notranslate"><span class="pre">Matrikelnr.</span></code> ‚123456‘ haben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT DISTINCT Matrikel</span>
<span class="c1">#FROM Prüft</span>
<span class="c1">#WHERE Prüfer IN ( SELECT Prüfer</span>
<span class="c1">#                  FROM Prüft</span>
<span class="c1">#                  WHERE Matrikel = 123456) </span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT DISTINCT Matrikel FROM Prueft WHERE Pruefer IN ( SELECT Pruefer FROM Prueft WHERE Matrikel = 123456) &quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Matrikel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>123456</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4852</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4757</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8294</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11233</td>
    </tr>
    <tr>
      <th>5</th>
      <td>55940</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Eine Alternativanfrage, welche dieselbe Ausgabe erzeugt, aber nicht den <code class="docutils literal notranslate"><span class="pre">IN</span></code>-Operator benutzt:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT DISTINCT P1.Matrikel</span>
<span class="c1">#FROM Prueft P1, Prueft P2</span>
<span class="c1">#WHERE P2.Matrikel = 123456</span>
<span class="c1">#AND P1.Pruefer = P2.Pruefer</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT DISTINCT P1.Matrikel FROM Prueft P1, Prueft P2 WHERE P2.Matrikel = 123456 AND P1.Pruefer = P2.Pruefer&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Matrikel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4757</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4852</td>
    </tr>
    <tr>
      <th>2</th>
      <td>123456</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8294</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11233</td>
    </tr>
    <tr>
      <th>5</th>
      <td>55940</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In diesem Beispiel geben wir alle <code class="docutils literal notranslate"><span class="pre">Nachnamen</span></code> aller <code class="docutils literal notranslate"><span class="pre">Professor*innen</span></code> aus, die schon einmal eine 1,0 vergeben haben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Nachname</span>
<span class="c1">#FROM Prof</span>
<span class="c1">#WHERE 1.0 IN ( SELECT Note</span>
<span class="c1">#FROM Prüft</span>
<span class="c1">#WHERE Prüfer = Prof.ID )</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Nachname FROM Prof WHERE 1.0 IN ( SELECT Note FROM Prueft WHERE Pruefer = ProfID )&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Nachname</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<p>Achtung: Korrelierte Subanfrage, die Subanfrage wird für jede <code class="docutils literal notranslate"><span class="pre">ProfID</span></code> ausgeführt.</p>
</section>
<section id="all-und-any-beispiele">
<h3><span class="section-number">9.4.5. </span>ALL und ANY Beispiele<a class="headerlink" href="#all-und-any-beispiele" title="Permalink to this headline">#</a></h3>
<p>Im folgenden Beispiel suchen wir die schlechteste Note des <code class="docutils literal notranslate"><span class="pre">Studierenden</span></code> mit der <code class="docutils literal notranslate"><span class="pre">Matrikelnr.</span></code> 123456.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Note</span>
<span class="c1">#FROM Prüft</span>
<span class="c1">#WHERE Matrikel = ‘123456‘</span>
<span class="c1">#AND Note &gt;= ALL (SELECT Note</span>
<span class="c1">#                 FROM Prüft</span>
<span class="c1">#                 WHERE Matrikel = ‘123456‘)</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Note FROM Prueft WHERE Matrikel = ‘123456‘ AND Note &gt;= ALL (SELECT Note FROM Prueft WHERE Matrikel = ‘123456‘)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OperationalError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2020,</span> in <span class="ni">SQLiteDatabase.execute</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2019</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2020</span>     <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2021</span>     <span class="k">return</span> <span class="n">cur</span>

<span class="ne">OperationalError</span>: near &quot;ALL&quot;: syntax error

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">DatabaseError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">Input In [3],</span> in <span class="ni">&lt;cell line: 10&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Note FROM Prueft WHERE Matrikel = ‘123456‘ AND Note &gt;= ALL (SELECT Note FROM Prueft WHERE Matrikel = ‘123456‘)&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">df</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:399,</span> in <span class="ni">read_sql_query</span><span class="nt">(sql, con, index_col, coerce_float, params, parse_dates, chunksize, dtype)</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span><span class="sd"> Read SQL query into a DataFrame.</span>
<span class="g g-Whitespace">    </span><span class="mi">343</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">396</span><span class="sd"> parameter will be converted to UTC.</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span> <span class="n">pandas_sql</span> <span class="o">=</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">399</span> <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">read_query</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>     <span class="n">sql</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span>     <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span>     <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span>     <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>     <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">407</span> <span class="p">)</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2080,</span> in <span class="ni">SQLiteDatabase.read_query</span><span class="nt">(self, sql, index_col, coerce_float, params, parse_dates, chunksize, dtype)</span>
<span class="g g-Whitespace">   </span><span class="mi">2068</span> <span class="k">def</span> <span class="nf">read_query</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2069</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2070</span>     <span class="n">sql</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2076</span>     <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2077</span> <span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2079</span>     <span class="n">args</span> <span class="o">=</span> <span class="n">_convert_params</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2080</span>     <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2081</span>     <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col_desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2083</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2032,</span> in <span class="ni">SQLiteDatabase.execute</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2029</span>     <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">inner_exc</span>
<span class="g g-Whitespace">   </span><span class="mi">2031</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">DatabaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution failed on sql &#39;</span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2032</span> <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">exc</span>

<span class="ne">DatabaseError</span>: Execution failed on sql &#39;SELECT Note FROM Prueft WHERE Matrikel = ‘123456‘ AND Note &gt;= ALL (SELECT Note FROM Prueft WHERE Matrikel = ‘123456‘)&#39;: near &quot;ALL&quot;: syntax error
</pre></div>
</div>
</div>
</div>
<p>Wie man sehen kann wird der Operator <code class="docutils literal notranslate"><span class="pre">ALL</span></code> nicht von sqlite3 unterstützt. Stattdessen kann man eine äquivalente Anfrage mithilfe <code class="docutils literal notranslate"><span class="pre">MAX()</span></code> formulieren.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Note FROM Prueft WHERE Matrikel = 123456 AND Note &gt;= (SELECT MAX(Note) FROM Prueft WHERE Matrikel = 123456)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3,0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Im folgenden Beispiel suchen wir alle<code class="docutils literal notranslate"> <span class="pre">Studierenden</span></code>, die mindestens eine Prüfung absolviert haben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name, Matrikel</span>
<span class="c1">#FROM Student</span>
<span class="c1">#WHERE Matrikel = ANY (SELECT Matrikel</span>
<span class="c1">#                      FROM Prueft)</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Matrikel FROM Student WHERE Matrikel = ANY (SELECT Matrikel FROM Prueft)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">OperationalError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2020,</span> in <span class="ni">SQLiteDatabase.execute</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2019</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2020</span>     <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2021</span>     <span class="k">return</span> <span class="n">cur</span>

<span class="ne">OperationalError</span>: near &quot;SELECT&quot;: syntax error

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">DatabaseError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">Input In [4],</span> in <span class="ni">&lt;cell line: 8&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Matrikel FROM Student WHERE Matrikel = ANY (SELECT Matrikel FROM Prueft)&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">df</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:399,</span> in <span class="ni">read_sql_query</span><span class="nt">(sql, con, index_col, coerce_float, params, parse_dates, chunksize, dtype)</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span><span class="sd"> Read SQL query into a DataFrame.</span>
<span class="g g-Whitespace">    </span><span class="mi">343</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">396</span><span class="sd"> parameter will be converted to UTC.</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span> <span class="n">pandas_sql</span> <span class="o">=</span> <span class="n">pandasSQL_builder</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">399</span> <span class="k">return</span> <span class="n">pandas_sql</span><span class="o">.</span><span class="n">read_query</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>     <span class="n">sql</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span>     <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span>     <span class="n">coerce_float</span><span class="o">=</span><span class="n">coerce_float</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span>     <span class="n">parse_dates</span><span class="o">=</span><span class="n">parse_dates</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>     <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">407</span> <span class="p">)</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2080,</span> in <span class="ni">SQLiteDatabase.read_query</span><span class="nt">(self, sql, index_col, coerce_float, params, parse_dates, chunksize, dtype)</span>
<span class="g g-Whitespace">   </span><span class="mi">2068</span> <span class="k">def</span> <span class="nf">read_query</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2069</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2070</span>     <span class="n">sql</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2076</span>     <span class="n">dtype</span><span class="p">:</span> <span class="n">DtypeArg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2077</span> <span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">2079</span>     <span class="n">args</span> <span class="o">=</span> <span class="n">_convert_params</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2080</span>     <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2081</span>     <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col_desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2083</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/anaconda3/lib/python3.9/site-packages/pandas/io/sql.py:2032,</span> in <span class="ni">SQLiteDatabase.execute</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2029</span>     <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">inner_exc</span>
<span class="g g-Whitespace">   </span><span class="mi">2031</span> <span class="n">ex</span> <span class="o">=</span> <span class="n">DatabaseError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution failed on sql &#39;</span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2032</span> <span class="k">raise</span> <span class="n">ex</span> <span class="kn">from</span> <span class="nn">exc</span>

<span class="ne">DatabaseError</span>: Execution failed on sql &#39;SELECT Name, Matrikel FROM Student WHERE Matrikel = ANY (SELECT Matrikel FROM Prueft)&#39;: near &quot;SELECT&quot;: syntax error
</pre></div>
</div>
</div>
</div>
<p>Wie man sehen kann wird der Operator <code class="docutils literal notranslate"><span class="pre">ANY</span></code> nicht von sqlite3 unterstützt. Stattdessen kann man eine äquivalente Anfrage mithilfe <code class="docutils literal notranslate"><span class="pre">IN</span></code> formulieren.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Matrikel FROM Student WHERE Matrikel IN (SELECT Matrikel FROM Prueft)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;lehre/lehre.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Matrikel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Anna Kraft</td>
      <td>4757</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Hans Meyer</td>
      <td>4852</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Guenther Goethe</td>
      <td>8294</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Svenja Krug</td>
      <td>11233</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Clara Hund</td>
      <td>55940</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Max Mustermann</td>
      <td>123456</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="bedingungen-mit-tupeln">
<h3><span class="section-number">9.4.6. </span>Bedingungen mit Tupeln<a class="headerlink" href="#bedingungen-mit-tupeln" title="Permalink to this headline">#</a></h3>
<p>Verallgemeinerungen von <code class="docutils literal notranslate"><span class="pre">IN</span></code>, <code class="docutils literal notranslate"><span class="pre">ALL</span></code> und <code class="docutils literal notranslate"><span class="pre">ANY</span></code> auf Tupel sind auch möglich.
<br><br>
<code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">IN</span> <span class="pre">R</span></code> gibt <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> zurück, falls <code class="docutils literal notranslate"><span class="pre">t</span></code> ein Tupel in <code class="docutils literal notranslate"><span class="pre">R</span></code> ist (mehr als ein Attribut möglich). Hierbei ist vorausgesetzt, dass beide dasselbe Schema haben und dieselbe Reihenfolge der Attribute.
<br><br>
<code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">&gt;</span> <span class="pre">ALL</span> <span class="pre">R</span></code> gibt <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> zurück, falls <code class="docutils literal notranslate"><span class="pre">t</span></code> größer als jedes Tupel in <code class="docutils literal notranslate"><span class="pre">R</span></code> ist. Die Vergleiche finden in Standardreihenfolge der Attribute statt.
<br><br>
<code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">&lt;&gt;</span> <span class="pre">ANY</span> <span class="pre">R</span></code> gibt <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> zurück, falls <code class="docutils literal notranslate"><span class="pre">R</span></code> mindestens ein Tupel hat, das ungleich <code class="docutils literal notranslate"><span class="pre">t</span></code> ist.
<br>
<br>
Im folgenden Beispiel wollen wir alle <code class="docutils literal notranslate"><span class="pre">Namen</span></code> von <code class="docutils literal notranslate"><span class="pre">Produzenten</span></code> von <code class="docutils literal notranslate"><span class="pre">Filmen</span></code> mit Harrison Ford ausgeben. Wir suchen erst <code class="docutils literal notranslate"><span class="pre">Titel</span></code> und <code class="docutils literal notranslate"><span class="pre">Jahr</span></code> aller <code class="docutils literal notranslate"><span class="pre">Filme</span></code> mit Harrison Ford mithilfe einer Subanfrage. Für jene <code class="docutils literal notranslate"><span class="pre">Filme</span></code> suchen wir dann die <code class="docutils literal notranslate"><span class="pre">ProduzentinIDs</span></code> und gleichen die mit den <code class="docutils literal notranslate"><span class="pre">ManagerinIDs</span></code> ab, zuletzt geben wir die <code class="docutils literal notranslate"><span class="pre">Namen</span></code> der passenden <code class="docutils literal notranslate"><span class="pre">Manager*Innen</span></code> aus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name </span>
<span class="c1">#FROM ManagerIn </span>
<span class="c1">#WHERE ManagerinID IN( SELECT ProduzentinID FROM Film WHERE (Titel, Jahr) </span>
<span class="c1">#IN( SELECT FilmTitel AS Titel, FilmJahr AS Jahr FROM spielt_in WHERE Name = &quot;Harrison Ford&quot;));</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name FROM ManagerIn WHERE ManagerinID IN( SELECT ProduzentinID FROM Film WHERE (Titel, Jahr) IN( SELECT FilmTitel AS Titel, FilmJahr AS Jahr FROM spielt_in WHERE Name = &#39;Harrison Ford&#39;))&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Paul Golding</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Es gibt auch eine alternative Formulierung der Anfrage ohne <code class="docutils literal notranslate"><span class="pre">IN</span></code>. Wir joinen <code class="docutils literal notranslate"><span class="pre">ManagerIn</span></code>, <code class="docutils literal notranslate"><span class="pre">Film</span></code> und <code class="docutils literal notranslate"><span class="pre">spielt_in</span></code> und geben jene <code class="docutils literal notranslate"><span class="pre">Manager*Innamen</span></code> aus, wo <code class="docutils literal notranslate"><span class="pre">spielt_in.Name</span></code> Harrison Ford entspricht.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT ManagerIn.Name </span>
<span class="c1">#FROM ManagerIn, Film, spielt_in </span>
<span class="c1">#WHERE ManagerinID = ProduzentinID </span>
<span class="c1">#AND Titel = FilmTitel </span>
<span class="c1">#AND Jahr = FilmJahr </span>
<span class="c1">#AND spielt_in.Name = &quot;Harrison Ford&quot;;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT ManagerIn.Name FROM ManagerIn, Film, spielt_in WHERE ManagerinID = ProduzentinID AND Titel = FilmTitel AND Jahr = FilmJahr AND spielt_in.Name = &#39;Harrison Ford&#39;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Paul Golding</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="subanfragen-in-from-klausel">
<h3><span class="section-number">9.4.7. </span>Subanfragen in FROM-Klausel<a class="headerlink" href="#subanfragen-in-from-klausel" title="Permalink to this headline">#</a></h3>
<p>Wir können anstelle einer einfachen Relation auch eine geklammerte Subanfrage in der <code class="docutils literal notranslate"><span class="pre">FROM</span></code>-Klausel schreiben. Der Subanfrage mussein Alias vergeben werden, um auf die Attribute zuzugreifen.
<br><br>
Im folgenden Beispiel wollen wir wieder alle Namen von Produzenten von <code class="docutils literal notranslate"><span class="pre">Filmen</span></code> mit Harrison Ford ausgeben. Wir stellen eine Subanfrage in der <code class="docutils literal notranslate"><span class="pre">FROM</span></code>-Klausel, die alle <code class="docutils literal notranslate"><span class="pre">ProduzentinIDs</span></code> zurückgibt, welche in Filmen mit Harrison Ford beteiligt waren. Zum Schluss werden die <code class="docutils literal notranslate"><span class="pre">ProduzentinIDs</span></code> wieder mit den <code class="docutils literal notranslate"><span class="pre">ManagerinIDs</span></code> abgeglichen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT M.Name </span>
<span class="c1">#FROM ManagerIn M, (SELECT ProduzentinID AS ID FROM Film, spielt_in WHERE Titel = FilmTitel AND Jahr = FilmJahr AND Name = &quot;Harrison Ford&quot;) ProduzentIn </span>
<span class="c1">#WHERE M.ManagerinID = ProduzentIn.ID;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT M.Name FROM ManagerIn M, (SELECT ProduzentinID AS ID FROM Film, spielt_in WHERE Titel = FilmTitel AND Jahr = FilmJahr AND Name = &#39;Harrison Ford&#39;) ProduzentIn WHERE M.ManagerinID = ProduzentIn.ID&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Paul Golding</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="korrelierte-subanfragen">
<h3><span class="section-number">9.4.8. </span>Korrelierte Subanfragen<a class="headerlink" href="#korrelierte-subanfragen" title="Permalink to this headline">#</a></h3>
<p>Wird eine Subanfragen einmalig ausgeführt, so handelt es sich um eine unkorrelierte Subanfrage. Korrelierte Subanfragen werden mehrfach ausgeführt, undzwar einmal pro Bindung der korrelierten Variable der äußeren Anfrage.
<br><br>
Im folgenden ein Beispiel für eine korrelierte Subanfrage. Wir suchen alle mehrfachen <code class="docutils literal notranslate"><span class="pre">Filme</span></code> mit Ausnahme der jeweils jüngsten Ausgabe. Die Subanfrage wird für jedes Tupel in <code class="docutils literal notranslate"><span class="pre">Filme</span></code> ausgeführt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Titel, Jahr </span>
<span class="c1">#FROM Film Alt </span>
<span class="c1">#WHERE Jahr &lt; ANY ( SELECT Jahr FROM Film WHERE Titel = Alt.Titel);</span>


<span class="c1">#ohne ANY</span>
<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel, Jahr FROM Film Alt WHERE Jahr &lt; (SELECT MIN(Jahr) FROM Film WHERE Titel = Alt.Titel)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<p>Nun suchen wir die <code class="docutils literal notranslate"><span class="pre">Namen</span></code> und <code class="docutils literal notranslate"><span class="pre">Gehälter</span></code> aller Mitarbeiter*Innen in Potsdam, wir formulieren zunächst eine Anfrage mit einer unkorrelierten und dann eine mit einr korrelierte Subanfrage.
<br><br>
Unten wird die Subanfrage nur einmal ausgeführt, da wir sofort alle <code class="docutils literal notranslate"><span class="pre">AbtIDs</span></code> haben. Daher handelt es sich hierbei um eine unkorrelierte Subanfrage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name, Gehalt</span>
<span class="c1">#FROM Personal p</span>
<span class="c1">#WHERE AbtID IN</span>
<span class="c1">#    (SELECT AbtID</span>
<span class="c1">#    FROM Abteilung</span>
<span class="c1">#    WHERE Ort =</span>
<span class="c1">#‘Potsdam‘)</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Gehalt FROM Personal p WHERE AbtID IN (SELECT AbtID FROM Abteilung WHERE Standort = &#39;Potsdam&#39;)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;abteilung/abteilung.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Gehalt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cem Urban</td>
      <td>3645</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Jonathan Müller</td>
      <td>4536</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Anna Graf</td>
      <td>2345</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Erik Meyer</td>
      <td>9999</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Max Mustermann</td>
      <td>4567</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Diana Bakker</td>
      <td>2774</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Sascha Stark</td>
      <td>2846</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Hans Meyer</td>
      <td>2675</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Peter Silie</td>
      <td>8653</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Hierbei handelt es sich um eine korrelierte Subanfrage, aufgrund des <code class="docutils literal notranslate"><span class="pre">p.AbtID</span></code>, da die Subanfrage für jedes Tupel aus <code class="docutils literal notranslate"><span class="pre">Personal</span> <span class="pre">p</span></code> ausgeführt werden muss.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name, Gehalt</span>
<span class="c1">#FROM Personal p</span>
<span class="c1">#WHERE Gehalt &gt;</span>
<span class="c1">#    (SELECT 0.1*Budget</span>
<span class="c1">#    FROM Abteilung a</span>
<span class="c1">#    WHERE a.AbtID =</span>
<span class="c1">#p.AbtID)</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, Gehalt FROM Personal p WHERE Gehalt &gt; (SELECT 0.1*Budget FROM Abteilung a WHERE a.AbtID = p.AbtID)&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;abteilung/abteilung.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>Gehalt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Jonathan Müller</td>
      <td>4536</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Peter Silie</td>
      <td>8653</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Jasmin Helmstedt</td>
      <td>3574</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="operationen-auf-einer-relation">
<h2><span class="section-number">9.5. </span>Operationen auf einer Relation<a class="headerlink" href="#operationen-auf-einer-relation" title="Permalink to this headline">#</a></h2>
<p>In diesem Kapitel lernen wir Operationen kennen, die nur auf einer Relation angewendet werden, das sind Duplikateliminierung, Gruppierung und Aggregation.</p>
<section id="duplikateliminierung">
<h3><span class="section-number">9.5.1. </span>Duplikateliminierung<a class="headerlink" href="#duplikateliminierung" title="Permalink to this headline">#</a></h3>
<p>Wie aus der Relationalen Algebra bekannt, ist die Duplikateliminierung auch in SQL möglich. Relationale DBMS verwenden i.d.R. Multimengensemantik und nicht Mengensemantik. Durch Operationen, wie das Enfügen von Duplikaten in Basisrelationen, die Veränderung von Tupeln in Basisrelationen, Projektion in Anfragen, Subanfragen mit z.B <code class="docutils literal notranslate"><span class="pre">UNION</span> <span class="pre">ALL</span></code> oder die Vermehrung von Duplikaten durch Kreuzprodukte, entstehen Duplikate.</p>
<p>Um Duplikate zu eliminieren kann man das <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>-Schlüsselwort benutzen, nach folgendem Schema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">Attributnamen</span>
</pre></div>
</div>
<p>So wird gewährleistet, dass jedes projezierte Element aus Attributnamen nur einmal in der Ausgabe vorkommt. Zu beachten ist noch, dass <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> eine kostenaufwändige Operation ist, da die Ausgabe einmal auf Duplikate hin durchsucht werden muss, mithilfe Sortierung oder Hashing.
<br><br>
Im folgenden Beispiel suchen wir alle Filme, in denen mindestens ein Schauspieler mitspielt. In der Relation <code class="docutils literal notranslate"><span class="pre">spielt_in</span></code> sind pro Schauspieler <code class="docutils literal notranslate"><span class="pre">Titel</span></code> und <code class="docutils literal notranslate"><span class="pre">Jahr</span></code> vorhanden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT DISTINCT FilmTitel, FilmJahr </span>
<span class="c1">#FROM spielt_in</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT DISTINCT FilmTitel, FilmJahr FROM spielt_in LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FilmTitel</th>
      <th>FilmJahr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Star Wars</td>
      <td>1977</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Into the Wild</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Brokeback Mountain</td>
      <td>2005</td>
    </tr>
    <tr>
      <th>3</th>
      <td>The Dark Knight</td>
      <td>2008</td>
    </tr>
    <tr>
      <th>4</th>
      <td>The Lighthouse</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>5</th>
      <td>The Great Gatsby</td>
      <td>2013</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lady Bird</td>
      <td>2017</td>
    </tr>
    <tr>
      <th>7</th>
      <td>La Heine</td>
      <td>1995</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Mamma Mia!</td>
      <td>2008</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Inside Out</td>
      <td>2015</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Wir erinnern uns zurück an die Anfragen, wo wir die <code class="docutils literal notranslate"><span class="pre">Produzent*Innen</span></code> von <code class="docutils literal notranslate"><span class="pre">Filmen</span></code> mit Harrison Ford gesucht haben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">SELECT</span> <span class="n">ManagerinID</span><span class="p">,</span> <span class="n">Name</span>
<span class="n">FROM</span> <span class="n">ManagerIn</span>
<span class="n">WHERE</span> <span class="n">ManagerinId</span> <span class="n">IN</span>
    <span class="p">(</span><span class="n">SELECT</span> <span class="n">ProduzentinID</span>
     <span class="n">FROM</span> <span class="n">Film</span>
     <span class="n">WHERE</span> <span class="p">(</span><span class="n">Titel</span><span class="p">,</span> <span class="n">Jahr</span><span class="p">)</span> <span class="n">IN</span>
        <span class="p">(</span><span class="n">SELECT</span> <span class="n">FilmTitel</span><span class="p">,</span>
            <span class="n">FilmJahr</span>
         <span class="n">FROM</span> <span class="n">spielt_in</span>
         <span class="n">WHERE</span> <span class="n">SchauspielerinName</span> <span class="o">=</span> <span class="s1">&#39;Harrison Ford&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<p>Einmal sind wir an das Ergebnis durch Subanfragen gelangt s.o. und auf einem anderen Wege mit einem Join.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">SELECT</span> <span class="n">ManagerinID</span><span class="p">,</span> <span class="n">Name</span>
<span class="n">FROM</span> <span class="n">ManagerIn</span><span class="p">,</span> <span class="n">Film</span><span class="p">,</span> <span class="n">spielt_in</span>
<span class="n">WHERE</span> <span class="n">ManagerinID</span> <span class="o">=</span> <span class="n">ProduzentinID</span>
<span class="n">AND</span> <span class="n">Titel</span> <span class="o">=</span> <span class="n">FilmTitel</span>
<span class="n">AND</span> <span class="n">Jahr</span> <span class="o">=</span> <span class="n">FilmJahr</span>
<span class="n">AND</span> <span class="n">SchauspielerName</span> <span class="o">=</span> <span class="s1">&#39;Harrison Ford&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>Nun ist die Frage, ob beide Anfragen äquivalent sind. das ist nicht der Fall, da bei der Anfrage mit dem Join Duplikate möglich sind, welches sich aber mit dem <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>-Schlüsselwort lösen lässt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">ManagerinID</span><span class="p">,</span> <span class="n">Name</span>
<span class="n">FROM</span> <span class="n">ManagerIn</span><span class="p">,</span> <span class="n">Film</span><span class="p">,</span> <span class="n">spielt_in</span>
<span class="n">WHERE</span> <span class="n">ManagerinID</span> <span class="o">=</span> <span class="n">ProduzentinID</span>
<span class="n">AND</span> <span class="n">Titel</span> <span class="o">=</span> <span class="n">FilmTitel</span>
<span class="n">AND</span> <span class="n">Jahr</span> <span class="o">=</span> <span class="n">FilmJahr</span>
<span class="n">AND</span> <span class="n">SchauspielerName</span> <span class="o">=</span> <span class="s1">&#39;Harrison Ford&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="aggregation">
<h3><span class="section-number">9.5.2. </span>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">#</a></h3>
<p>Die aus der Relationalen Algebra bekannte Aggregation ist auch in SQL möglich, die Standardaggregationsoperatoren <code class="docutils literal notranslate"><span class="pre">SUM</span></code>, <code class="docutils literal notranslate"><span class="pre">AVG</span></code>, <code class="docutils literal notranslate"><span class="pre">MIN</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX</span></code>, <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> können auf einzelne Attribute in der <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>-Klausel angewendet werden. Zudem gibt es noch weitere Aggregationsoperatoren wir z.B <code class="docutils literal notranslate"><span class="pre">VAR</span></code>, <code class="docutils literal notranslate"><span class="pre">STDDEV</span></code> für die Varianz und Standardabweichung. Es wird auch <code class="docutils literal notranslate"><span class="pre">COUNT()</span></code> häufig benutzt, welches die Anzahl der Tupel in der Relation, die durch die <code class="docutils literal notranslate"><span class="pre">FROM</span></code> und <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> Klauseln definiert wird zählt. Auch die Kombination mit <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> wird häufig benutzt wie z.B <code class="docutils literal notranslate"><span class="pre">COUNT(DISTINCT</span> <span class="pre">Jahr)</span></code> <code class="docutils literal notranslate"><span class="pre">SUM(DISTINCT</span> <span class="pre">Gehalt)</span></code></p>
<section id="aggregation-beispiele">
<h4><span class="section-number">9.5.2.1. </span>Aggregation – Beispiele<a class="headerlink" href="#aggregation-beispiele" title="Permalink to this headline">#</a></h4>
<p>Im folgenden Beispiel möchten wir das <code class="docutils literal notranslate"><span class="pre">Durchschnittsgehalt</span></code> aller <code class="docutils literal notranslate"><span class="pre">Manager*Innen</span></code> ausgeben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT AVG(Gehalt) </span>
<span class="c1">#FROM ManagerIn;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT AVG(Gehalt) FROM ManagerIn&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AVG(Gehalt)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>251938.933333</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In diesem Beispiel möchten wir alle Einträger der Relation <code class="docutils literal notranslate"><span class="pre">spielt_in</span></code> zählen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT COUNT(*) </span>
<span class="c1">#FROM spielt_in;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(*) FROM spielt_in;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(*)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>34</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In diesem Beispiel zählen wir alle Schauspieler*innen, die in der <code class="docutils literal notranslate"><span class="pre">spielt_in</span></code> Relation vorkommen, jedoch wird doppelt gezählt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT COUNT(Name) </span>
<span class="c1">#FROM spielt_in;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(Name) FROM spielt_in;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(Name)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>34</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Mit <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> wird nicht mehr doppelt gezählt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT COUNT(DISTINCT Name) </span>
<span class="c1">#FROM spielt_in </span>
<span class="c1">#WHERE FilmJahr = 1990;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(DISTINCT Name) FROM spielt_in WHERE FilmJahr = 1990;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT(DISTINCT Name)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="gruppierung-aggregation-und-null">
<h3><span class="section-number">9.5.3. </span>Gruppierung, Aggregation und NULL<a class="headerlink" href="#gruppierung-aggregation-und-null" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">NULL</span></code> wird bei der Aggregation ignoriert und trägt somit nicht zu <code class="docutils literal notranslate"><span class="pre">SUM</span></code>, <code class="docutils literal notranslate"><span class="pre">AVG</span></code> oder <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> bei und wird auch nicht als <code class="docutils literal notranslate"><span class="pre">MIN</span></code> oder <code class="docutils literal notranslate"><span class="pre">MAX</span></code> ausgegeben. Um die Anzahl der nicht-<code class="docutils literal notranslate"><span class="pre">NULL</span></code> Werte zuzählen, kann also folgende Anfrage benutzt werden:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="n">Länge</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">Film</span><span class="p">;</span>
</pre></div>
</div>
<p>Bei der Gruppierung ist <code class="docutils literal notranslate"><span class="pre">NULL</span></code> ein eigener Gruppierungswert, also gibt es z.B die <code class="docutils literal notranslate"><span class="pre">NULL</span></code>-Gruppe. Um das zu veranschaulichen betrachten wir die folgende Relation <code class="docutils literal notranslate"><span class="pre">R</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>A</p></th>
<th class="head"><p>B</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NULL</p></td>
<td><p>NULL</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">A,</span> <span class="pre">COUNT(B)</span> <span class="pre">FROM</span> <span class="pre">R</span> <span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">A;</span></code>
<br>
Ergebnis: <code class="docutils literal notranslate"><span class="pre">(NULL,</span> <span class="pre">0)</span></code>
<br><br>
<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">A,</span> <span class="pre">SUM(B)</span> <span class="pre">FROM</span> <span class="pre">R</span> <span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">A;</span></code>
<br>
Ergebnis: <code class="docutils literal notranslate"><span class="pre">(NULL,</span> <span class="pre">NULL)</span></code></p>
</section>
<section id="gruppierung">
<h3><span class="section-number">9.5.4. </span>Gruppierung<a class="headerlink" href="#gruppierung" title="Permalink to this headline">#</a></h3>
<p>Auch die aus der Relationalen Algebra bekannte Gruppierung ist in SQL möglich mittels <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> nach der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel. Bei der Gruppierung gibt es in der <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>-Klausel zwei “Sorten” von Attributen, einmal Gruppierungsattribute und einmal aggregierte Attribute. Nicht-aggregierte Werte der <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>-Klausel müssen in der <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>-Klausel erscheinen, es müssen jedoch keiner der beiden Sorten erscheinen. Eine Gruppierung mit Aggregation können wir im unteren Beispiel sehen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT StudioName, SUM(Laenge) </span>
<span class="c1">#FROM Film GROUP BY StudioName</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT StudioName, SUM(Laenge) FROM Film GROUP BY StudioName LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>StudioName</th>
      <th>SUM(Laenge)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A Band Apart</td>
      <td>154</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A24</td>
      <td>233</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Disney</td>
      <td>419</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fox</td>
      <td>113</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Littlestar Productions</td>
      <td>108</td>
    </tr>
    <tr>
      <th>5</th>
      <td>MGM</td>
      <td>527</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Marvel Enterprises</td>
      <td>121</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NULL</td>
      <td>98</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Paramount</td>
      <td>148</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Paramount</td>
      <td>132</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In diesem Beispiel lassen wir die Aggregation weg und suchen nur die Studionamen gruppiert bei <code class="docutils literal notranslate"><span class="pre">StudioName</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT StudioName </span>
<span class="c1">#FROM Film </span>
<span class="c1">#GROUP BY StudioName</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT StudioName FROM Film GROUP BY StudioName LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>StudioName</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A Band Apart</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A24</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Disney</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fox</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Littlestar Productions</td>
    </tr>
    <tr>
      <th>5</th>
      <td>MGM</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Marvel Enterprises</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NULL</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Paramount</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Paramount</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In diesem Beispiel suchen wir nur die <code class="docutils literal notranslate"><span class="pre">Gesamtlänge</span></code> der <code class="docutils literal notranslate"><span class="pre">Studios</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT SUM(Laenge) </span>
<span class="c1">#FROM Film </span>
<span class="c1">#GROUP BY StudioName</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT SUM(Laenge) FROM Film GROUP BY StudioName LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUM(Laenge)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>154</td>
    </tr>
    <tr>
      <th>1</th>
      <td>233</td>
    </tr>
    <tr>
      <th>2</th>
      <td>419</td>
    </tr>
    <tr>
      <th>3</th>
      <td>113</td>
    </tr>
    <tr>
      <th>4</th>
      <td>108</td>
    </tr>
    <tr>
      <th>5</th>
      <td>527</td>
    </tr>
    <tr>
      <th>6</th>
      <td>121</td>
    </tr>
    <tr>
      <th>7</th>
      <td>98</td>
    </tr>
    <tr>
      <th>8</th>
      <td>148</td>
    </tr>
    <tr>
      <th>9</th>
      <td>132</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name, SUM(Laenge) </span>
<span class="c1">#FROM ManagerIn, Film </span>
<span class="c1">#WHERE ManagerinID = ProduzentinID </span>
<span class="c1">#GROUP BY Name</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, SUM(Laenge) FROM ManagerIn, Film WHERE ManagerinID = ProduzentinID GROUP BY Name LIMIT 10&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>SUM(Laenge)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alan Bruckner</td>
      <td>108</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ann Sarnoff</td>
      <td>121</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Bill Pohlad</td>
      <td>280</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Bob Chapek</td>
      <td>419</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Brian Robbins</td>
      <td>134</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Daniel Katz</td>
      <td>233</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Isaac Perlmutter</td>
      <td>152</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Jim Berk</td>
      <td>263</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Jim Morris</td>
      <td>207</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Louis B.Mayer</td>
      <td>527</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Wenn mehrere Relationen verwendet werden, wie im obigen Beispiel wird die Gruppierung am Schluss durchgeführt. Sie können sich an die folgende Reihenfolge der Ausführung (und des Lesens) richten:
<br></p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FROM</span></code>-Klausel
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GROUP</span></code> BY-Klausel
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code>-Klausel
<br>
<br></p></li>
</ol>
<p>Möchte man nun die Ergebnismenge nach der Gruppierung einschränken, so geht das nicht durch eine zusätzliche Bedingung in der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel, sondern es muss das Schlüsselwort <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> benutzt werden.Benutzt man zusätzlich noch Aggregationen in der <code class="docutils literal notranslate"><span class="pre">HAVING</span></code>-Klausel, so beziehen sich diese nur auf die aktuelle Gruppe. Wie bei der <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>-Klausel, dürfen bei der Gruppierung in der <code class="docutils literal notranslate"><span class="pre">HAVING</span></code>-Klausel nur un-aggregierte Gruppierungsattribute erscheinen.
<br>
<br>
Wir möchten die Summe der <code class="docutils literal notranslate"><span class="pre">Filmlänge</span></code> von <code class="docutils literal notranslate"><span class="pre">Manager*Innen</span></code> ausgeben, dessen Gehälter über 1000000 liegt. Das untere Beispiel erfüllt nicht die Anfrage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name, SUM(Laenge) </span>
<span class="c1">#FROM ManagerIn, Film </span>
<span class="c1">#WHERE ManagerinID = ProduzentinID </span>
<span class="c1">#AND Gehalt &gt; 1000000 GROUP BY Name</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, SUM(Laenge) FROM ManagerIn, Film WHERE ManagerinID = ProduzentinID AND Gehalt &gt; 1000000 GROUP BY Name&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 7&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">#SELECT Name, SUM(Laenge) </span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1">#FROM ManagerIn, Film </span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1">#WHERE ManagerinID = ProduzentinID </span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1">#AND Gehalt &gt; 1000000 GROUP BY Name</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, SUM(Laenge) FROM ManagerIn, Film WHERE ManagerinID = ProduzentinID AND Gehalt &gt; 1000000 GROUP BY Name&quot;</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">df</span>

<span class="ne">NameError</span>: name &#39;sqlite3&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Wie oben schon genannt muss <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> benutzt werden, um die Ergebnismenge nach der Gruppierung einzuschränken, wie um unteren Beispiel dargestellt wird.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name, SUM(Laenge) </span>
<span class="c1">#FROM ManagerIn, Film </span>
<span class="c1">#WHERE ManagerinID = ProduzentinID </span>
<span class="c1">#GROUP BY Name HAVING SUM(Laenge) &gt; 200</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name, SUM(Laenge) FROM ManagerIn, Film WHERE ManagerinID = ProduzentinID GROUP BY Name HAVING SUM(Laenge) &gt; 200&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
      <th>SUM(Laenge)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bill Pohlad</td>
      <td>280</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bob Chapek</td>
      <td>419</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Daniel Katz</td>
      <td>233</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Jim Berk</td>
      <td>263</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Jim Morris</td>
      <td>207</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Louis B.Mayer</td>
      <td>527</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In diesem Beispiel geben wir nur die <code class="docutils literal notranslate"><span class="pre">Namen</span></code> der <code class="docutils literal notranslate"><span class="pre">Manager*Innen</span></code> aus und benutzten Aggregation, um diese zu filtern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#SELECT Name </span>
<span class="c1">#FROM ManagerIn, Film </span>
<span class="c1">#WHERE ManagerinID = ProduzentinID </span>
<span class="c1">#GROUP BY Name HAVING SUM(Laenge) &gt; 200</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Name FROM ManagerIn, Film WHERE ManagerinID = ProduzentinID GROUP BY Name HAVING SUM(Laenge) &gt; 200&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bill Pohlad</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bob Chapek</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Daniel Katz</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Jim Berk</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Jim Morris</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Louis B.Mayer</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="zusammenfassung-sql">
<h3><span class="section-number">9.5.5. </span>Zusammenfassung SQL<a class="headerlink" href="#zusammenfassung-sql" title="Permalink to this headline">#</a></h3>
<p>Hier werden nocheinmal die Grundbausteine einer SQL Anfrage (mit empfohlener Lesereihenfolge) aufgelistet.</p>
<p>6. <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>
<br>
1. <code class="docutils literal notranslate"><span class="pre">FROM</span></code>
<br>
2. <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>
<br>
3. <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>
<br>
4. <code class="docutils literal notranslate"><span class="pre">HAVING</span></code>
<br>
5. <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code></p>
<p>Bei einer Anfrage die auf eine Datenbank zugreift sind <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> … <code class="docutils literal notranslate"><span class="pre">FROM</span></code> … Pflicht. Zuletzt darf <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> nur in Kombination mit <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> erscheinen.</p>
</section>
</section>
<section id="datenbearbeitung-dml">
<h2><span class="section-number">9.6. </span>Datenbearbeitung(DML)<a class="headerlink" href="#datenbearbeitung-dml" title="Permalink to this headline">#</a></h2>
<p>Zuvor haben wir SQL nur als Anfragesprache betrachtet. In diesem Kapitel betrachten wir SQL nun als DML(Data Manipulation Language), also das Bearbeiten von Daten. In SQL stehen folgende Funktione zur Verfügung um Daten zu bearbeiten Create, Read, Update und Delete(CRUD). Um einzelne Tupel einzufügen, zu löschen und zu ändern.</p>
<section id="einfugen">
<h3><span class="section-number">9.6.1. </span>Einfügen<a class="headerlink" href="#einfugen" title="Permalink to this headline">#</a></h3>
<p>Als Grundbaustein für das Einfügen in einer Relation <code class="docutils literal notranslate"><span class="pre">R</span></code>, muss man folgendem Schema folgen <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">R</span></code>(<span class="math notranslate nohighlight">\(A_1\)</span>, …, <span class="math notranslate nohighlight">\(A_n\)</span>) <code class="docutils literal notranslate"><span class="pre">VALUES</span></code> (<span class="math notranslate nohighlight">\(v_1\)</span>,…,<span class="math notranslate nohighlight">\(v_n\)</span>), wobei <span class="math notranslate nohighlight">\(A_1\)</span>,…,<span class="math notranslate nohighlight">\(A_n\)</span> die Attribute der Relation <code class="docutils literal notranslate"><span class="pre">R</span></code> sind und <span class="math notranslate nohighlight">\(v_1\)</span> ,…,<span class="math notranslate nohighlight">\(v_n\)</span> die zu einfügenden Werte. Hierbei muss die Reihenfolge der Werte und Attribute beachtet werden, die Reihenfolge sollte entsprechend der Spezifikation des Schemas <code class="docutils literal notranslate"><span class="pre">(CREATE</span> <span class="pre">TABLE</span> <span class="pre">...)</span></code> erfolgen. Falls beim <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> Attribute fehlen, wird der Default-Wert aus der Tabellendefinition eingesetzt bzw. <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, falls nicht anders angegeben wurde.
<br><br>
Ein Beispiel für das Einfügen eines Tupels in die <code class="docutils literal notranslate"><span class="pre">spielt_in</span></code>-Relation ist unten zu finden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> INSERT INTO spielt_in(FilmTitel, FilmJahr, Schauspieler) VALUES (‘Star Wars‘, 1977, ‘Alec Guinness‘);
</pre></div>
</div>
</div>
</div>
<p>Falls alle Attribute gesetzt werden, kann die Attributliste auch ausgelassen werden, wie unten zu sehen ist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> INSERT INTO spielt_in VALUES (‘Star Wars‘, 1977, ‘Alec Guinness‘);
</pre></div>
</div>
</div>
</div>
<section id="einfugen-per-anfrage">
<h4><span class="section-number">9.6.1.1. </span>Einfügen per Anfrage<a class="headerlink" href="#einfugen-per-anfrage" title="Permalink to this headline">#</a></h4>
<p>In SQL ist es auch möglich Einfügeoperationen mit Anfragen zu kombinieren.
<br>
<br>
Haben wir die beiden Relationen <code class="docutils literal notranslate"><span class="pre">Studio(Name,</span> <span class="pre">Adresse,</span> <span class="pre">VorsitzendeID)</span></code> und <code class="docutils literal notranslate"><span class="pre">Film(Titel,</span> <span class="pre">Jahr,</span> <span class="pre">Länge,</span> <span class="pre">inFarbe,</span> <span class="pre">StudioName,</span> <span class="pre">ProduzentinID)</span></code>. Nun kann es sein, dass Studios in der Film-Relation vorkommen, aber nicht in der Studio-Relation. Wir möchten also alle Studios der Film-Relation ind die Studio-Relation einfügen. In der unteren Anfrage fügen wir jene <code class="docutils literal notranslate"><span class="pre">StudioNamen</span></code> in die Studio-Relation ein, die nicht in der Studio-Relation vorkommen. Jedoch bleiben bei dieser Anfrage die Attribute Adresse und <code class="docutils literal notranslate"><span class="pre">VorsitzendeID</span></code> auf <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, welches im Allgemeinen Redundanz erzeugt, was vermieden werden sollte.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">Studio</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">StudioName</span>
<span class="n">FROM</span> <span class="n">Film</span>
<span class="n">WHERE</span> <span class="n">StudioName</span> <span class="n">NOT</span> <span class="n">IN</span>
    <span class="p">(</span><span class="n">SELECT</span> <span class="n">Name</span>
    <span class="n">FROM</span> <span class="n">Studio</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="ausfuhrungsreihenfolge-beim-einfugen">
<h3><span class="section-number">9.6.2. </span>Ausführungsreihenfolge beim Einfügen<a class="headerlink" href="#ausfuhrungsreihenfolge-beim-einfugen" title="Permalink to this headline">#</a></h3>
<p>Betrachten wir wieder das vorherige Beispiel, einmal mit <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> und einmal ohne. Wir fragen uns, ob jedes mal wenn, ein <code class="docutils literal notranslate"><span class="pre">StudioName</span></code> gefunden wurde, der noch nicht in der Tabelle enthalten ist, dieser direkt schon in die Tabelle eingefügt wird oder ob zuerst die ganze Anfrage ausgeführt wird. Tatsächlich ist es in SQL Standard so, dass zuerst die gesamte Anfrage ausgeführt wird und dann erst in die Relation eingefügt wird.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">Studio</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">StudioName</span>
<span class="n">FROM</span> <span class="n">Film</span>
<span class="n">WHERE</span> <span class="n">StudioName</span> <span class="n">NOT</span> <span class="n">IN</span>
    <span class="p">(</span><span class="n">SELECT</span> <span class="n">Name</span>
    <span class="n">FROM</span> <span class="n">Studio</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">Studio</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">StudioName</span>
<span class="n">FROM</span> <span class="n">Film</span>
<span class="n">WHERE</span> <span class="n">StudioName</span> <span class="n">NOT</span> <span class="n">IN</span>
    <span class="p">(</span><span class="n">SELECT</span> <span class="n">Name</span>
    <span class="n">FROM</span> <span class="n">Studio</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<section id="bulk-insert">
<h4><span class="section-number">9.6.2.1. </span>Bulk insert<a class="headerlink" href="#bulk-insert" title="Permalink to this headline">#</a></h4>
<p>Beim <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> werden die Daten zeilenbasiert aus SQL statements eingefügt. Es ist möglich, dass die Daten ,die in eine Datenbank eingefügt werden sollen schon in einer bestimmten Form vorliegen. Da bietet es sich an den Befehl <code class="docutils literal notranslate"><span class="pre">IMPORT</span></code> zu benutzten, mitdem Daten aus einer Datei Zeilenbasiert eingefügt werden. Hierbei bleiben die gesetzten Trigger und Nebenbedingungen weiterhin aktiv und auch die Indizes werden laufend aktualisiert.
<br><br>
Eine deutlich effizientere Weise Daten einzufügen ist mit <code class="docutils literal notranslate"><span class="pre">LOAD</span></code>, hier wird seitenbasiert aus einer Datei eingefügt, wobei Trigger und Nebenbedingungen nicht berücksichtigt werden und die Indizes am Ende neu generiert werden. Man muss beachten, dass die Syntax von <code class="docutils literal notranslate"><span class="pre">IMPORT</span></code> und <code class="docutils literal notranslate"><span class="pre">LOAD</span></code> jeweils DBMS-spezifisch ist, z.B gibt es in sqlite keinen <code class="docutils literal notranslate"><span class="pre">LOAD</span></code>-Befehl.</p>
</section>
</section>
<section id="loschen">
<h3><span class="section-number">9.6.3. </span>Löschen<a class="headerlink" href="#loschen" title="Permalink to this headline">#</a></h3>
<p>Der Grundbaustein zum Löschen von Tupeln ist <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">FROM</span> <span class="pre">R</span> <span class="pre">WHERE</span></code> …, wobei <code class="docutils literal notranslate"><span class="pre">R</span></code> wie beim Einfügen eine Relation ist. Beim Delete werden immer ganze Tupel gelöscht. Im Gegensatz zum Einfügen, können die zu löschenden Tupel nicht direkt angegeben werden, sondern müssen in der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel umschrieben werden. Um ein konkretes Tupel zu löschen, müssen also alle Werte dieses Tupel oder wenn vorhanden eine ID bekannt sein. Es werden alle Tupel gelöscht für die <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> in der <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Kausel gilt. Es ist auch möglich die <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel wegzulassen, dann werden alle Tupel der Relation gelöscht. Unten finden Sie einige Beispiele.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
DELETE FROM spielt_in
WHERE FilmTitel = ‘The Maltese Falcon‘
AND FilmJahr = 1942
AND Schauspieler = ‘Sydney Greenstreet‘;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">Manager</span>
<span class="n">WHERE</span> <span class="n">Gehalt</span> <span class="o">&lt;</span> <span class="mi">10000000</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">Manager</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="verandern-update">
<h3><span class="section-number">9.6.4. </span>Verändern (update)<a class="headerlink" href="#verandern-update" title="Permalink to this headline">#</a></h3>
<p>Der Grundbaustein zum Verändern von Tupeln ist <code class="docutils literal notranslate"><span class="pre">UPDATE</span> <span class="pre">R</span> <span class="pre">SET</span></code> … <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> …, wobei auch hier <code class="docutils literal notranslate"><span class="pre">R</span></code> eine Relation ist. In der <code class="docutils literal notranslate"><span class="pre">SET</span></code>-Klausel werden komma-separiert Werte zugewiesen. Im Beispiel unten wird in der <code class="docutils literal notranslate"><span class="pre">Managerrelation</span></code> vor dem <code class="docutils literal notranslate"><span class="pre">Name</span></code> jener <code class="docutils literal notranslate"><span class="pre">Manager*Innen</span></code> eine ‘Präs.’ gesetzt, dessen <code class="docutils literal notranslate"><span class="pre">Manager*InID</span></code> in den <code class="docutils literal notranslate"><span class="pre">Präsident*InnenIDs</span></code> vorkommt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
UPDATE Manager
SET Name = ‘Präs. ‘ || Name
WHERE ManagerinID IN
(SELECT PräsidentID FROM Studios);
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="schemata-ddl">
<h2><span class="section-number">9.7. </span>Schemata(DDL)<a class="headerlink" href="#schemata-ddl" title="Permalink to this headline">#</a></h2>
<p>In diesem Kapitel betrachten wir SQL als Data Definition Language(DDL). Möchte man eine neue Tabelle anlegen, müssen die verschiedenen Datentypen, Default-Werte, Indizes und damit zusammenhängende Tabellen beachten, welche wir uns in diesem Kapitel genauer anschauen.</p>
<section id="datentypen">
<h3><span class="section-number">9.7.1. </span>Datentypen<a class="headerlink" href="#datentypen" title="Permalink to this headline">#</a></h3>
<p>Die vorhandenen Datentypen hängen von dem benutzten DBMS ab, wir betrachten die Datentypen von DB2 von IBM. Jedes definierte Attribut muss einen Datentyp haben. Es gibt:
<br></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CHAR(n)</span></code> – String fester Länge (n Zeichen)
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VARCHAR(n)</span></code> – String variabler Länge, maximal n Zeichen
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BIT(n)</span></code> bzw. <code class="docutils literal notranslate"><span class="pre">BIT</span> <span class="pre">VARYING(n)</span></code> – Wie <code class="docutils literal notranslate"><span class="pre">CHAR</span></code>, aber Bits
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code> – <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> oder <code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code>
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INT</span> <span class="pre">/</span> <span class="pre">INTEGER</span></code> bzw. <code class="docutils literal notranslate"><span class="pre">SHORTINT</span></code> – 8 bzw. 4 Byte
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FLOAT</span></code> / <code class="docutils literal notranslate"><span class="pre">REAL</span></code> bzw. <code class="docutils literal notranslate"><span class="pre">DOUBLE</span> <span class="pre">PRECISION</span></code>
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DECIMAL</span> <span class="pre">(n,d)</span></code> – Z.B. Gehalt <code class="docutils literal notranslate"><span class="pre">DECIMAL(7,2)</span></code> – 7 Stellen, davon 2 Nachkommastellen
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CLOB</span></code> und <code class="docutils literal notranslate"><span class="pre">BLOB</span></code>
<br><br>
Unten finden Sie einen Überblick aller DB2 Datentypen.</p></li>
</ul>
</section>
<section id="uberblick-db2-datentypen">
<h3><span class="section-number">9.7.2. </span>Überblick DB2 Datentypen<a class="headerlink" href="#uberblick-db2-datentypen" title="Permalink to this headline">#</a></h3>
<p><img alt="title" src="../_images/db2_datentypen.jpg" /></p>
</section>
<section id="tabellen">
<h3><span class="section-number">9.7.3. </span>Tabellen<a class="headerlink" href="#tabellen" title="Permalink to this headline">#</a></h3>
<p>Der Grundbaustein zum Erzeugenvon Tabellen ist <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">R</span></code> …, wobei <code class="docutils literal notranslate"><span class="pre">R</span></code> der Name der Tabelle ist. In runden Klammern werden kommasepariert die gewünschten Attribute mit den jeweiligen Datentypen genannt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">Schauspieler</span> <span class="p">(</span>
<span class="n">Name</span> <span class="n">CHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
<span class="n">Adresse</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="n">Geschlecht</span> <span class="n">CHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="n">Geburtstag</span> <span class="n">DATE</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Um eine Tabelle zu löschen wird <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span> <span class="pre">R</span></code> … verwendet.
<br><br>
Auch das Verändern des Tabellenschemas ist möglich, undzwar mit <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">R</span> </code>… . Es können neue Attribute hinzugefügt werden, alte gelöscht oder auch Datentypen von bestehenden Attributen verändert werden. Zu beachten ist, dass bei dem Hinzufügen von neuen Attributen Nullwerte entstehen.
<br></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">Schauspieler</span> <span class="pre">ADD</span> <span class="pre">Telefon</span> <span class="pre">CHAR(6);</span></code>
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">Schauspieler</span> <span class="pre">DROP</span> <span class="pre">Geburtstag;</span></code>
<br></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">Schauspieler</span> <span class="pre">MODIFY</span> <span class="pre">Telefon</span> <span class="pre">CHAR(10);</span></code></p></li>
</ul>
</section>
<section id="default-werte">
<h3><span class="section-number">9.7.4. </span>Default-Werte<a class="headerlink" href="#default-werte" title="Permalink to this headline">#</a></h3>
<p>Default-Werte können mit dem Schlüsselwort <code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code> gesetzt werden. In dem Beispiel unten wird für das Attribut Geschlecht der Default-Wert <code class="docutils literal notranslate"><span class="pre">?</span></code> bestimmt und für den Geburtstag das Default-Datum <code class="docutils literal notranslate"><span class="pre">'0000-00-00'</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
CREATE TABLE Schauspieler (
Name CHAR(30),
Adresse VARCHAR(255),
Geschlecht CHAR(1) DEFAULT ‚?‘,
Geburtstag DATE DEFAULT DATE ‚&#39;0000-00-00&#39;);
</pre></div>
</div>
</div>
</div>
<p>Ein Default-Wert kann auch nachträglich mit einem <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> hinzugefügt werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
ALTER TABLE Schauspieler
ADD Telefon CHAR(16) DEFAULT ‚unbekannt‘;
</pre></div>
</div>
</div>
</div>
</section>
<section id="indizes">
<h3><span class="section-number">9.7.5. </span>Indizes<a class="headerlink" href="#indizes" title="Permalink to this headline">#</a></h3>
<p>Ein Index auf einem Attribut ist eine Datenstruktur, die es dem DBMS erleichtert, Tupel mit einem bekannten Wert des Attributs zu finden. Indizes sind nicht SQL-Standard, aber sind in (fast) jedem DBMS verfügbar.
<br><br>
Möchten wir z.B alle Disney <code class="docutils literal notranslate"><span class="pre">Filme</span></code> aus 1990 ausgeben. Wir könnten mit Variante 1 alle Tupel der <code class="docutils literal notranslate"><span class="pre">Filmerelation</span></code> durchsuchen und die <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> Bedingung prüfen. Mit Variante 2 erstellen wir einen Index <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">INDEX</span> <span class="pre">JahrIndex</span> <span class="pre">ON</span> <span class="pre">Film(Jahr)</span></code> und können direkt alle <code class="docutils literal notranslate"><span class="pre">Filme</span></code> aus 1990 betrachten und diese auf ‚Disney‘ prüfen, da der Optimizer des DBMS unsern erstellten Index sofort zur Filterung der Bedingung <code class="docutils literal notranslate"><span class="pre">Jahr</span> <span class="pre">=</span> <span class="pre">1990</span></code> benutzen kann. Zuletzt in einer dritten Variante erstellen wir einen multidimensionalen Index <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">INDEX</span> <span class="pre">JahrStudioIndex</span> <span class="pre">ON</span> <span class="pre">Film(Jahr,</span> <span class="pre">Studioname)</span></code> und holen uns direkt alle <code class="docutils literal notranslate"><span class="pre">Filme</span></code> aus 1990 von Disney. Welche der Varianten wir letzlich wählen, hängt von zu erwartenden Anfragen ab. Bei dem Anlegen von Indizes muss auch beachtet werden, dass diese Speicher belegen und aktualisiert werden müssen, wenn neue Daten hinzugefügt wurden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%sql SELECT * </span>
<span class="c1">#FROM Film </span>
<span class="c1">#WHERE StudioName = &quot;Disney&quot; </span>
<span class="c1">#AND Jahr = 1990;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM Film WHERE StudioName = &#39;Disney&#39; AND Jahr = 1990&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
      <th>Jahr</th>
      <th>Laenge</th>
      <th>inFarbe</th>
      <th>StudioName</th>
      <th>ProduzentinID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Ducktales the Movie: Treasure of the Lost Lamp</td>
      <td>1990</td>
      <td>74</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Shipwrecked</td>
      <td>1990</td>
      <td>92</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
    <tr>
      <th>2</th>
      <td>The Rescuers Down Under</td>
      <td>1990</td>
      <td>77</td>
      <td>TRUE</td>
      <td>Disney</td>
      <td>1234</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Indizes auf einzelnen Attributen:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">CREATE</span> <span class="n">INDEX</span> <span class="n">JahrIndex</span> <span class="n">ON</span> <span class="n">Film</span><span class="p">(</span><span class="n">Jahr</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Indizes auf mehreren Attributen:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">CREATE</span> <span class="n">INDEX</span> <span class="n">JahrStudioIndex</span>
<span class="n">ON</span> <span class="n">Film</span><span class="p">(</span><span class="n">Jahr</span><span class="p">,</span> <span class="n">Studioname</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Die Reihenfolge der Relationen bei Indizes auf mehreren Attributen ist wichtig. Wenn der Index sort-basiert ist, wird nach <code class="docutils literal notranslate"><span class="pre">Jahr</span></code> sortiert und für jedes <code class="docutils literal notranslate"><span class="pre">Jahr</span></code> jeweils nach Studioname. Für unser Beispiel wird implizit zuerst nach <code class="docutils literal notranslate"><span class="pre">Jahr</span></code> gefolgt von <code class="docutils literal notranslate"><span class="pre">StudioName</span></code> gesucht.
<br><br>
Um einen Index zu löschen kann <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">INDEX</span></code> … verwendet werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">DROP</span> <span class="n">INDEX</span> <span class="n">JahrIndex</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<section id="indexwahl">
<h4><span class="section-number">9.7.5.1. </span>Indexwahl<a class="headerlink" href="#indexwahl" title="Permalink to this headline">#</a></h4>
<p>Aufgrund der Kosten muss die Indexwahl abgewogen werden. Zum einen beschleunigen Indizes Punkt- (und Bereichs-) Anfragen und Join-Anfragen erheblich, aber das Einfügen, Löschen und Verändern von Tupeln der Relation wird verlangsamt, da der Index immer wieder aktualisiert werden muss. Zudem benötigen Indizes auch noch Speicherplatz.</p>
<p>Die Wahl der besten Indizes ist eine der schwierigsten Aufgaben des Datenbankdesigns, in welcher auch viel Forschung betrieben wird. Im Idealfall ist die Vorhersage der Query Workload und Update-Frequenz bekannt und es werden Attribute gewählt mit denen häufig Konstanten verglichen werden oder die häufig als Joinattribute fungieren.</p>
</section>
<section id="indexwahl-voruberlegungen">
<h4><span class="section-number">9.7.5.2. </span>Indexwahl – Vorüberlegungen<a class="headerlink" href="#indexwahl-voruberlegungen" title="Permalink to this headline">#</a></h4>
<p>Bei Vorüberlegungen zur Indexwahl muss ebenso beachtet werden, wie Indizes implementiert sind. Typischerweise sind Relationen über mehrere Diskblöcke gespeichert, wobei sich die wichtigsten Datenbankkosten aus der Anzahl, der in den Hauptspeicher gelesenen Diskblöcke bildet. Anders müssen bei Punktanfragen mit einem Index nur ein Block, statt allen gelesen werden, aber der Index selbst muss auch gespeichert und gelesen werden. In der Regel sind viel mehr Tupel pro Block repräsentiert und es werden häufig nur Schlüsselwerte und Speicheradresse und keine Daten gespeichert. Beim Updaten sind die Kosten sogar doppelt, da die Blöcke für das Lesen und Schriben der Index-Blöcke geladen werden muss.</p>
</section>
<section id="indexwahl-beispiel">
<h4><span class="section-number">9.7.5.3. </span>Indexwahl – Beispiel<a class="headerlink" href="#indexwahl-beispiel" title="Permalink to this headline">#</a></h4>
<p>Nun schauen wir uns ein Beispiel an. Haben wir die Relation <code class="docutils literal notranslate"><span class="pre">spielt_in(FilmTitel,</span> <span class="pre">FilmJahr,</span> <span class="pre">SchauspielerName)</span></code> und die Variablen <code class="docutils literal notranslate"><span class="pre">s</span></code>,<code class="docutils literal notranslate"><span class="pre">t</span></code>,<code class="docutils literal notranslate"><span class="pre">j</span></code> gegeben und möchten drei typische Anfragen ausführen. Wir suchen einmal den Titel und das <code class="docutils literal notranslate"><span class="pre">Jahr</span></code> eines bestimmten <code class="docutils literal notranslate"><span class="pre">Filmes</span> <span class="pre">s</span></code>, den <code class="docutils literal notranslate"><span class="pre">Schauspieler</span></code> der in einem bestimmten <code class="docutils literal notranslate"><span class="pre">Film</span></code> eines bestimmten <code class="docutils literal notranslate"><span class="pre">Jahre</span></code>s mitgespielt hat und wollen zuletzt in die Relation <code class="docutils literal notranslate"><span class="pre">spielt_in</span></code> Tupel einfügen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">SELECT</span> <span class="n">FilmTitel</span><span class="p">,</span> <span class="n">FilmJahr</span> <span class="n">FROM</span> <span class="n">spielt_in</span> <span class="n">WHERE</span> <span class="n">Name</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FilmTitel</th>
      <th>FilmJahr</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">SELECT</span> <span class="n">SchauspielerName</span> <span class="n">FROM</span> <span class="n">spielt_in</span>
<span class="n">WHERE</span> <span class="n">FilmTitel</span> <span class="o">=</span> <span class="n">t</span> <span class="n">AND</span> <span class="n">FilmJahr</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">spielt_in</span> <span class="n">VALUES</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Wir nehmen an, dass <code class="docutils literal notranslate"><span class="pre">spielt_in</span></code> auf 10 Disk-Blöcke verteilt ist. Im Durchschnitt hat jeder <code class="docutils literal notranslate"><span class="pre">Film</span></code> 3 <code class="docutils literal notranslate"><span class="pre">Schauspieler</span></code> und jeder <code class="docutils literal notranslate"><span class="pre">Schauspieler</span></code> spielte in 3 <code class="docutils literal notranslate"><span class="pre">Filmen</span></code> mit. Im schlimmsten Fall sind 3 Tupel auf 3 Blöcke verteilt und eine Index ist auf einem Block gespeichert. Die Operationen Lesen und Schreiben kosten 1 und Update und Insert kosten jeweils 2.</p>
</section>
<section id="id1">
<h4><span class="section-number">9.7.5.4. </span>Indexwahl – Beispiel<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
<p>Im folgenden sind die Kosten der drei Anfragen tabellarisch aufgeführt. Die Variable p1 bildet den Anteil der Anfrage 1, p2 den Anteil der Anfrage 2 und 1-p1-p2 den Anteil der Anfrage 3.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Anfrage</p></th>
<th class="head"><p>Kein Index</p></th>
<th class="head"><p>SchauspielerIndex</p></th>
<th class="head"><p>FilmIndex</p></th>
<th class="head"><p>Beide Indizes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Schauspieler = s</strong></p></td>
<td><p>10</p></td>
<td><p>4</p></td>
<td><p>10</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><strong>FilmTitel = t AND FilmJahr = j</strong></p></td>
<td><p>10</p></td>
<td><p>10</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p><strong>INSERT INTO spielt_in</strong></p></td>
<td><p>2</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Gesamtkosten</strong></p></td>
<td><p>2+8<span class="math notranslate nohighlight">\(p_1\)</span>8<span class="math notranslate nohighlight">\(p_2\)</span></p></td>
<td><p>4+6<span class="math notranslate nohighlight">\(p_2\)</span></p></td>
<td><p>4+6<span class="math notranslate nohighlight">\(p_1\)</span></p></td>
<td><p>6-2<span class="math notranslate nohighlight">\(p_1\)</span>-2<span class="math notranslate nohighlight">\(p_2\)</span></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="verteilung-in-imdb-real-world-daten-stand-ca-2010">
<h3><span class="section-number">9.7.6. </span>Verteilung in IMDB (Real-world Daten, Stand ca. 2010)<a class="headerlink" href="#verteilung-in-imdb-real-world-daten-stand-ca-2010" title="Permalink to this headline">#</a></h3>
<p>Im folgenden betrachten wir eine größere Datenbank, die dem Sternenschema folgt. In der Mitte sehen wir die Relation <code class="docutils literal notranslate"><span class="pre">Movie</span></code> und daherum viele weitere Relationen die mit der <code class="docutils literal notranslate"><span class="pre">Movie_ID</span></code> in Verbindung stehen.</p>
<p><img alt="title" src="../_images/imdb.jpg" /></p>
<p>Wir wollen nun die Durchschnittliche Anzahl an <code class="docutils literal notranslate"><span class="pre">Schauspieler*Innen</span></code> pro <code class="docutils literal notranslate"><span class="pre">Film</span></code> und umgekehrt berechnen und benutzen das Schlüsselwort <code class="docutils literal notranslate"><span class="pre">WITH</span></code>, um bestimmte Anfragen mit einem Alias vorzudefinieren.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">WITH</span>
<span class="n">m</span> <span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">AS</span> <span class="n">ZahlMovies</span> <span class="n">FROM</span> <span class="n">imdb</span><span class="o">.</span><span class="n">movie</span><span class="p">),</span>
<span class="n">actress</span> <span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">AS</span> <span class="n">ZahlActress</span> <span class="n">FROM</span> <span class="n">imdb</span><span class="o">.</span><span class="n">actress</span><span class="p">),</span>
<span class="n">actor</span> <span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">AS</span> <span class="n">ZahlActor</span> <span class="n">FROM</span> <span class="n">imdb</span><span class="o">.</span><span class="n">actor</span><span class="p">),</span>
<span class="n">actors</span> <span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="p">(</span><span class="n">ZahlActress</span> <span class="o">+</span> <span class="n">ZahlActor</span><span class="p">)</span> <span class="n">AS</span> <span class="n">GesamtActors</span> <span class="n">FROM</span> <span class="n">actress</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span>

<span class="n">SELECT</span> <span class="n">DOUBLE</span><span class="p">(</span><span class="n">actors</span><span class="o">.</span><span class="n">GesamtActors</span><span class="p">)</span> <span class="o">/</span> <span class="n">DOUBLE</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ZahlMovies</span><span class="p">)</span>
<span class="n">FROM</span> <span class="n">m</span><span class="p">,</span> <span class="n">actors</span>
</pre></div>
</div>
</div>
</div>
<p>Schauspieler*in pro Spielfilm: 8,7</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">WITH</span>
<span class="n">actors</span> <span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">imdb</span><span class="o">.</span><span class="n">actor</span> <span class="n">UNION</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">imdb</span><span class="o">.</span><span class="n">actress</span><span class="p">),</span>
<span class="n">counts</span> <span class="n">AS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="n">movie_id</span><span class="p">)</span> <span class="n">AS</span> <span class="n">m</span> <span class="n">FROM</span> <span class="n">actors</span> <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">name</span><span class="p">)</span>

<span class="n">SELECT</span> <span class="n">AVG</span><span class="p">(</span><span class="n">DOUBLE</span><span class="p">(</span><span class="n">m</span><span class="p">))</span> <span class="n">FROM</span> <span class="n">counts</span>
</pre></div>
</div>
</div>
</div>
<p>Spielfilme pro Schauspieler: 4,2</p>
</section>
</section>
<section id="sichten">
<h2><span class="section-number">9.8. </span>Sichten<a class="headerlink" href="#sichten" title="Permalink to this headline">#</a></h2>
<p>Bisher kennen wir nur Relationen, die aus <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> Ausdrücken existieren und tatsächlich (materialisiert, physisch) in der Datenbank vorhanden sind. Dieses sind persistent und auf ihnen können Updates ausgeführt werden. In diesem Kapitel beschäftigen wir uns mit Sichten. Sichten entsprechen Anfragen, denen man einen Namen gibt. Sie wirken wie physische Relationen, jedoch existieren die Daten aus Sichten nur virtuell und Updates darauf sind nur manchmal möglich. Views stellen Separation of Concern dar, können Effizienz verbessern und ermöglichen einfachere Anfragen.
<br>
<br>
<img alt="title" src="../_images/stonebraker1.jpg" />
<br>
<img alt="title" src="../_images/stonebraker2.jpg" />
<br>
Michael Stonebraker: Implementation of Integrity Constraints and Views by Query Modification. SIGMOD Conference 1975: 65-78</p>
<section id="sichten-in-sql-erstellen">
<h3><span class="section-number">9.8.1. </span>Sichten in SQL erstellen<a class="headerlink" href="#sichten-in-sql-erstellen" title="Permalink to this headline">#</a></h3>
<p>Der Grundbaustein zum erstellen von Sichten(Views) ist <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">VIEW</span> <span class="pre">Name</span> <span class="pre">AS</span> <span class="pre">Anfrage</span></code>. In der Anfrage dürfen Relationen auch gejoint sein.
<br><br>
Im folgenden erstellen wir eine View auf alle <code class="docutils literal notranslate"><span class="pre">Filme</span></code> von Paramount und nennen die View <code class="docutils literal notranslate"><span class="pre">ParamountFilme</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">ParamountFilme</span> <span class="n">AS</span>
<span class="n">SELECT</span> <span class="n">Titel</span><span class="p">,</span> <span class="n">Jahr</span>
<span class="n">FROM</span> <span class="n">Film</span>
<span class="n">WHERE</span> <span class="n">StudioName</span> <span class="o">=</span> <span class="s2">&quot;Paramount&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>Bei einer Anfrage an eine Sicht, wird die Anfrage aus der Sichtdefinition ausgeführt und die ursprüngliche Anfrage verwendet das Ergebnis dann als Relation. Bei Änderungen der zugrundeliegenden Relationen ändern sich quch die Daten der Sicht.
<br><br>
Um eine Sicht zu löschen kann <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">VIEW</span> <span class="pre">Name</span></code>, für unser Beispiel <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">VIEW</span> <span class="pre">ParamountFilme</span></code>, benutzt werden, das Löschen der Sicht hat keinen Einfluss auf die Basisdaten</p>
</section>
<section id="anfragen-an-sichten">
<h3><span class="section-number">9.8.2. </span>Anfragen an Sichten<a class="headerlink" href="#anfragen-an-sichten" title="Permalink to this headline">#</a></h3>
<p>Wir suchen nun alle <code class="docutils literal notranslate"><span class="pre">Filme</span></code> von Paramount aus 1979 und tun dies indem wir eine Anfrage an unsere <code class="docutils literal notranslate"><span class="pre">ParamountFilme</span></code>-Sicht stellen. Ohne Sicht müssten wir die Anfrage in eine Anfrage an die Basisrelation umwandeln wie eine Codezelle weiter zu sehen ist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#%sql</span>
<span class="c1">#SELECT Titel </span>
<span class="c1">#FROM Film </span>
<span class="c1">#WHERE StudioName = &quot;Paramount&quot; </span>
<span class="c1">#AND Jahr = 1979;</span>

<span class="n">__SQL__</span> <span class="o">=</span> <span class="s2">&quot;SELECT Titel FROM Film WHERE StudioName = &#39;Paramount&#39; AND Jahr = 1979;&quot;</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;filme/filme.db&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">__SQL__</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<p>Ebenso sind Anfrage zugleich an Sichten und Basisrelationen möglich, wie unten gezeigt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">SchauspielerIn</span>
<span class="n">FROM</span> <span class="n">ParamountFilme</span><span class="p">,</span> <span class="n">spielt_in</span>
<span class="n">WHERE</span> <span class="n">Titel</span> <span class="o">=</span> <span class="n">FilmTitel</span> <span class="n">AND</span> <span class="n">Jahr</span> <span class="o">=</span> <span class="n">FilmJahr</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>Im Folgenden nochmal ein weiteres Beispiel. Haben wir die Relationen <code class="docutils literal notranslate"><span class="pre">Film(Titel,</span> <span class="pre">Jahr,</span> <span class="pre">Länge,</span> <span class="pre">inFarbe,</span> <span class="pre">StudioName,</span> <span class="pre">ProduzentinID)</span></code> und <code class="docutils literal notranslate"><span class="pre">ManagerIn</span> <span class="pre">(Name,</span> <span class="pre">Adresse,</span> <span class="pre">ManagerinID,</span> <span class="pre">Gehalt)</span></code> gegeben. Wir erstellen eine View von allen <code class="docutils literal notranslate"><span class="pre">Filmproduzent*Innen</span></code> und suchen mit der Sicht den/die <code class="docutils literal notranslate"><span class="pre">Produzent*In</span></code> für den <code class="docutils literal notranslate"><span class="pre">Film</span></code> Gone with the Wind.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">FilmeProduzentenInnen</span> <span class="n">AS</span>
    <span class="n">SELECT</span> <span class="n">Titel</span><span class="p">,</span> <span class="n">Name</span>
    <span class="n">FROM</span> <span class="n">Film</span><span class="p">,</span> <span class="n">ManagerIn</span>
    <span class="n">WHERE</span> <span class="n">ProduzentinID</span> <span class="o">=</span> <span class="n">ManagerinID</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
SELECT Name 
FROM FilmeProduzenten 
WHERE Titel = ‘Gone with the Wind‘
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Titel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Gone with the Wind</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Dieselbe Anfrage an die Basisrelation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> 
<span class="n">SELECT</span> <span class="n">Name</span> 
<span class="n">FROM</span> <span class="n">Film</span><span class="p">,</span> <span class="n">ManagerIn</span> 
<span class="n">WHERE</span> <span class="n">ProduzentinID</span> <span class="o">=</span> <span class="n">ManagerinID</span> 
<span class="n">AND</span> <span class="n">Titel</span> <span class="o">=</span> <span class="s1">&#39;Gone with the Wind&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Louis B.Mayer</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Es ist auch möglich die Attribute der Basisrelation in der Sicht umzubennen. Im Beispiel unten wird aus <code class="docutils literal notranslate"><span class="pre">Titel</span></code> <code class="docutils literal notranslate"><span class="pre">FilmTitel</span></code> und <code class="docutils literal notranslate"><span class="pre">ManagerIn</span></code> zu <code class="docutils literal notranslate"><span class="pre">Produzentenname</span></code> in der Sicht.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">FilmeProduzenten</span><span class="p">(</span><span class="n">FilmTitel</span><span class="p">,</span> <span class="n">Produzentenname</span><span class="p">)</span> <span class="n">AS</span>
<span class="n">SELECT</span> <span class="n">Titel</span><span class="p">,</span> <span class="n">Name</span>
<span class="n">FROM</span> <span class="n">Film</span><span class="p">,</span> <span class="n">ManagerIn</span>
<span class="n">WHERE</span> <span class="n">ProduzentinID</span> <span class="o">=</span> <span class="n">ManagerinID</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>Sichten können auch nur zur Umbennenung dienen, wie unten gezeigt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">Movie</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">inColor</span><span class="p">,</span> <span class="n">studio</span><span class="p">,</span> <span class="n">producerID</span><span class="p">)</span> <span class="n">AS</span>
<span class="n">SELECT</span> <span class="o">*</span>
<span class="n">FROM</span> <span class="n">Film</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="diskussion">
<h3><span class="section-number">9.8.3. </span>Diskussion<a class="headerlink" href="#diskussion" title="Permalink to this headline">#</a></h3>
<p>Die Vorteile von Sichten beinhalten die Vereinfachung von Anfragen, sowie die Strukturierung der Datenbank. Es wird ebenfalls eine logische Datenunabhängigkeit geschaffen. Der Zugriff auf die Daten kann beschränkt werden, z.B könnten wir für unser Beispiel nur Paramount-Mitarbeiter*Innen den Zugriff auf die Sicht <code class="docutils literal notranslate"><span class="pre">ParamountFilme</span></code> erlauben.
<br></p>
<p>□ Logische Datenunabhängigkeit
<br>
– Sichten stabil bei Änderungen der Datenbankstruktur
<br>
– Sichtdefinitionen müssen gegebenenfalls angepasst werden
<br>
– Stabilität nicht bei jeder Änderung
<br>
□ Optimierung durch materialisierte Sichten
<br><br></p>
<p>Weiterhin bleibt die Änderung auf Sichten ein Problembereich, sowie die Updatepropagierung für materialisierte Sichten. Auch die automatische Anfragetransformation gestaltet sich mit Sichten schwieriger.</p>
</section>
<section id="updates-auf-sichten">
<h3><span class="section-number">9.8.4. </span>Updates auf Sichten<a class="headerlink" href="#updates-auf-sichten" title="Permalink to this headline">#</a></h3>
<p>In einigen Fällen ist es möglich, Einfüge-, Lösch- oder Updateoperationen auf Sichten durchzuführen. Hier stellen sich die Fragen: Wo sind die Sichten gespeichert? Welche Relationen sind betroffen? Wie verläuft die Zuordnung der Änderung zur Sicht?
<br><br>
In den meisten Fällen wird die Update-Operation einer Sicht auf eine Update-Operation der zugrunde liegenden Basisrelationen übersetzt. Hierbei darf kein <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>, sondern nur eine normales <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> verwendet werden. Eine gute Kenntnis der Datenbank muss vorausgesetzt sein, da durch das Vergessen mancher Attribute Inkonsistenzen durch <code class="docutils literal notranslate"><span class="pre">NULL</span></code>-Werte entstehen können.
<br><br>
□ Nur bei einer Relation
<br>
– Keine Subanfragen mit Selbstbezug
<br>
□ Nur bei normalem <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>
<br>
– Kein <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>
<br>
□ Nur falls genug Attribute verwendet werden, so dass alle anderen Attribute mit <code class="docutils literal notranslate"><span class="pre">NULL</span></code> oder dem Default-Wert gefüllt werden können.</p>
</section>
<section id="einfugen-auf-sichten-beispiel">
<h3><span class="section-number">9.8.5. </span>Einfügen auf Sichten – Beispiel<a class="headerlink" href="#einfugen-auf-sichten-beispiel" title="Permalink to this headline">#</a></h3>
<p>Haben wir die Relation <code class="docutils literal notranslate"><span class="pre">Filme(Titel,</span> <span class="pre">Jahr,</span> <span class="pre">Länge,</span> <span class="pre">inFarbe,</span> <span class="pre">StudioName,</span> <span class="pre">ProduzentinID)</span></code> gegeben. Wir wollen nun einen weiteren <code class="docutils literal notranslate"><span class="pre">Film</span></code> in unsere <code class="docutils literal notranslate"><span class="pre">ParamountFilme</span></code>-Sicht einfügen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
CREATE VIEW ParamountFilme AS
    SELECT Titel, Jahr
    FROM Filme
    WHERE StudioName = ‚Paramount‘;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
INSERT INTO ParamountFilme
VALUES (‚Star Trek‘, 1979);
</pre></div>
</div>
</div>
</div>
<p>Das Einfügen wie oben dargestellt ist nicht erlaubt, das kein Wert für <code class="docutils literal notranslate"><span class="pre">Studioname</span></code> vorhanden ist und nicht überprüft wern kann, ob es sich um einen <code class="docutils literal notranslate"><span class="pre">ParamountFilm</span></code> handelt. Unten sehen wir eine korrekte Weise des Einfügens in die Sicht. Es wurde eine neue Sicht erstellt die <code class="docutils literal notranslate"><span class="pre">StudioName</span></code> beinhaltet. Der <code class="docutils literal notranslate"><span class="pre">StudioName</span></code> bei der Einfügeoperation muss Paramount sein, da kein anderer <code class="docutils literal notranslate"><span class="pre">StudioName</span></code> der Sicht entspricht. Das Neue Tupel ist <code class="docutils literal notranslate"><span class="pre">(‚Star</span> <span class="pre">Trek‘,</span> <span class="pre">1979,</span> <span class="pre">0,</span> <span class="pre">NULL,</span> <span class="pre">‚Paramount‘,</span> <span class="pre">NULL)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
CREATE VIEW ParamountFilme AS
    SELECT Titel, Jahr, StudioName
    FROM Filme
    WHERE StudioName = ‚Paramount‘;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
INSERT INTO ParamountFilme
VALUES (‚Star Trek‘, 1979, ‚Paramount‘);
</pre></div>
</div>
</div>
</div>
</section>
<section id="loschen-und-updates-auf-sichten">
<h3><span class="section-number">9.8.6. </span>Löschen und Updates auf Sichten<a class="headerlink" href="#loschen-und-updates-auf-sichten" title="Permalink to this headline">#</a></h3>
<p>Im Folgenden möchten wir alle Filme aus unserer <code class="docutils literal notranslate"><span class="pre">Sicht</span></code> entfernen die ‘Trek’ im <code class="docutils literal notranslate"><span class="pre">Filmtitel</span></code> enthalten.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
DELETE FROM ParamountFilme
WHERE Titel LIKE ‚%Trek%‘;
</pre></div>
</div>
</div>
</div>
<p>Diese Anfrage wird umgeschrieben zu der unteren.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#Korrekte Anfrage
%sql
DELETE FROM Filme
WHERE Titel LIKE ‚%Trek%‘ AND StudioName = ‚Paramount‘;
</pre></div>
</div>
</div>
</div>
<p>Auch bei einem Update muss die Prüfbedingung der Sicht mit übernommen werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%sql
UPDATE ParamountFilme
SET Jahr = 1979
WHERE Titel = ‚Star Trek the Movie‘;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#Korrekte Anfrage
%sql
UPDATE Filme
SET Jahr = 1979
WHERE Titel = ‚Star Trek the Movie‘ AND StudioName = ‚Paramount‘;
</pre></div>
</div>
</div>
</div>
</section>
<section id="tupelmigration">
<h3><span class="section-number">9.8.7. </span>Tupelmigration<a class="headerlink" href="#tupelmigration" title="Permalink to this headline">#</a></h3>
<p>Angenommen wir erstellen eine Sicht auf die Relation <code class="docutils literal notranslate"><span class="pre">ManagerIn(Name,</span> <span class="pre">Adresse,</span> <span class="pre">ManagerinID,</span> <span class="pre">Gehalt)</span></code>, welche alle Manager*Innen mit einem <code class="docutils literal notranslate"><span class="pre">Gehalt</span></code> größer als 2 Millionen beinhaltet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">Reiche</span> <span class="n">AS</span>
    <span class="n">SELECT</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Gehalt</span><span class="p">,</span> <span class="n">ManagerinID</span>
    <span class="n">FROM</span> <span class="n">ManagerIn</span>
    <span class="n">WHERE</span> <span class="n">Gehalt</span> <span class="o">&gt;</span> <span class="mi">2000000</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>Nun updaten wir unsere View, sodass der/die Manager*in mit der <code class="docutils literal notranslate"><span class="pre">ManagerinID=25</span></code> ein <code class="docutils literal notranslate"><span class="pre">Gehalt</span></code> von 1,5 Millionen haben muss. Das <code class="docutils literal notranslate"><span class="pre">Tupel</span> <span class="pre">(‚Eisner`,</span> <span class="pre">‚Hollywood‘,</span> <span class="pre">25,</span> <span class="pre">3000000)</span></code>, welches vor dem Update noch in der Sicht enthalten war, wird danach aus der Sicht „herausbewegt“.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">UPDATE</span> <span class="n">Reiche</span> <span class="n">SET</span> <span class="n">Gehalt</span> <span class="o">=</span> <span class="mi">1500000</span>
<span class="n">WHERE</span> <span class="n">ManagerinID</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<p>Um Tupelmigration zu verhindern, können problematische Update durch <code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">CHECK</span> <span class="pre">OPTION</span></code> abgelehnt werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span>
<span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">Reiche</span> <span class="n">AS</span>
<span class="n">SELECT</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Gehalt</span>
<span class="n">FROM</span> <span class="n">ManagerIn</span>
<span class="n">WHERE</span> <span class="n">Gehalt</span> <span class="o">&gt;</span> <span class="mi">2000000</span>
<span class="n">WITH</span> <span class="n">CHECK</span> <span class="n">OPTION</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="anfrageplanung-mit-sichten">
<h3><span class="section-number">9.8.8. </span>Anfrageplanung mit Sichten<a class="headerlink" href="#anfrageplanung-mit-sichten" title="Permalink to this headline">#</a></h3>
<p>Üblicherweise werden Anfragen in Form eines Baums dargestellt. Die Blätter repräsentieren Basisrelationen und Sichten. Die Sichten können auch durch die Sichtdefinitionen erstezt werden.
<br>
Ein Beispiel hierfür sehen wir in der unteren Abbildung. Die Dreiecke sind die Anfragen und die Kreise Sichten. Wir ersetzen die Sichten <code class="docutils literal notranslate"><span class="pre">v</span></code> und <code class="docutils literal notranslate"><span class="pre">w</span></code> durch ihre Sichtdefinitionen und sehen, das <code class="docutils literal notranslate"><span class="pre">w</span></code> eine weitere Sicht <code class="docutils literal notranslate"><span class="pre">z</span></code> in Anspruch nimmt.</p>
<p><img alt="title" src="../_images/anfrageplanung1.jpg" /></p>
<p>Betrachten wir wieder unsere Beispielsicht <code class="docutils literal notranslate"><span class="pre">ParamountFilme</span></code>. Wir möchten nun die unten stehende Anfrage ausführen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#Sicht
%sql
CREATE VIEW ParamountFilme AS
SELECT Titel, Jahr
FROM Filme
WHERE StudioName = ‚Paramount‘;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Anfrage</span>
<span class="n">SELECT</span> <span class="n">Titel</span> 
<span class="n">FROM</span> <span class="n">ParamountFilme</span> 
<span class="n">WHERE</span> <span class="n">Jahr</span> <span class="o">=</span> <span class="mi">1979</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Star Trek 
</pre></div>
</div>
</div>
</div>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Sichtendefinition der ParamountFilme</p></th>
<th class="text-align:center head"><p>Ausführungsreihenfolge der Anfrage, die direkt auf der Sicht ParamountFilme ausgeführt wird</p></th>
<th class="text-align:center head"><p>ParamountFilme ersetzt durch die Sichtendefinition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p><a class="reference internal" href="../_images/anfrageplanung2.jpg"><img alt="../_images/anfrageplanung2.jpg" src="../_images/anfrageplanung2.jpg" style="width: 200px;" /></a></p></td>
<td class="text-align:center"><p><a class="reference internal" href="../_images/anfrageplanung3.jpg"><img alt="../_images/anfrageplanung3.jpg" src="../_images/anfrageplanung3.jpg" style="width: 200px;" /></a></p></td>
<td class="text-align:center"><p><a class="reference internal" href="../_images/anfrageplanung4.jpg"><img alt="../_images/anfrageplanung4.jpg" src="../_images/anfrageplanung4.jpg" style="width: 200px;" /></a></p></td>
</tr>
</tbody>
</table>
</section>
<section id="materialisierte-sichten">
<h3><span class="section-number">9.8.9. </span>Materialisierte Sichten<a class="headerlink" href="#materialisierte-sichten" title="Permalink to this headline">#</a></h3>
<p>In der realen Welt ist es möglich, dass viele Anfragen an eine Datenbank sich häufig wiederholen, wie z.B bei Business Reports, Bilanzen, Umsätze oder Bestellungsplanung, Produktionsplanung oder auch bei der Kennzahlenberechnung. Diese vielen Anfragen sind oft Variationen mit gemeinsamen Kern. Um Ressourcen zu sparen kann eine Anfrage als Sicht einmalig berechnet und dann materialisiert werden. So kann die Sicht automatisch und transparent in folgenden Anfragen wiederbenutzt werden.
<br><br>
Drei Folien nach Prof. Ulf Leser, HU Berlin</p>
<section id="mv-themen-und-probleme">
<h4><span class="section-number">9.8.9.1. </span>MV – Themen und Probleme<a class="headerlink" href="#mv-themen-und-probleme" title="Permalink to this headline">#</a></h4>
<p>Es stellt sich die Frage welche Views nun zur Materialisierung ausgewählt werden, hierbei müssen die Kosten(Platz und Aktualisierungsaufwand) von MV beachtete werden, als auch der Workload und die Menge von MVs, beeinflussen die optimale Wahl.
<br><br>
Ein anderes Problemengebiet ist die automatische Aktualisierung von MVs, wie also z.B mit einer Aktualisierung bei Änderungen der Basisrelationen umgegangen wird, v.A. bei Aggregaten, Joins, Outer-Joins usw. . Hierfür bieten sich
Algorithmen zur inkrementellen Aktualisierung an.
<br><br>
Weiterhin stellt sich auch die Frage, wie die Verwendung von MVs bei der Ausführung von Anfragen automatisiert wird. Die Schwierigkeit dieser Aufgabe hängt von der Komplexität der Anfragen bzw. Views ab, da das Umschreiben der Anfrage notwendig ist. Demnach werden Algorithmen zur transparenten und kostenoptimalen Verwendung der materialisierten Sichten notwendig.</p>
</section>
</section>
<section id="answering-queries-using-views">
<h3><span class="section-number">9.8.10. </span>„Answering Queries using Views“<a class="headerlink" href="#answering-queries-using-views" title="Permalink to this headline">#</a></h3>
<p>Angenommen wir habene ine Anfrage Q und eine Menge V (materialisierten) von Sichten gegeben. Es stellen sich folgende Fragen:
<br></p>
<ul class="simple">
<li><p>Kann man Q überhaupt unter Verwendung von V beantworten?
<br></p></li>
<li><p>Kann man Q nur mit V beantworten?
<br></p></li>
<li><p>Kann man Q mit V vollständig beantworten?
<br></p></li>
<li><p>Ist es günstig, Sichten aus V zur Beantwortung von Q zu verwenden? Welche?</p></li>
</ul>
</section>
</section>
<section id="zusammenfassung">
<h2><span class="section-number">9.9. </span>Zusammenfassung<a class="headerlink" href="#zusammenfassung" title="Permalink to this headline">#</a></h2>
<p>In diesem Kapitel haben wir uns mit der Anfragesprache SQL beschäftigt. Zuerst haben wir uns mit dem Grundgerüst aller SQL-Anfragen dem SFW(<code class="docutils literal notranslate"><span class="pre">SELECT</span></code> <code class="docutils literal notranslate"><span class="pre">FROM</span></code> <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>) Block beschäftigt, gefolgt von Subanfragen in der <code class="docutils literal notranslate"><span class="pre">FROM</span></code>- und <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>-Klausel und den Schlüsselwörtern <code class="docutils literal notranslate"><span class="pre">EXISTS</span></code>, <code class="docutils literal notranslate"><span class="pre">IN</span></code>, <code class="docutils literal notranslate"><span class="pre">ALL</span></code>, <code class="docutils literal notranslate"><span class="pre">ANY</span></code> ,die genutzt werden um Bedingungen an Relationen zu stellen. Weiterhin haben wir die Mengenoperationen <code class="docutils literal notranslate"><span class="pre">UNION</span></code>, <code class="docutils literal notranslate"><span class="pre">INTERSECT</span></code>, <code class="docutils literal notranslate"><span class="pre">EXCEPT</span></code> und diesbezüglich <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>,<code class="docutils literal notranslate"><span class="pre">ALL</span></code>(bei Multimengensemantik) kennengelernt. Wir haben auch die verschiedenen Joins und Outerjoins betrachtet und den Einsatz von Nullwerten kennengelernt. Darüber hinaus haben wir gesehen wie Gruppierung und Aggregation in SQL in Kombination mit Schlüsselwörtern wie <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>, <code class="docutils literal notranslate"><span class="pre">HAVING</span></code> und <code class="docutils literal notranslate"><span class="pre">MIN</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX</span></code>, <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> umgesetzt wird.
<br>
<br>
Im Weiteren haben wir SQL als DML betrachtet ,um Datenbankveränderungen mit <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> zu schaffen. In Bezug auf SQL als DDL haben wir Schemata und Datentypen kennengelernt, die zur Erstellung und Veränderung von Relationen mit <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> und <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> nötig sind. Anschließend haben wir die Datenstruktur Index betrachtet, die die Suche nach Tupel erleichtert. Zuletzt haben wir uns mit Sichten und materalisierten Sichten, sowie Anfragen und Updates darauf beschäftigt.</p>
</section>
<section id="sql-trainer">
<h2><span class="section-number">9.10. </span>SQL-Trainer<a class="headerlink" href="#sql-trainer" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Mithilfe des SQL-Trainers können sie ihr erlangtes Wissen aus diesem Kapitel vertiefen und praktisch anwenden:</p></li>
<li><p>Die hier verwendete Version des Multiple-Choice-Trainers von EILD.nrw wird über GitHub-Pages gehostet und in das Skript eingebunden.</p></li>
</ul>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
<iframe
    width="100%"
    height="800"
    src="https://luh-dbs.github.io/sql-trainer/"
    frameborder="0"
    allowfullscreen

></iframe>
</div></div>
</div>
</section>
<section id="fragen">
<h2><span class="section-number">9.11. </span>Fragen<a class="headerlink" href="#fragen" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Die hier verwendete Version des Multiple-Choice-Trainers von EILD.nrw wird über GitHub-Pages gehostet und in das Skript eingebunden.</p></li>
<li><p>Alle Fragen und Kategorien befinden sich zurzeit in Überarbeitung und sind nicht final.</p></li>
<li><p><strong>Für den vollen Funktionsumfang wird empfohlen einen auf Firefox basierten Browser zu nutzen, ansonsten können  unerwünschte Nebeneffekte entstehen.</strong></p></li>
</ul>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
<iframe
    width="100%"
    height="800"
    src="https://luh-dbs.github.io/mct-trainer/#/quiz/categories/sql"
    frameborder="0"
    allowfullscreen

></iframe>
</div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "LUH-DBS/GDBS_Script",
            ref: "main/",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./09"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../08/relationale_algebra.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">8. </span>Relationale Algebra</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../10/integritaet_und_trigger.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">10. </span>Integrität und Trigger</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Prof. Dr. Ziawasch Abedjan<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>